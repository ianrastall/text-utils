<!DOCTYPE html>
<html lang="en">
<head>
<!-- Google tag gtag.js -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-0V2F0V7FWB"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-0V2F0V7FWB');
</script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Case Converter - Text Utilities</title>
    <script>
        (function () {
            try {
                const storedTheme = localStorage.getItem('theme');
                const prefersLight = window.matchMedia && window.matchMedia('(prefers-color-scheme: light)').matches;
                const resolvedTheme = storedTheme === 'light' || storedTheme === 'dark'
                    ? storedTheme
                    : (prefersLight ? 'light' : 'dark');
                document.documentElement.setAttribute('data-theme', resolvedTheme);

                const storedAccent = localStorage.getItem('accentColor');
                let normalizedAccent = typeof storedAccent === 'string' ? storedAccent.trim().toLowerCase() : '';
                if (/^#[0-9a-f]{3}$/.test(normalizedAccent)) {
                    normalizedAccent = `#${normalizedAccent[1]}${normalizedAccent[1]}${normalizedAccent[2]}${normalizedAccent[2]}${normalizedAccent[3]}${normalizedAccent[3]}`;
                }

                if (/^#[0-9a-f]{6}$/.test(normalizedAccent)) {
                    const red = parseInt(normalizedAccent.slice(1, 3), 16);
                    const green = parseInt(normalizedAccent.slice(3, 5), 16);
                    const blue = parseInt(normalizedAccent.slice(5, 7), 16);
                    document.documentElement.style.setProperty('--accent', normalizedAccent);
                    document.documentElement.style.setProperty('--accent-rgb', `${red}, ${green}, ${blue}`);
                }
            } catch (_) {
                document.documentElement.setAttribute('data-theme', 'dark');
            }
        })();
    </script>
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link rel="stylesheet" href="css/style.css">
</head>
<body>
    <div class="container">
        <header>
            <div class="logo">
                <a href="index.html" style="color: inherit; text-decoration: none;">
                    <span>Text Utilities</span>
                </a>
            </div>
            <nav class="site-network" aria-label="Network sites">
                <a href="https://chessnerd.net" class="site-network-link" target="_blank" rel="noopener noreferrer">
                    <img src="img/chessnerd-icon.png" class="site-network-icon" alt="">
                    <span>Chess Nerd</span>
                    <span class="material-icons" aria-hidden="true">open_in_new</span>
                </a>
                <a href="https://github.com/ianrastall/text-utils" class="site-network-link" target="_blank" rel="noopener noreferrer">
                    <img src="img/github.png" class="site-network-icon" alt="">
                    <span>GitHub</span>
                    <span class="material-icons" aria-hidden="true">open_in_new</span>
                </a>
            </nav>
            <div class="controls">
                <div class="accent-selector">
                    <span class="material-icons">palette</span>
                    <select id="accentColor" class="color-dropdown" aria-label="Accent color"></select>
                </div>
                <button id="themeToggle" class="btn btn-secondary" type="button" aria-label="Toggle theme" aria-pressed="false">
                    <span class="material-icons">dark_mode</span>
                </button>
            </div>
        </header>

        <main>
            <!-- Tool View -->
            <div id="toolView">
                <div class="tool-header">
                    <div class="tool-title">
                        <span class="material-icons" id="toolIcon">text_format</span>
                        <h2 id="toolName">Case Converter</h2>
                    </div>
                    <div class="tool-actions">
                        <button id="backButton" class="btn btn-secondary btn-compact" type="button">
                            <span class="material-icons">arrow_back</span>
                            Back
                        </button>
                        <button id="clearAll" class="btn btn-secondary btn-compact" type="button">
                            <span class="material-icons">delete</span>
                            Clear
                        </button>
                        <button id="copyOutput" class="btn btn-secondary btn-compact" type="button">
                            <span class="material-icons">content_copy</span>
                            Copy
                        </button>
                    </div>
                </div>
                
                <!-- Tool-specific options -->
                <div class="options-panel" id="toolOptions">
                    <div class="options-grid">
                        <div class="option-group">
                            <label for="caseType">Case Type</label>
                            <select id="caseType">
                                <option value="upper">UPPERCASE</option>
                                <option value="lower" selected>lowercase</option>
                                <option value="title">Title Case</option>
                                <option value="sentence">Sentence case</option>
                                <option value="camel">camelCase</option>
                                <option value="pascal">PascalCase</option>
                                <option value="snake">snake_case</option>
                                <option value="kebab">kebab-case</option>
                                <option value="invert">InVeRt CaSe</option>
                            </select>
                        </div>
                    </div>
                </div>
                
                <!-- Input/Output -->
                <div class="io-container">
                    <div class="io-panel">
                        <div class="io-label">
                            <span>Input</span>
                            <span class="stats pill muted" id="inputStats">0 chars</span>
                        </div>
                        <textarea id="inputText" aria-label="Input text for case conversion" placeholder="Paste your text here..."></textarea>
                    </div>
                    <div class="io-panel">
                        <div class="io-label">
                            <span>Output</span>
                            <span class="stats pill muted" id="outputStats">0 chars</span>
                        </div>
                        <textarea id="outputText" aria-label="Converted output text" class="output" readonly placeholder="Results will appear here..."></textarea>
                    </div>
                </div>
                
                <div class="status-bar">
                    <div id="statusMessage" class="success" role="status" aria-live="polite">Ready</div>
                    <div id="toolStats">No operations yet</div>
                </div>
            </div>
        </main>
    </div>

    <script src="js/theme.js"></script>
    <script>
        // Common utility functions for all tools
        const inputText = document.getElementById('inputText');
        const outputText = document.getElementById('outputText');
        const inputStats = document.getElementById('inputStats');
        const outputStats = document.getElementById('outputStats');
        const statusMessage = document.getElementById('statusMessage');
        const toolStats = document.getElementById('toolStats');
        const copyButton = document.getElementById('copyOutput');
        const clearButton = document.getElementById('clearAll');
        const backButton = document.getElementById('backButton');
        const caseTypeSelect = document.getElementById('caseType');
        const DEFAULT_TOOL_STATS = 'No operations yet';
        let statusResetTimer = null;
        let convertDebounceTimer = null;

        function setStatus(message, level = 'success', resetMs = 0) {
            if (statusResetTimer) {
                clearTimeout(statusResetTimer);
                statusResetTimer = null;
            }

            statusMessage.textContent = message;
            statusMessage.classList.remove('success', 'warning', 'error');
            statusMessage.classList.add(level);

            if (resetMs > 0) {
                statusResetTimer = setTimeout(() => {
                    statusResetTimer = null;
                    statusMessage.textContent = 'Ready';
                    statusMessage.classList.remove('warning', 'error');
                    statusMessage.classList.add('success');
                }, resetMs);
            }
        }

        function updateCopyButtonState() {
            copyButton.disabled = !outputText.value;
        }

        // Update character/line statistics
        function updateStats() {
            const inputValue = inputText.value;
            const outputValue = outputText.value;
            const inputLength = inputValue.length;
            const outputLength = outputValue.length;
            const inputLines = inputLength ? inputValue.split(/\r?\n/).length : 0;
            const outputLines = outputLength ? outputValue.split(/\r?\n/).length : 0;
            
            inputStats.textContent = `${inputLength} chars, ${inputLines} lines`;
            outputStats.textContent = `${outputLength} chars, ${outputLines} lines`;
            updateCopyButtonState();
        }

        function fallbackCopy(text) {
            const helper = document.createElement('textarea');
            helper.value = text;
            helper.setAttribute('readonly', '');
            helper.style.position = 'absolute';
            helper.style.left = '-9999px';
            document.body.appendChild(helper);
            helper.select();
            helper.setSelectionRange(0, helper.value.length);

            let copied = false;
            try {
                copied = document.execCommand('copy');
            } catch (error) {
                copied = false;
            }

            document.body.removeChild(helper);
            return copied;
        }

        // Copy output to clipboard
        async function copyToClipboard() {
            if (!outputText.value) return;

            try {
                if (navigator.clipboard && window.isSecureContext) {
                    await navigator.clipboard.writeText(outputText.value);
                } else if (!fallbackCopy(outputText.value)) {
                    throw new Error('Clipboard unavailable');
                }

                setStatus('Copied to clipboard!', 'success', 2000);
            } catch (error) {
                setStatus('Failed to copy', 'error', 3000);
            }
        }

        // Clear all fields
        function clearAll() {
            if (convertDebounceTimer) {
                clearTimeout(convertDebounceTimer);
                convertDebounceTimer = null;
            }
            inputText.value = '';
            outputText.value = '';
            toolStats.textContent = DEFAULT_TOOL_STATS;
            updateStats();
            setStatus('Cleared', 'success', 1500);
            inputText.focus();
        }

        // Navigate back to home
        function goBack() {
            window.location.href = 'index.html';
        }

        // Case conversion functions
        function toUpperCase(text) {
            return text.toUpperCase();
        }

        function toLowerCase(text) {
            return text.toLowerCase();
        }

        function toTitleCase(text) {
            const smallWords = /^(a|an|the|and|but|or|for|nor|on|at|to|from|by|in|of)$/i;
            
            return text.split('\n').map(line => {
                let firstWordSeen = false;
                return line.toLowerCase().replace(/\b\w+(?:'\w+)?/g, word => {
                    if (!firstWordSeen) {
                        firstWordSeen = true;
                        return word.charAt(0).toUpperCase() + word.slice(1);
                    }
                    if (smallWords.test(word)) {
                        return word;
                    }
                    return word.charAt(0).toUpperCase() + word.slice(1);
                });
            }).join('\n');
        }

        function toSentenceCase(text) {
            return text
                .toLowerCase()
                .replace(/(^\s*[a-z])|([.!?]\s+[a-z])/gm, match => match.toUpperCase());
        }

        function splitWords(text) {
            return text
                .replace(/([a-z0-9])([A-Z])/g, '$1 $2')
                .replace(/[_-]+/g, ' ')
                .replace(/[^a-zA-Z0-9\s]+/g, ' ')
                .trim()
                .split(/\s+/)
                .filter(Boolean);
        }

        function capitalizeWord(word) {
            return word.charAt(0).toUpperCase() + word.slice(1).toLowerCase();
        }

        function toCamelCase(text) {
            const words = splitWords(text);
            if (!words.length) return '';

            return words[0].toLowerCase() +
                words.slice(1).map(capitalizeWord).join('');
        }

        function toPascalCase(text) {
            return splitWords(text).map(capitalizeWord).join('');
        }

        function toSnakeCase(text) {
            return splitWords(text)
                .map(word => word.toLowerCase())
                .join('_');
        }

        function toKebabCase(text) {
            return splitWords(text)
                .map(word => word.toLowerCase())
                .join('-');
        }

        function invertCase(text) {
            return text.split('').map(char => 
                char === char.toUpperCase() ? char.toLowerCase() : char.toUpperCase()
            ).join('');
        }

        // Main conversion function
        function convertCase() {
            if (convertDebounceTimer) {
                clearTimeout(convertDebounceTimer);
                convertDebounceTimer = null;
            }

            const input = inputText.value;
            const caseType = caseTypeSelect.value;
            
            if (!input) {
                outputText.value = '';
                toolStats.textContent = DEFAULT_TOOL_STATS;
                setStatus('Ready');
                updateStats();
                return;
            }

            try {
                const startTime = performance.now();
                let result = '';

                switch(caseType) {
                    case 'upper':
                        result = toUpperCase(input);
                        break;
                    case 'lower':
                        result = toLowerCase(input);
                        break;
                    case 'title':
                        result = toTitleCase(input);
                        break;
                    case 'sentence':
                        result = toSentenceCase(input);
                        break;
                    case 'camel':
                        result = toCamelCase(input);
                        break;
                    case 'pascal':
                        result = toPascalCase(input);
                        break;
                    case 'snake':
                        result = toSnakeCase(input);
                        break;
                    case 'kebab':
                        result = toKebabCase(input);
                        break;
                    case 'invert':
                        result = invertCase(input);
                        break;
                    default:
                        result = input;
                }

                const endTime = performance.now();
                
                outputText.value = result;
                setStatus('Success');
                toolStats.textContent = `Processed in ${Math.round(endTime - startTime)}ms`;
            } catch (error) {
                outputText.value = `Error: ${error.message}`;
                setStatus('Error', 'error');
                toolStats.textContent = 'Processing failed';
            }
            
            updateStats();
        }

        function scheduleConvertCase() {
            if (convertDebounceTimer) {
                clearTimeout(convertDebounceTimer);
            }
            convertDebounceTimer = setTimeout(() => {
                convertDebounceTimer = null;
                convertCase();
            }, 120);
        }

        // Setup event listeners
        inputText.addEventListener('input', scheduleConvertCase);
        caseTypeSelect.addEventListener('change', convertCase);
        copyButton.addEventListener('click', copyToClipboard);
        clearButton.addEventListener('click', clearAll);
        backButton.addEventListener('click', goBack);

        // Keyboard shortcuts
        document.addEventListener('keydown', (e) => {
            if ((e.ctrlKey || e.metaKey) && e.key === 'Enter' && document.activeElement === inputText) {
                e.preventDefault();
                convertCase();
            }
        });

        // Initialize stats
        updateStats();
    </script>
    <footer class="site-footer">
        <p>&copy; Ian Rastall 2025<br>Contact: moving.form.of.dust@gmail.com<br>Donate: PayPal to merastall@gmail.com</p>
    </footer>
</body>
</html>
