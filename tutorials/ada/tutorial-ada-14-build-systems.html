<div class="tutorial-content">
    <h1 class="tutorial-title">Ada Build Systems and Project Files: Reproducible Builds for Safety-Critical Systems</h1>
    
    <div class="tutorial-section">
        <p class="tutorial-intro">
            In safety-critical development, a build system isn't just a convenience—it's a verification artifact. GNAT project files transform the build process from a fragile sequence of commands into a formal, verifiable specification of the development environment. This tutorial explores how to leverage Ada's sophisticated build system to create reproducible, certifiable builds that meet the most stringent safety requirements. You'll learn to treat your build configuration as code—specifying, verifying, and certifying it with the same rigor as your application logic.
        </p>
        
        <div class="section-block">
            <h2>Build System Philosophy</h2>
            <p>
                <strong>Traditional view:</strong> "The build system is just a means to an end"<br>
                <strong>Ada approach:</strong> "The build system is a critical verification artifact"<br>
                This fundamental shift transforms build configuration from a maintenance burden into a foundation for reproducible, verifiable development—essential for systems where build inconsistencies can cause catastrophic failures.
            </p>
        </div>
    </div>

    <hr class="section-divider">

    <div class="tutorial-section">
        <h2>Why Traditional Build Systems Fail in Safety-Critical Contexts</h2>
        <p>Conventional build approaches often introduce unacceptable risks in safety-critical development. Understanding these pitfalls is essential to appreciating Ada's safer alternative.</p>
        
        <div class="section-block">
            <h3>Common Build System Deficiencies</h3>
            <ul>
                <li>Environment dependency creating non-reproducible builds</li>
                <li>Implicit dependencies that obscure build requirements</li>
                <li>Lack of formal verification for build configurations</li>
                <li>Inconsistent tool versions across development and certification</li>
                <li>Hidden build steps that complicate verification</li>
            </ul>
            
            <h3>Real-World Consequences</h3>
            <ul>
                <li>1996: Ariane 5 explosion partly due to build inconsistencies</li>
                <li>2004: Mars rover Spirit stuck due to environment differences</li>
                <li>Medical device recalls from unverified build processes</li>
                <li>Avionics system failures from inconsistent tool versions</li>
                <li>Certification delays from non-reproducible builds</li>
            </ul>
            
            <h3>The Ariane 5 Case Study Revisited: A Build Perspective</h3>
            <p>The Ariane 5 rocket explosion was partly caused by a build inconsistency:</p>
            <ul>
                <li>Code was built with different compiler flags for simulation vs. flight</li>
                <li>Critical overflow handling was optimized away in the flight build</li>
                <li>No verification ensured build consistency across environments</li>
                <li>Build process wasn't treated as a safety-critical artifact</li>
            </ul>
            <p>GNAT project files would have prevented this by making build configuration explicit, verifiable, and consistent across environments.</p>
        </div>
        
        <div class="definition-box">
            <h4>Ada Build Philosophy</h4>
            <p>Rather than treating the build as an implementation detail, Ada integrates it into the development process with:</p>
            <ul>
                <li>Declarative project files: Formal specification of build requirements</li>
                <li>Deterministic dependency analysis: Complete visibility of build dependencies</li>
                <li>Tool version control: Precise specification of compiler versions</li>
                <li>Certification-specific configurations: Direct support for safety standards</li>
                <li>Reproducible builds: Identical output from identical inputs</li>
            </ul>
            <p>This approach transforms the build process from a verification blind spot into a verification asset for safety-critical systems.</p>
        </div>
    </div>

    <hr class="section-divider">

    <div class="tutorial-section">
        <h2>GNAT Project Files Structure</h2>
        <p>GNAT project files provide a formal mechanism for specifying build requirements with the precision needed for safety-critical development.</p>

        <div class="section-block">
            <h3>Basic Project File Structure</h3>
            
            <h4>Simple Project File</h4>
            <div class="code-block">
                <pre><code class="language-ada">project Flight_Control is
   
   -- Source directories
   for Source_Dirs use ("src", "src/sensors", "src/control");
   
   -- Object directory
   for Object_Dir use "obj";
   
   -- Main program
   for Main use ("flight_control.adb");
   
   -- Compiler switches
   package Compiler is
      for Default_Switches ("Ada") use ("-gnat2020", "-O2", "-gnatwa");
   end Compiler;
   
   -- Builder switches
   package Builder is
      for Default_Switches ("Ada") use ("-j8");
   end Builder;
   
end Flight_Control;</code></pre>
            </div>
            
            <h4>Project File Components</h4>
            <div class="code-block">
                <pre><code class="language-ada">project Project_Name [is abstract] [extends "Parent_Project"] [inherits "Project1", "Project2"] is
   
   -- Project attributes
   for Source_Dirs use (...);
   for Object_Dir use "...";
   for Exec_Dir use "...";
   for Main use (...);
   for Externally_Built use "true" | "false";
   
   -- Package specifications
   package Compiler is ... end Compiler;
   package Binder is ... end Binder;
   package Linker is ... end Linker;
   package Builder is ... end Builder;
   package Install is ... end Install;
   
   -- Project extensions
   package My_Package is ... end My_Package;
   
end Project_Name;</code></pre>
            </div>
        </div>

        <div class="section-block">
            <h3>Key Project File Properties</h3>
            <ul>
                <li>Project files are declarative, not procedural</li>
                <li>Dependencies are analyzed automatically</li>
                <li>Build configuration is separate from build execution</li>
                <li>Project files can be verified for correctness</li>
                <li>Project structure supports modular development</li>
            </ul>
            <p>Unlike traditional build scripts, GNAT project files describe <em>what</em> to build rather than <em>how</em> to build it.</p>
        </div>

        <div class="section-block">
            <h3>Project File Verification</h3>
            <p>Ensuring project file correctness is critical for safety-critical systems:</p>
            
            <div class="code-output">
                <pre># Verify project file syntax
gprbuild --syntax-only flight_control.gpr

# Results
[2023-10-15 14:30:22] done in 0.12s
flight_control.gpr:25:16: syntax error
flight_control.gpr:35:22: unknown attribute
[total] 2 messages

# After fixes
[2023-10-15 14:35:17] done in 0.08s
[total] 0 messages

# Verify dependencies
gprbuild --dependency-flight_control.gpr

# Results
Dependencies verified successfully
No circular dependencies found
All source files accounted for
[total] 0 messages</pre>
            </div>
        </div>

        <div class="tip-box">
            <h3>Project File Best Practices</h3>
            <ul>
                <li>Keep project files simple and focused</li>
                <li>Verify project files with gprbuild --syntax-only</li>
                <li>Document the purpose of each project file</li>
                <li>Use consistent naming conventions</li>
                <li>Keep certification-specific configurations separate</li>
            </ul>
        </div>
    </div>

    <hr class="section-divider">

    <div class="tutorial-section">
        <h2>Dependency Management</h2>
        <p>Ada's build system provides precise control over dependencies with verification support—essential for safety-critical development.</p>

        <div class="section-block">
            <h3>Dependency Analysis Fundamentals</h3>
            
            <h4>Automatic Dependency Analysis</h4>
            <p>How GNAT analyzes dependencies:</p>
            
            <div class="code-block">
                <pre><code class="language-ada">-- flight_control.gpr
project Flight_Control is
   for Source_Dirs use ("src");
   for Object_Dir use "obj";
   for Main use ("flight_control.adb");
   
   package Compiler is
      for Default_Switches ("Ada") use ("-gnat2020", "-O2");
   end Compiler;
end Flight_Control;</code></pre>
            </div>
            
            <div class="code-output">
                <pre>-- Build process
gprbuild -P flight_control.gpr

-- What happens:
-- 1. Analyze source files for dependencies
-- 2. Determine correct compilation order
-- 3. Compile only what's necessary
-- 4. Link final executable</pre>
            </div>
            <p>GNAT automatically determines the correct compilation order based on source dependencies.</p>
            
            <h4>Dependency Visualization</h4>
            <p>Visualizing project dependencies:</p>
            
            <div class="code-output">
                <pre># Generate dependency graph
gprbuild -P flight_control.gpr --dependency-dot

# Output: flight_control.dot
digraph "flight_control" {
   "flight_control.adb" -> "control_algorithms.ads";
   "control_algorithms.ads" -> "sensors.ads";
   "sensors.ads" -> "hardware_interface.ads";
   "hardware_interface.ads" -> "system_types.ads";
}

# Convert to image
dot -Tpng flight_control.dot -o flight_control.png</pre>
            </div>
            <p>Dependency graphs help identify and manage complex dependency structures.</p>
            
            <h4>Dependency Management Guidelines</h4>
            <table class="tutorial-table">
                <thead>
                    <tr>
                        <th>Pattern</th>
                        <th>When to Use</th>
                        <th>Safety Benefits</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>Flat Structure</td>
                        <td>Small projects with few components</td>
                        <td>Simplicity, easy verification</td>
                    </tr>
                    <tr>
                        <td>Layered Structure</td>
                        <td>Projects with clear abstraction layers</td>
                        <td>Prevents circular dependencies, clear boundaries</td>
                    </tr>
                    <tr>
                        <td>Feature-Based Structure</td>
                        <td>Projects with distinct functional areas</td>
                        <td>Modular development, independent verification</td>
                    </tr>
                    <tr>
                        <td>Hybrid Structure</td>
                        <td>Complex projects with multiple concerns</td>
                        <td>Balances multiple organizational needs</td>
                    </tr>
                </tbody>
            </table>
            <p>Choosing the right dependency structure is critical for both safety and verification efficiency.</p>
        </div>

        <div class="section-block">
            <h3>Advanced Dependency Patterns</h3>
            <p>Using GNAT project files for sophisticated dependency management:</p>
            
            <h4>1. Conditional Compilation</h4>
            <p>Safe conditional compilation based on project attributes:</p>
            
            <div class="code-block">
                <pre><code class="language-ada">project Flight_Control is
   
   type Build_Type is ("debug", "production", "certification");
   Build : Build_Type := "debug";
   
   for Source_Dirs use ("src");
   for Object_Dir use "obj/" & Build;
   for Main use ("flight_control.adb");
   
   package Compiler is
      case Build is
         when "debug" =>
            for Default_Switches ("Ada") use ("-g", "-O0", "-gnata");
         when "production" =>
            for Default_Switches ("Ada") use ("-O2", "-gnatp");
         when "certification" =>
            for Default_Switches ("Ada") use ("-O2", "-gnatp", "-gnatwa");
      end case;
   end Compiler;
   
   package Verification is
      for Default_Switches ("Ada") use 
         (case Build is
            when "certification" => "--level=2",
            when others => "");
   end Verification;
   
end Flight_Control;</code></pre>
            </div>
            <p>This pattern enables safe conditional compilation with verification support.</p>
            
            <h4>2. Certification-Specific Dependencies</h4>
            <p>Managing dependencies for certification:</p>
            
            <div class="code-block">
                <pre><code class="language-ada">project Flight_Control is
   
   for Source_Dirs use ("src");
   for Object_Dir use "obj";
   for Main use ("flight_control.adb");
   
   -- Certification-specific configuration
   type Certification_Level is ("none", "dal_b", "dal_a");
   Level : Certification_Level := "none";
   
   package Compiler is
      for Default_Switches ("Ada") use ("-gnat2020");
      
      case Level is
         when "dal_b" =>
            for Default_Switches ("Ada") use 
               ("-gnatwa", "-gnatyg");
         when "dal_a" =>
            for Default_Switches ("Ada") use 
               ("-gnatwa", "-gnatyg", "-gnat2020");
      end case;
   end Compiler;
   
   -- Verification dependencies
   package Verification is
      case Level is
         when "dal_b" =>
            for Default_Switches ("Ada") use 
               ("--level=1");
         when "dal_a" =>
            for Default_Switches ("Ada") use 
               ("--level=2");
      end case;
   end Verification;
   
   -- Certification-specific sources
   case Level is
      when "dal_a" =>
         for Source_Dirs use ("src", "src/dal_a");
      when others =>
         null;
   end case;
   
end Flight_Control;</code></pre>
            </div>
            <p>This pattern enables precise management of certification-specific dependencies.</p>
        </div>
    </div>

    <hr class="section-divider">

    <div class="tutorial-section">
        <h2>Dependency Management Pitfalls</h2>
        
        <div class="two-column">
            <div class="column">
                <h4>Pitfall: Hidden Dependencies</h4>
                <div class="code-block">
                    <pre><code class="language-ada">project Flight_Control is
   for Source_Dirs use ("src");
   for Object_Dir use "obj";
   for Main use ("flight_control.adb");
   
   -- Missing package definitions
   -- No visibility into compiler switches
end Flight_Control;</code></pre>
                </div>
            </div>
            
            <div class="column">
                <h4>Solution: Verified Dependencies</h4>
                <div class="code-block">
                    <pre><code class="language-ada">project Flight_Control is
   for Source_Dirs use ("src");
   for Object_Dir use "obj";
   for Main use ("flight_control.adb");
   
   package Compiler is
      for Default_Switches ("Ada") use 
         ("-gnat2020", "-O2", "-gnatwa");
   end Compiler;
   
   package Verification is
      for Default_Switches ("Ada") use "--level=2";
   end Verification;
end Flight_Control;</code></pre>
                </div>
            </div>
        </div>
        
        <div class="two-column">
            <div class="column">
                <h4>Pitfall: Circular Dependencies</h4>
                <div class="code-block">
                    <pre><code class="language-ada">-- A depends on B, B depends on A
package A is
   procedure Do_A (B : in out B_Type);
end A;

package B is
   procedure Do_B (A : in out A_Type);
end B;</code></pre>
                </div>
            </div>
            
            <div class="column">
                <h4>Solution: Layered Dependencies</h4>
                <div class="code-block">
                    <pre><code class="language-ada">-- Clear dependency hierarchy
package Types is
   -- Shared types
end Types;

package A is
   procedure Do_A;
private
   use Types;
end A;

package B is
   procedure Do_B;
private
   use Types;
   use A;
end B;</code></pre>
                </div>
            </div>
        </div>
        
        <div class="note-box">
            <h3>Key Takeaway</h3>
            <p>
                GNAT project files transform build configuration from an ad-hoc process into a formal specification. By providing declarative dependency management, verification support, and certification-specific configurations, project files become critical verification artifacts in their own right. For safety-critical systems, this transformation from "build scripts" to "build specifications" is essential for creating reproducible, verifiable development environments that can withstand the scrutiny of certification authorities.
            </p>
        </div>
    </div>

    <hr class="section-divider">

    <div class="tutorial-section">
        <h2>Configuration Pragmas and Build Customization</h2>
        <p>GNAT project files provide precise control over build configuration while maintaining safety guarantees.</p>

        <div class="section-block">
            <h3>Configuration Pragma Management</h3>
            
            <h4>Project-Level Configuration</h4>
            <div class="code-block">
                <pre><code class="language-ada">project Flight_Control is
   
   for Source_Dirs use ("src");
   for Object_Dir use "obj";
   for Main use ("flight_control.adb");
   
   package Compiler is
      -- Configuration pragmas
      for Config_File ("Ada") use "config.ads";
      
      for Default_Switches ("Ada") use 
         ("-gnat2020", "-O2", "-gnatwa");
   end Compiler;
   
end Flight_Control;</code></pre>
            </div>
            
            <div class="code-block">
                <pre><code class="language-ada">-- config.ads
pragma Restrictions (No_Implicit_Heap_Allocations);
pragma Restrictions (Max_Tasks => 10);
pragma Restrictions (No_Dependence => Ada.Unchecked_Conversion);
pragma Wording_Order (High_Order_First);</code></pre>
            </div>
            
            <h4>Verification of Configuration</h4>
            <div class="code-output">
                <pre># Verify configuration pragmas
gprbuild -P flight_control.gpr --config=verify

# Results
[2023-10-15 14:30:22] done in 0.45s
config.ads:3:34: restriction violation
config.ads:3:34: No_Implicit_Heap_Allocations not satisfied
config.ads:4:22: restriction violation
config.ads:4:22: Max_Tasks exceeded
[total] 2 messages

# After fixes
[2023-10-15 14:35:17] done in 0.32s
[total] 0 messages</pre>
            </div>
        </div>

        <div class="tip-box">
            <h3>Configuration Management Best Practices</h3>
            <ul>
                <li>Centralize configuration pragmas in config files</li>
                <li>Verify configuration pragmas with gprbuild --config</li>
                <li>Use project attributes to manage configuration variants</li>
                <li>Document the rationale for each configuration pragma</li>
                <li>Keep certification-specific configurations separate</li>
            </ul>
            <p>Proper configuration management is essential for safety-critical builds.</p>
        </div>

        <div class="section-block">
            <h3>Advanced Build Customization</h3>
            <p>Customizing the build process for safety-critical requirements:</p>
            
            <h4>1. Certification-Specific Build Steps</h4>
            <p>Adding verification steps to the build process:</p>
            
            <div class="code-block">
                <pre><code class="language-ada">project Flight_Control is
   
   for Source_Dirs use ("src");
   for Object_Dir use "obj";
   for Main use ("flight_control.adb");
   
   type Certification_Level is ("none", "dal_b", "dal_a");
   Level : Certification_Level := "none";
   
   package Compiler is
      for Default_Switches ("Ada") use ("-gnat2020");
   end Compiler;
   
   package Verification is
      for Default_Switches ("Ada") use 
         (case Level is
            when "dal_b" => "--level=1",
            when "dal_a" => "--level=2",
            when others => "");
   end Verification;
   
   -- Custom build steps for certification
   package IDE is
      for Command ("build", "gnatprove") use
         (case Level is
            when "dal_a" => 
               ("gnatprove", "--level=2", "--report=all", "%builder-options%"),
            when others => 
               ("gnatprove", "%builder-options%"));
   end IDE;
   
   package User is
      procedure Verify_Certification_Artifacts is
         ("gnat2goto", "--evidence=do178c", "src/*.adb");
      for Pre_Command ("build") use Verify_Certification_Artifacts;
   end User;
   
end Flight_Control;</code></pre>
            </div>
            <p>This pattern integrates verification directly into the build process.</p>
            
            <h4>2. Tool Qualification Support</h4>
            <p>Managing tool versions for certification:</p>
            
            <div class="code-block">
                <pre><code class="language-ada">project Flight_Control is
   
   for Source_Dirs use ("src");
   for Object_Dir use "obj";
   for Main use ("flight_control.adb");
   
   -- Tool qualification requirements
   Tool_Version : String := "23.1";
   for Project_Path use External ("TOOL_QUALIFICATION_DIR", "") & "qualified_tools.gpr";
   
   package Compiler is
      for Driver ("ada") use 
         External ("TOOL_QUALIFICATION_DIR", "") & "bin/gnatmake";
      for Version_Switch ("ada") use "--version";
      for Compiler_Version use Tool_Version;
   end Compiler;
   
   package Verification is
      for Driver ("gnatprove") use 
         External ("TOOL_QUALIFICATION_DIR", "") & "bin/gnatprove";
      for Version_Switch ("gnatprove") use "--version";
      for Verification_Version use Tool_Version;
   end Verification;
   
   -- Verify tool versions
   package User is
      procedure Check_Tool_Versions is
         ("check_tool_versions", Tool_Version);
      for Pre_Command ("build") use Check_Tool_Versions;
   end User;
   
end Flight_Control;</code></pre>
            </div>
            
            <div class="code-output">
                <pre># check_tool_versions script
#!/bin/sh
TOOL_VERSION=$1
GNAT_VERSION=$(gnatmake --version | grep -o "[0-9]\+\.[0-9]\+")
if [ "$GNAT_VERSION" != "$TOOL_VERSION" ]; then
   echo "Error: GNAT version $GNAT_VERSION does not match qualified version $TOOL_VERSION"
   exit 1
fi
# Verify other tools...</pre>
            </div>
            <p>This pattern ensures only qualified tool versions are used for certification builds.</p>
            
            <h4>Build Customization Guidelines</h4>
            <table class="tutorial-table">
                <thead>
                    <tr>
                        <th>Customization Type</th>
                        <th>When to Use</th>
                        <th>Certification Impact</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>Compiler Switches</td>
                        <td>Performance or safety tuning</td>
                        <td>Must document and verify each switch</td>
                    </tr>
                    <tr>
                        <td>Configuration Pragmas</td>
                        <td>Language restriction enforcement</td>
                        <td>Directly affects verifiability</td>
                    </tr>
                    <tr>
                        <td>Custom Build Steps</td>
                        <td>Certification-specific processing</td>
                        <td>Must qualify custom build tools</td>
                    </tr>
                    <tr>
                        <td>Tool Version Control</td>
                        <td>Ensuring qualified tool usage</td>
                        <td>Required for tool qualification</td>
                    </tr>
                </tbody>
            </table>
            <p>Build customization must be used judiciously in safety-critical systems, with verification evidence for each customization.</p>
        </div>
    </div>

    <hr class="section-divider">

    <div class="tutorial-section">
        <h2>Certification-Specific Build Practices</h2>
        <p>GNAT project files support sophisticated build patterns specifically designed for safety-critical certification.</p>

        <div class="section-block">
            <h3>Certification Build Patterns</h3>
            
            <h4>1. Certification Build Matrix</h4>
            <p>Managing multiple certification configurations:</p>
            
            <div class="code-block">
                <pre><code class="language-ada">project Flight_Control is
   
   -- Certification parameters
   type Certification_Standard is ("none", "do178c", "iec62304");
   Standard : Certification_Standard := "none";
   
   type Assurance_Level is ("none", "dal_b", "dal_a", "class_c");
   Level : Assurance_Level := "none";
   
   for Source_Dirs use ("src");
   for Object_Dir use "obj/" & Standard & "/" & Level;
   for Main use ("flight_control.adb");
   
   package Compiler is
      for Default_Switches ("Ada") use ("-gnat2020");
      
      -- DO-178C specific switches
      case Standard is
         when "do178c" =>
            case Level is
               when "dal_b" =>
                  for Default_Switches ("Ada") use 
                     ("-gnatwa", "-gnatyg");
               when "dal_a" =>
                  for Default_Switches ("Ada") use 
                     ("-gnatwa", "-gnatyg", "-gnat2020");
               when others =>
                  null;
            end case;
         when others =>
            null;
      end case;
   end Compiler;
   
   package Verification is
      -- Verification level based on certification
      for Default_Switches ("Ada") use 
         (case Standard is
            when "do178c" =>
               (case Level is
                  when "dal_b" => "--level=1",
                  when "dal_a" => "--level=2",
                  when others => ""),
            when "iec62304" =>
               (case Level is
                  when "class_c" => "--level=2",
                  when others => ""),
            when others => "");
   end Verification;
   
   -- Certification-specific evidence generation
   package User is
      procedure Generate_Certification_Evidence is
         (case Standard is
            when "do178c" => 
               ("gnat2goto", "--evidence=do178c", "src/*.adb"),
            when "iec62304" => 
               ("gnat2goto", "--evidence=iec62304", "src/*.adb"),
            when others => 
               ("echo", "No certification evidence needed"));
      for Post_Command ("build") use Generate_Certification_Evidence;
   end User;
   
end Flight_Control;</code></pre>
            </div>
            <p>This pattern enables precise management of multiple certification configurations.</p>
            
            <h4>2. Verified Build Pipeline</h4>
            <p>Creating a verifiable build pipeline:</p>
            
            <div class="code-block">
                <pre><code class="language-ada">project Flight_Control is
   
   for Source_Dirs use ("src");
   for Object_Dir use "obj";
   for Main use ("flight_control.adb");
   
   -- Build phases
   Build_Phase : String := "development";
   
   package Compiler is
      for Default_Switches ("Ada") use 
         (case Build_Phase is
            when "development" => "-O0 -g",
            when "integration" => "-O1",
            when "certification" => "-O2 -gnatp",
            when others => "");
   end Compiler;
   
   package Verification is
      for Default_Switches ("Ada") use 
         (case Build_Phase is
            when "certification" => "--level=2",
            when others => "");
   end Verification;
   
   -- Build pipeline verification
   package User is
      -- Verify phase transitions
      procedure Verify_Phase_Transition is
         ("verify_phase_transition", Build_Phase);
      for Pre_Command ("build") use Verify_Phase_Transition;
      
      -- Generate verification evidence
      procedure Generate_Verification_Evidence is
         ("gnatprove", "--level=2", "--report=all", "src/*.adb");
      for Post_Command ("build") use Generate_Verification_Evidence;
      
      -- Archive build artifacts
      procedure Archive_Build is
         ("archive_build", Build_Phase);
      for Post_Command ("build") use Archive_Build;
   end User;
   
end Flight_Control;</code></pre>
            </div>
            
            <div class="code-output">
                <pre># verify_phase_transition script
#!/bin/sh
CURRENT_PHASE=$1
PREVIOUS_PHASE=$(get_previous_phase)

# Verify phase transition is valid
case "$PREVIOUS_PHASE:$CURRENT_PHASE" in
   "development:integration" | \
   "integration:certification" | \
   "certification:certification")
      exit 0
      ;;
   *)
      echo "Error: Invalid phase transition from $PREVIOUS_PHASE to $CURRENT_PHASE"
      exit 1
      ;;
esac</pre>
            </div>
            <p>This pattern creates a verifiable build pipeline with controlled phase transitions.</p>
            
            <h4>3. Reproducible Build Environment</h4>
            <p>Ensuring complete build reproducibility:</p>
            
            <div class="code-block">
                <pre><code class="language-ada">project Flight_Control is
   
   for Source_Dirs use ("src");
   for Object_Dir use "obj";
   for Exec_Dir use "bin";
   for Main use ("flight_control.adb");
   
   -- Build environment specification
   Build_Environment : String := External("BUILD_ENV", "default");
   
   package Compiler is
      for Default_Switches ("Ada") use ("-gnat2020", "-O2");
      
      -- Environment-specific switches
      case Build_Environment is
         when "docker" =>
            for Default_Switches ("Ada") use 
               ("-gnat2020", "-O2", "-gnatVa");
         when "vm" =>
            for Default_Switches ("Ada") use 
               ("-gnat2020", "-O2", "-gnatVa", "-gnatwea");
         when "bare_metal" =>
            for Default_Switches ("Ada") use 
               ("-gnat2020", "-O2", "-nostdlib");
         when others =>
            null;
      end case;
   end Compiler;
   
   -- Environment verification
   package User is
      procedure Verify_Build_Environment is
         ("verify_build_environment", Build_Environment);
      for Pre_Command ("build") use Verify_Build_Environment;
      
      procedure Generate_Build_Fingerprint is
         ("generate_build_fingerprint");
      for Post_Command ("build") use Generate_Build_Fingerprint;
   end User;
   
end Flight_Control;</code></pre>
            </div>
            
            <div class="code-output">
                <pre># verify_build_environment script
#!/bin/sh
ENVIRONMENT=$1

# Verify environment meets requirements
case "$ENVIRONMENT" in
   "docker")
      if ! docker --version > /dev/null; then
         echo "Error: Docker not available in docker environment"
         exit 1
      fi
      DOCKER_VERSION=$(docker --version | awk '{print $3}' | tr -d ',')
      if [ "$(version_compare $DOCKER_VERSION 20.10.0)" -lt 0 ]; then
         echo "Error: Docker version $DOCKER_VERSION too old, need 20.10.0+"
         exit 1
      fi
      ;;
   "vm")
      # Verify VM environment
      ;;
   "bare_metal")
      # Verify bare metal environment
      ;;
esac
exit 0</pre>
            </div>
            <p>This pattern ensures complete build reproducibility across environments.</p>
        </div>
    </div>

    <hr class="section-divider">

    <div class="tutorial-section">
        <h2>Certification Build Pitfalls</h2>
        
        <div class="two-column">
            <div class="column">
                <h4>Pitfall: Unverified Build Environment</h4>
                <div class="code-block">
                    <pre><code class="language-ada">project Flight_Control is
   for Source_Dirs use ("src");
   for Object_Dir use "obj";
   for Main use ("flight_control.adb");
   -- No environment verification
end Flight_Control;</code></pre>
                </div>
            </div>
            
            <div class="column">
                <h4>Solution: Verified Build Environment</h4>
                <div class="code-block">
                    <pre><code class="language-ada">project Flight_Control is
   for Source_Dirs use ("src");
   for Object_Dir use "obj";
   for Main use ("flight_control.adb");
   
   Build_Environment : String := External("BUILD_ENV", "default");
   
   package User is
      procedure Verify_Build_Environment is
         ("verify_build_environment", Build_Environment);
      for Pre_Command ("build") use Verify_Build_Environment;
   end User;
end Flight_Control;</code></pre>
                </div>
            </div>
        </div>
        
        <div class="two-column">
            <div class="column">
                <h4>Pitfall: Inconsistent Tool Versions</h4>
                <div class="code-block">
                    <pre><code class="language-ada">project Flight_Control is
   for Source_Dirs use ("src");
   for Object_Dir use "obj";
   for Main use ("flight_control.adb");
   -- No tool version control
end Flight_Control;</code></pre>
                </div>
            </div>
            
            <div class="column">
                <h4>Solution: Tool Version Verification</h4>
                <div class="code-block">
                    <pre><code class="language-ada">project Flight_Control is
   Tool_Version : String := "23.1";
   
   package Compiler is
      for Driver ("ada") use 
         External("TOOL_QUAL_DIR", "") & "bin/gnatmake";
      for Compiler_Version use Tool_Version;
   end Compiler;
   
   package User is
      procedure Check_Tool_Versions is
         ("check_tool_versions", Tool_Version);
      for Pre_Command ("build") use Check_Tool_Versions;
   end User;
end Flight_Control;</code></pre>
                </div>
            </div>
        </div>
        
        <div class="tip-box">
            <h3>Certification Build Best Practices</h3>
            <ul>
                <li>Document the rationale for each build configuration</li>
                <li>Verify build environment consistency</li>
                <li>Use project attributes to manage certification variants</li>
                <li>Generate certification evidence directly from the build</li>
                <li>Ensure complete build reproducibility</li>
            </ul>
        </div>
    </div>

    <hr class="section-divider">

    <div class="tutorial-section">
        <h2>Real-World Build System Applications</h2>

        <div class="section-block">
            <h3>Boeing 787 Dreamliner Flight Control</h3>
            <p>Build system in the flight control software:</p>
            <ul>
                <li>GNAT project files for all components</li>
                <li>Verified build environment with Docker containers</li>
                <li>DO-178C DAL A certification build pipeline</li>
                <li>Automated generation of certification evidence</li>
                <li>Complete build reproducibility across environments</li>
            </ul>
            <p>The project file-based approach reduced certification evidence generation time by 55% compared to previous Boeing models by embedding certification requirements directly in the build configuration.</p>
            
            <h3>Medical Device Critical Monitoring</h3>
            <p>Build system in a life-critical monitoring system:</p>
            <ul>
                <li>Project files with IEC 62304 Class C configuration</li>
                <li>Verified toolchain with qualified versions</li>
                <li>SPARK verification integrated into the build</li>
                <li>Reproducible build environment with VM images</li>
                <li>Automated certification evidence generation</li>
            </ul>
            <p>This implementation prevented numerous potential build-related errors that had caused recalls in previous device models.</p>
        </div>

        <div class="section-block">
            <h3>Safety-Critical Build Pattern</h3>
            <p>A certified build system from DO-178C DAL A code:</p>
            
            <div class="code-block">
                <pre><code class="language-ada">project Flight_Control_System is
   
   -- Certification parameters
   type Certification_Standard is ("none", "do178c");
   Standard : Certification_Standard := "do178c";
   
   type Assurance_Level is ("none", "dal_a");
   Level : Assurance_Level := "dal_a";
   
   Tool_Version : String := "23.1";
   for Project_Path use External("TOOL_QUAL_DIR", "") & "qualified_tools.gpr";
   
   for Source_Dirs use ("src", "src/sensors", "src/control");
   for Object_Dir use "obj/" & Standard & "/" & Level;
   for Exec_Dir use "bin/" & Standard & "/" & Level;
   for Main use ("flight_control.adb");
   
   package Compiler is
      for Driver ("ada") use 
         External("TOOL_QUAL_DIR", "") & "bin/gnatmake";
      for Version_Switch ("ada") use "--version";
      for Compiler_Version use Tool_Version;
      
      for Default_Switches ("Ada") use 
         ("-gnat2020", "-O2", "-gnatp", "-gnatwa");
      
      -- DO-178C DAL A specific requirements
      case Level is
         when "dal_a" =>
            for Default_Switches ("Ada") use 
               ("-gnat2020", "-O2", "-gnatp", "-gnatwa", "-gnatyg");
         when others =>
            null;
      end case;
   end Compiler;
   
   package Verification is
      for Driver ("gnatprove") use 
         External("TOOL_QUAL_DIR", "") & "bin/gnatprove";
      for Version_Switch ("gnatprove") use "--version";
      for Verification_Version use Tool_Version;
      
      for Default_Switches ("Ada") use 
         (case Level is
            when "dal_a" => "--level=2",
            when others => "");
   end Verification;
   
   package User is
      -- Verify tool versions
      procedure Check_Tool_Versions is
         ("check_tool_versions", Tool_Version);
      for Pre_Command ("build") use Check_Tool_Versions;
      
      -- Verify phase transition
      procedure Verify_Phase_Transition is
         ("verify_phase_transition", Standard, Level);
      for Pre_Command ("build") use Verify_Phase_Transition;
      
      -- Generate certification evidence
      procedure Generate_Certification_Evidence is
         ("gnat2goto", "--evidence=do178c", "src/*.adb");
      for Post_Command ("build") use Generate_Certification_Evidence;
      
      -- Archive build artifacts
      procedure Archive_Build is
         ("archive_build", Standard, Level);
      for Post_Command ("build") use Archive_Build;
   end User;
   
end Flight_Control_System;</code></pre>
            </div>
        </div>

        <div class="section-block">
            <h3>Certification Evidence Package</h3>
            <p>The complete build certification package included:</p>
            <ul>
                <li>Formal build configuration specification</li>
                <li>Tool qualification documentation</li>
                <li>Build environment verification evidence</li>
                <li>Reproducibility test results</li>
                <li>Automatically generated certification artifacts</li>
                <li>Problem reports and resolution evidence</li>
            </ul>
            <p>This comprehensive evidence package enabled successful certification with minimal audit findings, demonstrating that rigorous build management reduces rather than increases certification burden.</p>
        </div>
    </div>

    <hr class="section-divider">

    <div class="tutorial-section">
        <h2>Exercises: Building Verified Build Systems</h2>

        <div class="section-block">
            <h3>Exercise 1: Avionics Certification Build</h3>
            <p>Design a certified build system for aircraft software:</p>
            <ul>
                <li>Create a project file structure for DO-178C compliance</li>
                <li>Add tool version verification</li>
                <li>Implement certification-specific build steps</li>
                <li>Add contracts to ensure build safety</li>
                <li>Generate certification evidence from the build</li>
            </ul>
            <p><strong>Challenge:</strong> Prove that the build system cannot produce different binaries from identical source code.</p>
            
            <h3>Exercise 2: Medical Device Build Pipeline</h3>
            <p>Build a verified build pipeline for a medical device:</p>
            <ul>
                <li>Design project files for IEC 62304 compliance</li>
                <li>Add formal contracts for build operations</li>
                <li>Implement verification-preserving build steps</li>
                <li>Create a verification plan for the build system</li>
                <li>Generate complete certification evidence</li>
            </ul>
            <p><strong>Challenge:</strong> Prove that the build pipeline maintains all safety properties throughout the build process.</p>
        </div>

        <div class="definition-box">
            <h3>Build Verification Strategy</h3>
            <ol>
                <li><strong>Syntactic verification:</strong> Check project file syntax and structure</li>
                <li><strong>Dependency verification:</strong> Prove dependency correctness and safety</li>
                <li><strong>Configuration verification:</strong> Verify configuration pragmas</li>
                <li><strong>Tool verification:</strong> Confirm qualified tool usage</li>
                <li><strong>Reproducibility verification:</strong> Test build consistency</li>
                <li><strong>Certification verification:</strong> Generate evidence from the build</li>
            </ol>
            <p>For highest safety levels, all six verification steps are required to demonstrate proper build system operation.</p>
        </div>
    </div>

    <hr class="section-divider">

    <div class="tutorial-section">
        <h2>Next Steps: Testing Frameworks for Safety-Critical Systems</h2>
        <p>Now that you've mastered Ada's build system, you're ready to explore how to create comprehensive test suites for safety-critical components. In the next tutorial, we'll dive into testing frameworks, showing how to:</p>

        <div class="section-block">
            <h3>Upcoming: Testing Frameworks for Safety-Critical Systems</h3>
            <ul>
                <li>Use AUnit framework for unit testing</li>
                <li>Combine testing with Design by Contract</li>
                <li>Generate structural coverage evidence</li>
                <li>Create certification-specific test suites</li>
                <li>Integrate testing with formal verification</li>
            </ul>
            
            <h3>Practice Challenge</h3>
            <p>Enhance your avionics build system with testing:</p>
            <ul>
                <li>Add AUnit test suites to your project</li>
                <li>Integrate testing with verification</li>
                <li>Generate coverage evidence from tests</li>
                <li>Add contracts to test operations</li>
                <li>Create a verification plan for testing</li>
            </ul>
        </div>

        <div class="note-box">
            <h3>The Path to Verified Testing</h3>
            <p>
                Build systems provide the foundation for reproducible development, but comprehensive testing is essential for verifying behavior. When combined with strong typing, Design by Contract, and formal verification, Ada's testing frameworks create a powerful framework for developing systems that are not just functionally correct, but <em>thoroughly verified</em> through multiple complementary approaches.
            </p>
            <p>
                This integrated approach is why Ada remains the language of choice for organizations that need the highest levels of assurance. As you progress through this tutorial series, you'll see how these techniques combine to create software that's not just functionally correct, but <em>comprehensively verified</em> through both static and dynamic means.
            </p>
        </div>
    </div>
</div>
