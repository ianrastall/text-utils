<!DOCTYPE html>
<html lang="en" data-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Font Chooser - Text Utilities</title>
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link rel="stylesheet" href="css/style.css">
    <style>
        .tool-layout {
            display: grid;
            grid-template-columns: 320px 1fr;
            gap: 1rem;
        }
        .panel {
            background: var(--bg-tertiary);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 1rem;
        }
        .panel h4 {
            margin-bottom: 0.75rem;
            font-size: 1rem;
            display: flex;
            align-items: center;
            gap: 0.35rem;
            color: var(--text-primary);
        }
        .font-list {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
            max-height: 520px;
            overflow-y: auto;
        }
        .font-item {
            width: 100%;
            text-align: left;
            padding: 0.75rem;
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 6px;
            color: var(--text-primary);
            cursor: pointer;
            transition: all 0.15s;
        }
        .font-item:hover {
            border-color: var(--accent);
            transform: translateY(-1px);
        }
        .font-item.active {
            border-color: var(--accent);
            box-shadow: 0 0 0 1px var(--accent);
        }
        .font-name {
            font-weight: 600;
            margin-bottom: 0.35rem;
        }
        .font-meta {
            display: flex;
            flex-wrap: wrap;
            gap: 0.35rem;
            font-size: 0.8rem;
            color: var(--text-secondary);
        }
        .pill {
            padding: 0.2rem 0.55rem;
            border-radius: 999px;
            background: var(--bg-tertiary);
            border: 1px solid var(--border-color);
            color: var(--text-secondary);
        }
        .pill.accent {
            border-color: var(--accent);
            color: var(--accent);
        }
        .settings-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
            gap: 1rem;
        }
        .stacked-inputs {
            display: flex;
            gap: 0.5rem;
            align-items: center;
        }
        .stacked-inputs input[type="range"] {
            flex: 1;
        }
        .preview-window {
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 1rem;
            background: var(--bg-secondary);
            transition: all 0.2s;
        }
        .preview-window[data-device="tablet"] {
            max-width: 820px;
        }
        .preview-window[data-device="mobile"] {
            max-width: 480px;
        }
        .preview-window[data-device="desktop"] {
            max-width: 100%;
        }
        .preview-content {
            display: flex;
            flex-direction: column;
            gap: 0.65rem;
            word-break: break-word;
        }
        .code-tabs {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 6px;
            padding: 0.35rem;
        }
        .code-tab {
            border: none;
            background: transparent;
            color: var(--text-secondary);
            padding: 0.4rem 0.75rem;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.15s;
        }
        .code-tab.active {
            background: var(--bg-tertiary);
            color: var(--accent);
            border: 1px solid var(--border-color);
        }
        .code-panel {
            display: none;
        }
        .code-panel.active {
            display: block;
        }
        .code-block {
            background: var(--bg-tertiary);
            border: 1px solid var(--border-color);
            border-radius: 6px;
            padding: 1rem;
            white-space: pre;
            overflow-x: auto;
            font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
            font-size: 0.85rem;
            position: relative;
        }
        .copy-chip {
            position: absolute;
            top: 0.5rem;
            right: 0.5rem;
        }
        .contrast-pill {
            display: inline-flex;
            align-items: center;
            gap: 0.35rem;
            border: 1px solid var(--border-color);
            border-radius: 999px;
            padding: 0.35rem 0.75rem;
            font-size: 0.85rem;
        }
        .contrast-pass {
            color: var(--success);
        }
        .contrast-fail {
            color: var(--error);
        }
        .help-text {
            color: var(--text-secondary);
            font-size: 0.9rem;
        }
        @media (max-width: 1024px) {
            .tool-layout {
                grid-template-columns: 1fr;
            }
            .font-list {
                max-height: 320px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <div class="logo">
                <span class="material-icons">text_snippet</span>
                <a href="index.html" style="color: inherit; text-decoration: none;">
                    <span>Text Utilities</span>
                </a>
            </div>
            <div class="controls">
                <div class="accent-selector">
                    <span class="material-icons">palette</span>
                    <select id="accentColor" class="color-dropdown">
                        <option value="#0d9488">Teal</option>
                        <option value="#3b82f6">Blue</option>
                        <option value="#8b5cf6">Purple</option>
                        <option value="#10b981">Emerald</option>
                        <option value="#f59e0b">Amber</option>
                        <option value="#ef4444">Red</option>
                        <option value="#ec4899">Soft Pink</option>
                        <option value="#fb7185">Coral</option>
                        <option value="#60a5fa">Cornflower</option>
                        <option value="#7c3aed">Violet</option>
                    </select>
                </div>
                <button id="themeToggle" class="btn btn-secondary">
                    <span class="material-icons">dark_mode</span>
                </button>
            </div>
        </header>

        <main>
            <div class="tool-container">
                <div class="tool-header">
                    <div class="tool-title">
                        <span class="material-icons">text_fields</span>
                        <h2>Font Chooser</h2>
                    </div>
                    <div class="tool-actions">
                        <button id="backButton" class="btn btn-secondary">
                            <span class="material-icons">arrow_back</span>
                            Back
                        </button>
                        <button id="resetButton" class="btn btn-secondary">
                            <span class="material-icons">refresh</span>
                            Reset
                        </button>
                        <button id="copyCssButton" class="btn btn-secondary">
                            <span class="material-icons">content_copy</span>
                            Copy CSS
                        </button>
                    </div>
                </div>

                <p class="tool-description">Preview Google and system fonts, check accessibility contrast, and generate production-ready CSS snippets.</p>

                <div class="tool-layout">
                    <div class="panel">
                        <h4><span class="material-icons" style="font-size: 20px;">library_books</span>Font Library</h4>
                        <div class="option-group" style="margin-bottom: 0.75rem;">
                            <label class="help-text" for="fontSource">Source</label>
                            <div style="display: flex; gap: 0.75rem; margin-top: 0.35rem;">
                                <label style="display:flex;align-items:center;gap:0.35rem; cursor: pointer;">
                                    <input type="radio" name="fontSource" id="sourceGoogle" value="google" checked>
                                    Google Fonts
                                </label>
                                <label style="display:flex;align-items:center;gap:0.35rem; cursor: pointer;">
                                    <input type="radio" name="fontSource" id="sourceSystem" value="system">
                                    System Fonts
                                </label>
                            </div>
                        </div>
                        <div class="option-group" style="margin-bottom: 0.75rem;">
                            <label class="help-text" for="fontSearch">Search</label>
                            <input type="text" id="fontSearch" placeholder="Search fonts..." autocomplete="off">
                        </div>
                        <div class="option-group" style="margin-bottom: 0.75rem;">
                            <label class="help-text" for="fontCategory">Category</label>
                            <select id="fontCategory">
                                <option value="">All Categories</option>
                                <option value="serif">Serif</option>
                                <option value="sans-serif">Sans Serif</option>
                                <option value="display">Display</option>
                                <option value="handwriting">Handwriting</option>
                                <option value="monospace">Monospace</option>
                            </select>
                        </div>
                        <div class="font-list" id="fontList">
                            <div class="help-text">Select a font to preview.</div>
                        </div>
                        <p class="help-text" style="margin-top:0.75rem;">Google Fonts are loaded on demand. System fonts use local stacks for zero network calls.</p>
                    </div>

                    <div class="panel" style="display: flex; flex-direction: column; gap: 1rem;">
                        <div>
                            <h4><span class="material-icons" style="font-size: 20px;">tune</span>Preview Settings</h4>
                            <div class="settings-grid">
                                <div class="option-group">
                                    <label for="fontSize">Font Size (px)</label>
                                    <div class="stacked-inputs">
                                        <input type="range" id="fontSizeRange" min="10" max="72" value="18">
                                        <input type="number" id="fontSize" min="10" max="72" value="18" style="width: 80px;">
                                    </div>
                                </div>
                                <div class="option-group">
                                    <label for="fontWeight">Font Weight</label>
                                    <select id="fontWeight"></select>
                                </div>
                                <div class="option-group">
                                    <label for="lineHeight">Line Height</label>
                                    <div class="stacked-inputs">
                                        <input type="range" id="lineHeightRange" min="1" max="3" step="0.05" value="1.5">
                                        <input type="number" id="lineHeight" min="1" max="3" step="0.05" value="1.5" style="width: 80px;">
                                    </div>
                                </div>
                                <div class="option-group">
                                    <label for="letterSpacing">Letter Spacing (px)</label>
                                    <div class="stacked-inputs">
                                        <input type="range" id="letterSpacingRange" min="-2" max="8" step="0.1" value="0">
                                        <input type="number" id="letterSpacing" min="-2" max="8" step="0.1" value="0" style="width: 80px;">
                                    </div>
                                </div>
                                <div class="option-group">
                                    <label for="textColor">Text Color</label>
                                    <div class="stacked-inputs">
                                        <input type="color" id="textColor" value="#e0e0e0" style="width: 44px; padding: 0;">
                                        <input type="text" id="textColorHex" value="#e0e0e0">
                                    </div>
                                </div>
                                <div class="option-group">
                                    <label for="bgColor">Background Color</label>
                                    <div class="stacked-inputs">
                                        <input type="color" id="bgColor" value="#101010" style="width: 44px; padding: 0;">
                                        <input type="text" id="bgColorHex" value="#101010">
                                    </div>
                                </div>
                                <div class="option-group">
                                    <label class="help-text">Contrast Ratio</label>
                                    <div id="contrastRatio" class="contrast-pill">
                                        <span class="material-icons" style="font-size: 18px;">visibility</span>
                                        <span id="contrastLabel">--</span>
                                    </div>
                                </div>
                                <div class="option-group">
                                    <label for="devicePreview">Device Preview</label>
                                    <select id="devicePreview">
                                        <option value="desktop" selected>Desktop</option>
                                        <option value="tablet">Tablet</option>
                                        <option value="mobile">Mobile</option>
                                    </select>
                                </div>
                            </div>
                        </div>

                        <div>
                            <h4><span class="material-icons" style="font-size: 20px;">article</span>Sample Text</h4>
                            <div class="settings-grid">
                                <div class="option-group">
                                    <label for="textSample">Preset</label>
                                    <select id="textSample">
                                        <option value="paragraph" selected>Paragraph</option>
                                        <option value="alphabet">Alphabet</option>
                                        <option value="headings">Headings</option>
                                        <option value="numbers">Numbers &amp; Symbols</option>
                                        <option value="custom">Custom</option>
                                    </select>
                                </div>
                            </div>
                            <div class="option-group" id="customTextContainer" style="margin-top: 0.75rem; display: none;">
                                <label for="customText">Custom Text</label>
                                <textarea id="customText" rows="2" placeholder="Enter your custom text...">The quick brown fox jumps over the lazy dog.</textarea>
                            </div>
                        </div>

                        <div>
                            <h4><span class="material-icons" style="font-size: 20px;">visibility</span>Preview</h4>
                            <div class="preview-window" id="previewWindow" data-device="desktop">
                                <div class="preview-content" id="previewContent"></div>
                            </div>
                        </div>

                        <div>
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.5rem;">
                                <h4 style="margin: 0; display: flex; align-items: center; gap: 0.35rem;"><span class="material-icons" style="font-size: 20px;">code</span>Production CSS</h4>
                                <div class="code-tabs" role="tablist">
                                    <button class="code-tab active" data-code-tab="css" aria-label="CSS">CSS</button>
                                    <button class="code-tab" data-code-tab="import" aria-label="Import">@import</button>
                                    <button class="code-tab" data-code-tab="scss" aria-label="SCSS">SCSS</button>
                                </div>
                            </div>
                            <div class="code-panel active" data-code-panel="css">
                                <pre class="code-block"><button class="btn btn-secondary btn-sm copy-chip" data-copy-target="cssCode"><span class="material-icons" style="font-size: 14px;">content_copy</span></button><code id="cssCode"></code></pre>
                            </div>
                            <div class="code-panel" data-code-panel="import">
                                <pre class="code-block"><button class="btn btn-secondary btn-sm copy-chip" data-copy-target="importCode"><span class="material-icons" style="font-size: 14px;">content_copy</span></button><code id="importCode"></code></pre>
                            </div>
                            <div class="code-panel" data-code-panel="scss">
                                <pre class="code-block"><button class="btn btn-secondary btn-sm copy-chip" data-copy-target="scssCode"><span class="material-icons" style="font-size: 14px;">content_copy</span></button><code id="scssCode"></code></pre>
                            </div>
                        </div>
                    </div>

                    <div class="status-bar">
                        <div id="statusMessage" class="success">Ready</div>
                        <div id="toolStats">Select a font to begin</div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <link id="fontLoader" rel="stylesheet" href="">
    <script src="js/theme.js"></script>
    <script>
        'use strict';

        const fontSources = {
            google: [
                { name: 'Inter', category: 'sans-serif', weights: [400, 500, 600, 700] },
                { name: 'Poppins', category: 'sans-serif', weights: [400, 500, 600, 700] },
                { name: 'Space Grotesk', category: 'sans-serif', weights: [400, 500, 600, 700] },
                { name: 'Manrope', category: 'sans-serif', weights: [400, 500, 600, 700] },
                { name: 'Roboto Slab', category: 'serif', weights: [400, 500, 700] },
                { name: 'Merriweather', category: 'serif', weights: [400, 700] },
                { name: 'Playfair Display', category: 'serif', weights: [400, 600, 700] },
                { name: 'Source Code Pro', category: 'monospace', weights: [400, 500, 600, 700] },
                { name: 'Fira Code', category: 'monospace', weights: [400, 500, 600, 700] },
                { name: 'Patrick Hand', category: 'handwriting', weights: [400] },
                { name: 'Oswald', category: 'display', weights: [400, 500, 600, 700] }
            ],
            system: [
                { name: 'System UI', category: 'sans-serif', stack: "-apple-system, BlinkMacSystemFont, 'Segoe UI', system-ui, sans-serif", weights: [400, 600, 700] },
                { name: 'Helvetica', category: 'sans-serif', stack: "'Helvetica Neue', Helvetica, Arial, sans-serif", weights: [400, 700] },
                { name: 'Georgia', category: 'serif', stack: "Georgia, 'Times New Roman', serif", weights: [400, 700] },
                { name: 'Times', category: 'serif', stack: "Times, 'Times New Roman', serif", weights: [400, 700] },
                { name: 'Trebuchet MS', category: 'sans-serif', stack: "'Trebuchet MS', 'Segoe UI', sans-serif", weights: [400, 700] },
                { name: 'Courier New', category: 'monospace', stack: "'Courier New', Courier, monospace", weights: [400, 700] }
            ]
        };

        const fallbackByCategory = {
            'sans-serif': 'Arial, sans-serif',
            'serif': 'Georgia, serif',
            'display': 'Arial, sans-serif',
            'handwriting': 'cursive',
            'monospace': 'monospace'
        };

        const samples = {
            paragraph: `<p>The quick brown fox jumps over the lazy dog. Pack my box with five dozen liquor jugs.</p><p>Typography shapes voice. Good fonts balance readability, tone, and personality.</p>`,
            alphabet: `<p>ABCDEFGHIJKLMNOPQRSTUVWXYZ</p><p>abcdefghijklmnopqrstuvwxyz</p>`,
            headings: `<h1>Heading One</h1><h2>Heading Two</h2><h3>Heading Three</h3><p>Supporting body copy for hierarchy preview.</p>`,
            numbers: `<p>0123456789</p><p>!@#$%^&amp;*()[]{}&lt;&gt;/?;:'"</p>`,
            custom: ''
        };

        const fontListEl = document.getElementById('fontList');
        const fontSearchEl = document.getElementById('fontSearch');
        const fontCategoryEl = document.getElementById('fontCategory');
        const fontWeightEl = document.getElementById('fontWeight');
        const fontSizeRangeEl = document.getElementById('fontSizeRange');
        const fontSizeEl = document.getElementById('fontSize');
        const lineHeightRangeEl = document.getElementById('lineHeightRange');
        const lineHeightEl = document.getElementById('lineHeight');
        const letterSpacingRangeEl = document.getElementById('letterSpacingRange');
        const letterSpacingEl = document.getElementById('letterSpacing');
        const textColorEl = document.getElementById('textColor');
        const textColorHexEl = document.getElementById('textColorHex');
        const bgColorEl = document.getElementById('bgColor');
        const bgColorHexEl = document.getElementById('bgColorHex');
        const textSampleEl = document.getElementById('textSample');
        const customTextContainer = document.getElementById('customTextContainer');
        const customTextEl = document.getElementById('customText');
        const previewWindowEl = document.getElementById('previewWindow');
        const previewContentEl = document.getElementById('previewContent');
        const devicePreviewEl = document.getElementById('devicePreview');
        const contrastLabel = document.getElementById('contrastLabel');
        const cssCodeEl = document.getElementById('cssCode');
        const importCodeEl = document.getElementById('importCode');
        const scssCodeEl = document.getElementById('scssCode');
        const statusMessage = document.getElementById('statusMessage');
        const toolStats = document.getElementById('toolStats');
        const codeTabs = document.querySelectorAll('[data-code-tab]');
        const codePanels = document.querySelectorAll('[data-code-panel]');

        let state = {
            source: 'google',
            font: fontSources.google[0],
            weight: 400,
            size: 18,
            lineHeight: 1.5,
            letterSpacing: 0,
            textColor: '#e0e0e0',
            bgColor: '#101010'
        };

        function buildGoogleHref(font) {
            const family = font.name.replace(/\\s+/g, '+');
            const weights = (font.weights || [400]).join(';');
            return `https://fonts.googleapis.com/css2?family=${family}:wght@${weights}&display=swap`;
        }

        function getFontStack(font) {
            if (font.stack) return font.stack;
            const fallback = fallbackByCategory[font.category] || 'sans-serif';
            return `'${font.name}', ${fallback}`;
        }

        function loadGoogleFont(font) {
            const href = buildGoogleHref(font);
            const linkEl = document.getElementById('fontLoader');
            if (linkEl.href !== href) {
                linkEl.href = href;
            }
        }

        function renderFontList() {
            const term = fontSearchEl.value.trim().toLowerCase();
            const cat = fontCategoryEl.value;
            const fonts = fontSources[state.source];

            fontListEl.innerHTML = '';
            const filtered = fonts.filter(f => {
                const matchesTerm = !term || f.name.toLowerCase().includes(term);
                const matchesCat = !cat || f.category === cat;
                return matchesTerm && matchesCat;
            });

            if (!filtered.length) {
                fontListEl.innerHTML = '<div class="help-text">No fonts match your filters.</div>';
                return;
            }

            filtered.forEach(font => {
                const btn = document.createElement('button');
                btn.className = `font-item${font.name === state.font.name ? ' active' : ''}`;
                btn.type = 'button';
                btn.innerHTML = `
                    <div class="font-name">${font.name}</div>
                    <div class="font-meta">
                        <span class="pill accent">${state.source === 'google' ? 'Google' : 'System'}</span>
                        <span class="pill">${font.category}</span>
                        <span class="pill">${font.weights.length} weight${font.weights.length > 1 ? 's' : ''}</span>
                    </div>
                `;
                btn.addEventListener('click', () => selectFont(font));
                fontListEl.appendChild(btn);
            });
        }

        function populateWeights(font) {
            fontWeightEl.innerHTML = '';
            (font.weights || [400]).forEach(weight => {
                const option = document.createElement('option');
                option.value = weight;
                option.textContent = `${weight}`;
                fontWeightEl.appendChild(option);
            });
            if (font.weights.includes(state.weight)) {
                fontWeightEl.value = state.weight;
            } else {
                fontWeightEl.value = font.weights[0];
                state.weight = font.weights[0];
            }
        }

        function selectFont(font) {
            state.font = font;
            populateWeights(font);
            if (state.source === 'google') {
                loadGoogleFont(font);
            }
            renderFontList();
            updatePreview();
            updateCode();
            setStatus(`Loaded ${font.name} (${state.source})`);
        }

        function setStatus(message, type = 'success') {
            statusMessage.textContent = message;
            statusMessage.className = type;
        }

        function syncRange(rangeEl, numberEl, key, formatter) {
            rangeEl.addEventListener('input', () => {
                numberEl.value = rangeEl.value;
                state[key] = formatter ? formatter(rangeEl.value) : Number(rangeEl.value);
                updatePreview();
                updateCode();
            });
            numberEl.addEventListener('input', () => {
                rangeEl.value = numberEl.value;
                state[key] = formatter ? formatter(numberEl.value) : Number(numberEl.value);
                updatePreview();
                updateCode();
            });
        }

        function normalizeHex(value) {
            if (!value) return null;
            let v = value.trim();
            if (!v.startsWith('#')) v = '#' + v;
            if (/^#([0-9a-fA-F]{3}|[0-9a-fA-F]{6})$/.test(v)) {
                if (v.length === 4) {
                    v = '#' + v[1] + v[1] + v[2] + v[2] + v[3] + v[3];
                }
                return v.toLowerCase();
            }
            return null;
        }

        function hexToRgb(hex) {
            const match = /^#?([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/.exec(hex.replace('#', ''));
            if (!match) return null;
            return {
                r: parseInt(match[1], 16),
                g: parseInt(match[2], 16),
                b: parseInt(match[3], 16)
            };
        }

        function luminance(hex) {
            const rgb = hexToRgb(hex);
            if (!rgb) return 0;
            const a = ['r', 'g', 'b'].map(k => {
                let c = rgb[k] / 255;
                return c <= 0.03928 ? c / 12.92 : Math.pow((c + 0.055) / 1.055, 2.4);
            });
            return 0.2126 * a[0] + 0.7152 * a[1] + 0.0722 * a[2];
        }

        function updateContrast() {
            const l1 = luminance(state.textColor);
            const l2 = luminance(state.bgColor);
            const ratio = (Math.max(l1, l2) + 0.05) / (Math.min(l1, l2) + 0.05);
            const rounded = Math.round(ratio * 100) / 100;
            const pass = ratio >= 4.5;
            const aaa = ratio >= 7;
            contrastLabel.textContent = `${rounded}:1 ${aaa ? 'AAA' : pass ? 'AA' : 'Fail'}`;
            contrastLabel.className = pass ? 'contrast-pass' : 'contrast-fail';
        }

        function updatePreviewText() {
            const mode = textSampleEl.value;
            if (mode === 'custom') {
                customTextContainer.style.display = 'block';
                samples.custom = customTextEl.value;
                previewContentEl.innerHTML = `<p>${samples.custom || 'Enter your custom text...'}</p>`;
            } else {
                customTextContainer.style.display = 'none';
                previewContentEl.innerHTML = samples[mode];
            }
        }

        function updatePreview() {
            updatePreviewText();
            const stack = getFontStack(state.font);
            previewContentEl.style.fontFamily = stack;
            previewContentEl.style.fontSize = `${state.size}px`;
            previewContentEl.style.fontWeight = state.weight;
            previewContentEl.style.lineHeight = state.lineHeight;
            previewContentEl.style.letterSpacing = `${state.letterSpacing}px`;
            previewContentEl.style.color = state.textColor;
            previewWindowEl.style.background = state.bgColor;
            previewWindowEl.dataset.device = devicePreviewEl.value;
            updateContrast();
            toolStats.textContent = `Font: ${state.font.name} (${state.source}) • ${state.size}px / ${state.lineHeight} • Weight ${state.weight}`;
        }

        function generateCssSnippet(includeImport = true) {
            const stack = getFontStack(state.font);
            const importLine = state.source === 'google' && includeImport ? `@import url('${buildGoogleHref(state.font)}');\n\n` : '';
            return `${importLine}:root {\n  --font-family-body: ${stack};\n}\n\n.preview-font {\n  font-family: ${stack};\n  font-size: ${state.size}px;\n  font-weight: ${state.weight};\n  line-height: ${state.lineHeight};\n  letter-spacing: ${state.letterSpacing}px;\n  color: ${state.textColor};\n  background: ${state.bgColor};\n}`;
        }

        function generateImportSnippet() {
            const stack = getFontStack(state.font);
            if (state.source !== 'google') {
                return `/* System fonts do not require imports */\n:root {\n  --font-family-body: ${stack};\n}`;
            }
            return `@import url('${buildGoogleHref(state.font)}');\n\nbody {\n  font-family: ${stack};\n}`;
        }

        function generateScssSnippet() {
            const stack = getFontStack(state.font);
            return `$font-family: ${stack};\n$font-weight: ${state.weight};\n$font-size: ${state.size}px;\n$line-height: ${state.lineHeight};\n$letter-spacing: ${state.letterSpacing}px;\n$color: ${state.textColor};\n$background: ${state.bgColor};\n\n.preview-font {\n  font-family: $font-family;\n  font-weight: $font-weight;\n  font-size: $font-size;\n  line-height: $line-height;\n  letter-spacing: $letter-spacing;\n  color: $color;\n  background: $background;\n}`;
        }

        function updateCode() {
            cssCodeEl.textContent = generateCssSnippet();
            importCodeEl.textContent = generateImportSnippet();
            scssCodeEl.textContent = generateScssSnippet();
        }

        function copyBlock(id) {
            const el = document.getElementById(id);
            if (!el) return;
            navigator.clipboard.writeText(el.textContent).then(() => {
                setStatus('Copied to clipboard!', 'success');
            }).catch(() => setStatus('Copy failed', 'error'));
        }

        function resetAll() {
            state = {
                source: 'google',
                font: fontSources.google[0],
                weight: 400,
                size: 18,
                lineHeight: 1.5,
                letterSpacing: 0,
                textColor: '#e0e0e0',
                bgColor: '#101010'
            };
            document.getElementById('sourceGoogle').checked = true;
            fontSearchEl.value = '';
            fontCategoryEl.value = '';
            fontSizeRangeEl.value = state.size;
            fontSizeEl.value = state.size;
            lineHeightRangeEl.value = state.lineHeight;
            lineHeightEl.value = state.lineHeight;
            letterSpacingRangeEl.value = state.letterSpacing;
            letterSpacingEl.value = state.letterSpacing;
            textColorEl.value = state.textColor;
            textColorHexEl.value = state.textColor;
            bgColorEl.value = state.bgColor;
            bgColorHexEl.value = state.bgColor;
            textSampleEl.value = 'paragraph';
            customTextEl.value = 'The quick brown fox jumps over the lazy dog.';
            devicePreviewEl.value = 'desktop';
            populateWeights(state.font);
            loadGoogleFont(state.font);
            renderFontList();
            updatePreview();
            updateCode();
            setStatus('Reset to defaults');
        }

        document.querySelectorAll('input[name="fontSource"]').forEach(radio => {
            radio.addEventListener('change', (e) => {
                state.source = e.target.value;
                state.font = fontSources[state.source][0];
                populateWeights(state.font);
                if (state.source === 'google') loadGoogleFont(state.font);
                renderFontList();
                updatePreview();
                updateCode();
            });
        });

        fontSearchEl.addEventListener('input', renderFontList);
        fontCategoryEl.addEventListener('change', renderFontList);

        fontWeightEl.addEventListener('change', () => {
            state.weight = Number(fontWeightEl.value);
            updatePreview();
            updateCode();
        });

        syncRange(fontSizeRangeEl, fontSizeEl, 'size', Number);
        syncRange(lineHeightRangeEl, lineHeightEl, 'lineHeight', Number);
        syncRange(letterSpacingRangeEl, letterSpacingEl, 'letterSpacing', Number);

        textColorEl.addEventListener('input', () => {
            state.textColor = textColorEl.value;
            textColorHexEl.value = state.textColor;
            updatePreview();
            updateCode();
        });
        textColorHexEl.addEventListener('input', () => {
            const hex = normalizeHex(textColorHexEl.value);
            if (hex) {
                state.textColor = hex;
                textColorEl.value = hex;
                updatePreview();
                updateCode();
            }
        });

        bgColorEl.addEventListener('input', () => {
            state.bgColor = bgColorEl.value;
            bgColorHexEl.value = state.bgColor;
            updatePreview();
            updateCode();
        });
        bgColorHexEl.addEventListener('input', () => {
            const hex = normalizeHex(bgColorHexEl.value);
            if (hex) {
                state.bgColor = hex;
                bgColorEl.value = hex;
                updatePreview();
                updateCode();
            }
        });

        textSampleEl.addEventListener('change', updatePreview);
        customTextEl.addEventListener('input', updatePreview);
        devicePreviewEl.addEventListener('change', updatePreview);

        document.getElementById('backButton').addEventListener('click', () => window.location.href = 'index.html');
        document.getElementById('resetButton').addEventListener('click', resetAll);
        document.getElementById('copyCssButton').addEventListener('click', () => copyBlock('cssCode'));

        codeTabs.forEach(tab => {
            tab.addEventListener('click', () => {
                codeTabs.forEach(t => t.classList.remove('active'));
                tab.classList.add('active');
                const target = tab.dataset.codeTab;
                codePanels.forEach(panel => {
                    panel.classList.toggle('active', panel.dataset.codePanel === target);
                });
            });
        });

        document.querySelectorAll('[data-copy-target]').forEach(btn => {
            btn.addEventListener('click', () => copyBlock(btn.dataset.copyTarget));
        });

        resetAll();
    </script>
</body>
</html>
