# LLM Context Pack: JSON Tool

This generated file is designed as a context bundle for LLM prompts.
It contains full source text for files directly associated with the tool, plus extracted sections from broader docs that reference the tool.
Every included block is wrapped with explicit BEGIN/END markers for reliable chunking.

Generated: 2026-02-23 12:07:33 UTC
Repository: `D:\GitHub\text-utils`
Tool slug: `json-tool`
Tool page: `json-tool.html`
Output file: `context/code-dump-json-tool.txt`

## Discovery Summary
- Full files included: 11
- Direct local dependencies: 5
- Incoming code references: 5
- Direct tool docs (full): 2
- Cross-file text excerpts: 7
- External dependencies in tool page: 8

## Included Full Files
- `json-tool.html`
- `css/style.css`
- `index.html`
- `js/json-tool-page.js`
- `js/json-worker.js`
- `js/theme.js`
- `scripts/code-dump-json-tool.py`
- `scripts/tool_context_dump.py`
- `sitemap.xml`
- `JSON-TOOL-MIGRATION.md`
- `docs/doc-json-tool.md`

## External Dependencies
- `https://cdnjs.cloudflare.com/ajax/libs/ace/1.32.3/ace.js`
- `https://cdnjs.cloudflare.com/ajax/libs/ajv/8.12.0/ajv7.min.js`
- `https://cdnjs.cloudflare.com/ajax/libs/jmespath.js/0.16.0/jmespath.min.js`
- `https://cdnjs.cloudflare.com/ajax/libs/jsonlint/1.6.0/jsonlint.min.js`
- `https://chessnerd.net`
- `https://fonts.googleapis.com/icon?family=Material+Icons`
- `https://github.com/ianrastall/text-utils`
- `https://www.googletagmanager.com/gtag/js?id=G-0V2F0V7FWB`

## Full File Dumps

----- BEGIN FILE: json-tool.html -----
```html
   1: <!DOCTYPE html>
   2: <html lang="en">
   3: <head>
   4: <!-- Google tag gtag.js -->
   5: <script async src="https://www.googletagmanager.com/gtag/js?id=G-0V2F0V7FWB"></script>
   6: <script>
   7:   window.dataLayer = window.dataLayer || [];
   8:   function gtag(){dataLayer.push(arguments);}
   9:   gtag('js', new Date());
  10: 
  11:   gtag('config', 'G-0V2F0V7FWB');
  12: </script>
  13:     <meta charset="UTF-8">
  14:     <meta name="viewport" content="width=device-width, initial-scale=1.0">
  15:     <title>JSON Tool - Text Utilities</title>
  16:     <script>
  17:         (function () {
  18:             try {
  19:                 const storedTheme = localStorage.getItem('theme');
  20:                 const prefersLight = window.matchMedia && window.matchMedia('(prefers-color-scheme: light)').matches;
  21:                 const resolvedTheme = storedTheme === 'light' || storedTheme === 'dark'
  22:                     ? storedTheme
  23:                     : (prefersLight ? 'light' : 'dark');
  24:                 document.documentElement.setAttribute('data-theme', resolvedTheme);
  25: 
  26:                 const storedAccent = localStorage.getItem('accentColor');
  27:                 let normalizedAccent = typeof storedAccent === 'string' ? storedAccent.trim().toLowerCase() : '';
  28:                 if (/^#[0-9a-f]{3}$/.test(normalizedAccent)) {
  29:                     normalizedAccent = `#${normalizedAccent[1]}${normalizedAccent[1]}${normalizedAccent[2]}${normalizedAccent[2]}${normalizedAccent[3]}${normalizedAccent[3]}`;
  30:                 }
  31: 
  32:                 if (/^#[0-9a-f]{6}$/.test(normalizedAccent)) {
  33:                     const red = parseInt(normalizedAccent.slice(1, 3), 16);
  34:                     const green = parseInt(normalizedAccent.slice(3, 5), 16);
  35:                     const blue = parseInt(normalizedAccent.slice(5, 7), 16);
  36:                     document.documentElement.style.setProperty('--accent', normalizedAccent);
  37:                     document.documentElement.style.setProperty('--accent-rgb', `${red}, ${green}, ${blue}`);
  38:                 }
  39:             } catch (_) {
  40:                 document.documentElement.setAttribute('data-theme', 'dark');
  41:             }
  42:         })();
  43:     </script>
  44:     <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
  45:     <link rel="stylesheet" href="css/style.css">
  46:     <script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.32.3/ace.js"></script>
  47:     <script src="https://cdnjs.cloudflare.com/ajax/libs/jsonlint/1.6.0/jsonlint.min.js"></script>
  48:     <script src="https://cdnjs.cloudflare.com/ajax/libs/ajv/8.12.0/ajv7.min.js"></script>
  49:     <script src="https://cdnjs.cloudflare.com/ajax/libs/jmespath.js/0.16.0/jmespath.min.js"></script>
  50:     <style>
  51:         .mode-tabs {
  52:             display: flex;
  53:             gap: 0.5rem;
  54:             margin-bottom: 1rem;
  55:             border-bottom: 1px solid var(--border-color);
  56:         }
  57: 
  58:         .mode-tab {
  59:             padding: 0.75rem 1.5rem;
  60:             background: transparent;
  61:             border: none;
  62:             border-bottom: 2px solid transparent;
  63:             color: var(--text-secondary);
  64:             cursor: pointer;
  65:             font-size: 0.875rem;
  66:             transition: all 0.2s;
  67:             display: flex;
  68:             align-items: center;
  69:             gap: 0.5rem;
  70:         }
  71: 
  72:         .mode-tab:hover {
  73:             color: var(--text-primary);
  74:             background: var(--bg-tertiary);
  75:         }
  76: 
  77:         .mode-tab.active {
  78:             color: var(--accent);
  79:             border-bottom-color: var(--accent);
  80:         }
  81: 
  82:         .error-panel {
  83:             background: var(--bg-tertiary);
  84:             border-left: 3px solid var(--error);
  85:             padding: 1rem;
  86:             margin-bottom: 1rem;
  87:             border-radius: 4px;
  88:             display: none;
  89:         }
  90: 
  91:         .error-panel.show {
  92:             display: block;
  93:         }
  94: 
  95:         .error-title {
  96:             color: var(--error);
  97:             font-weight: 600;
  98:             margin-bottom: 0.5rem;
  99:             display: flex;
 100:             align-items: center;
 101:             gap: 0.5rem;
 102:         }
 103: 
 104:         .error-message {
 105:             color: var(--text-primary);
 106:             font-family: 'Monaco', 'Menlo', monospace;
 107:             font-size: 0.875rem;
 108:         }
 109: 
 110:         .info-panel {
 111:             background: var(--bg-tertiary);
 112:             border-left: 3px solid var(--accent);
 113:             padding: 1rem;
 114:             margin-bottom: 1rem;
 115:             border-radius: 4px;
 116:             font-size: 0.875rem;
 117:             color: var(--text-secondary);
 118:         }
 119: 
 120:         .info-panel h4 {
 121:             color: var(--text-primary);
 122:             margin-bottom: 0.5rem;
 123:             display: flex;
 124:             align-items: center;
 125:             gap: 0.5rem;
 126:         }
 127: 
 128:         .example-badge {
 129:             display: inline-block;
 130:             background: var(--accent);
 131:             color: white;
 132:             padding: 0.125rem 0.5rem;
 133:             border-radius: 12px;
 134:             font-size: 0.75rem;
 135:             margin-left: 0.5rem;
 136:         }
 137: 
 138:         .json-stats {
 139:             display: grid;
 140:             grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
 141:             gap: 1rem;
 142:             margin-bottom: 1rem;
 143:             padding: 1rem;
 144:             background: var(--bg-tertiary);
 145:             border-radius: 4px;
 146:         }
 147: 
 148:         .stat-item {
 149:             display: flex;
 150:             flex-direction: column;
 151:             gap: 0.25rem;
 152:         }
 153: 
 154:         .stat-label {
 155:             font-size: 0.75rem;
 156:             color: var(--text-secondary);
 157:             text-transform: uppercase;
 158:         }
 159: 
 160:         .stat-value {
 161:             font-size: 1.25rem;
 162:             font-weight: 600;
 163:             color: var(--text-primary);
 164:         }
 165: 
 166:         .aux-inputs {
 167:             display: flex;
 168:             flex-direction: column;
 169:             gap: 1rem;
 170:             margin-bottom: 1rem;
 171:         }
 172: 
 173:         .aux-panel {
 174:             display: none;
 175:             background: var(--bg-secondary);
 176:             border: 1px solid var(--border-color);
 177:             border-radius: 6px;
 178:             padding: 0.75rem;
 179:         }
 180: 
 181:         .aux-panel.show {
 182:             display: block;
 183:         }
 184: 
 185:         .aux-panel-header {
 186:             display: flex;
 187:             justify-content: space-between;
 188:             align-items: center;
 189:             gap: 0.75rem;
 190:             margin-bottom: 0.5rem;
 191:         }
 192: 
 193:         .aux-panel-header label {
 194:             font-size: 0.875rem;
 195:             font-weight: 600;
 196:             color: var(--text-primary);
 197:         }
 198: 
 199:         .query-input {
 200:             width: 100%;
 201:             padding: 0.75rem;
 202:             border-radius: 6px;
 203:             border: 1px solid var(--border-color);
 204:             background: var(--bg-tertiary);
 205:             color: var(--text-primary);
 206:             font-family: 'Monaco', 'Menlo', monospace;
 207:             font-size: 0.875rem;
 208:         }
 209: 
 210:         .query-input:focus {
 211:             outline: 2px solid rgba(var(--accent-rgb), 0.25);
 212:             border-color: var(--accent);
 213:         }
 214: 
 215:         .query-help {
 216:             margin-top: 0.5rem;
 217:             font-size: 0.75rem;
 218:             color: var(--text-secondary);
 219:         }
 220: 
 221:         .file-drop-zone {
 222:             border: 1px dashed var(--border-color);
 223:             border-radius: 6px;
 224:             background: var(--bg-tertiary);
 225:             padding: 0.75rem;
 226:             margin-bottom: 0.75rem;
 227:             transition: border-color 0.2s ease, background-color 0.2s ease;
 228:             cursor: pointer;
 229:         }
 230: 
 231:         .file-drop-zone:hover,
 232:         .file-drop-zone.drag-active {
 233:             border-color: var(--accent);
 234:             background: rgba(var(--accent-rgb), 0.08);
 235:             outline: none;
 236:         }
 237: 
 238:         .file-drop-main {
 239:             display: flex;
 240:             align-items: center;
 241:             gap: 0.5rem;
 242:             color: var(--text-primary);
 243:             font-size: 0.875rem;
 244:             margin-bottom: 0.5rem;
 245:         }
 246: 
 247:         .file-drop-main .material-icons {
 248:             color: var(--accent);
 249:             font-size: 1.125rem;
 250:         }
 251: 
 252:         .file-drop-actions {
 253:             display: flex;
 254:             align-items: center;
 255:             gap: 0.75rem;
 256:             flex-wrap: wrap;
 257:         }
 258: 
 259:         .file-drop-meta {
 260:             font-size: 0.75rem;
 261:             color: var(--text-secondary);
 262:         }
 263: 
 264:         .editor-shell {
 265:             border: 1px solid var(--border-color);
 266:             border-radius: 6px;
 267:             overflow: hidden;
 268:             background: var(--bg-secondary);
 269:         }
 270: 
 271:         .editor-shell .ace_editor {
 272:             font-size: 14px;
 273:             line-height: 1.5;
 274:         }
 275: 
 276:         .ace-host {
 277:             width: 100%;
 278:             height: 360px;
 279:         }
 280: 
 281:         .ace-host.compact {
 282:             height: 180px;
 283:         }
 284: 
 285:         @media (max-width: 900px) {
 286:             .aux-panel-header {
 287:                 flex-direction: column;
 288:                 align-items: flex-start;
 289:             }
 290: 
 291:             .ace-host {
 292:                 height: 300px;
 293:             }
 294: 
 295:             .ace-host.compact {
 296:                 height: 160px;
 297:             }
 298:         }
 299:     </style>
 300: </head>
 301: <body>
 302:     <div class="container">
 303:         <header>
 304:             <div class="logo">
 305:                 <a href="index.html" style="color: inherit; text-decoration: none;">
 306:                     <span>Text Utilities</span>
 307:                 </a>
 308:             </div>
 309:             <nav class="site-network" aria-label="Network sites">
 310:                 <a href="https://chessnerd.net" class="site-network-link" target="_blank" rel="noopener noreferrer">
 311:                     <img src="img/chessnerd-icon.png" class="site-network-icon" alt="">
 312:                     <span>Chess Nerd</span>
 313:                     <span class="material-icons" aria-hidden="true">open_in_new</span>
 314:                 </a>
 315:                 <a href="https://github.com/ianrastall/text-utils" class="site-network-link" target="_blank" rel="noopener noreferrer">
 316:                     <img src="img/github.png" class="site-network-icon" alt="">
 317:                     <span>GitHub</span>
 318:                     <span class="material-icons" aria-hidden="true">open_in_new</span>
 319:                 </a>
 320:             </nav>
 321:             <div class="controls">
 322:                 <div class="accent-selector">
 323:                     <span class="material-icons">palette</span>
 324:                     <select id="accentColor" class="color-dropdown" aria-label="Accent color"></select>
 325:                 </div>
 326:                 <button id="themeToggle" class="btn btn-secondary" type="button" aria-label="Toggle theme" aria-pressed="false">
 327:                     <span class="material-icons">dark_mode</span>
 328:                 </button>
 329:             </div>
 330:         </header>
 331: 
 332:                 <main>
 333:             <div class="tool-container">
 334:                 <div class="tool-header">
 335:                     <div class="tool-title">
 336:                         <span class="material-icons">data_object</span>
 337:                         <h2>JSON Tool</h2>
 338:                     </div>
 339:                     <div class="tool-actions">
 340:                         <button id="backButton" class="btn btn-secondary btn-compact" type="button">
 341:                             <span class="material-icons">arrow_back</span>
 342:                             Back
 343:                         </button>
 344:                         <button id="exampleBtn" class="btn btn-secondary" type="button">
 345:                             <span class="material-icons">science</span>
 346:                             Example
 347:                         </button>
 348:                         <button id="copyOutput" class="btn btn-secondary btn-compact" type="button">
 349:                             <span class="material-icons">content_copy</span>
 350:                             Copy
 351:                         </button>
 352:                         <button id="clearBtn" class="btn btn-secondary" type="button">
 353:                             <span class="material-icons">clear</span>
 354:                             Clear
 355:                         </button>
 356:                         <button id="processBtn" class="btn btn-primary" type="button">
 357:                             <span class="material-icons">play_arrow</span>
 358:                             <span id="processLabel">Format</span>
 359:                         </button>
 360:                     </div>
 361:                 </div>
 362: 
 363:                 <p class="tool-description">Format, validate, query, and convert between JSON and JSONL</p>
 364: 
 365:                 <div class="mode-tabs" role="tablist" aria-label="JSON tool mode">
 366:                     <button id="tab-format" class="mode-tab active" data-mode="format" type="button" role="tab" aria-selected="true" aria-controls="panel-format" tabindex="0">
 367:                         <span class="material-icons">code</span>
 368:                         Format JSON
 369:                     </button>
 370:                     <button id="tab-jsonl" class="mode-tab" data-mode="jsonl" type="button" role="tab" aria-selected="false" aria-controls="panel-jsonl" tabindex="-1">
 371:                         <span class="material-icons">view_list</span>
 372:                         JSON to JSONL
 373:                     </button>
 374:                     <button id="tab-jsonlToJson" class="mode-tab" data-mode="jsonlToJson" type="button" role="tab" aria-selected="false" aria-controls="panel-jsonlToJson" tabindex="-1">
 375:                         <span class="material-icons">playlist_add_check</span>
 376:                         JSONL to JSON
 377:                     </button>
 378:                     <button id="tab-validate" class="mode-tab" data-mode="validate" type="button" role="tab" aria-selected="false" aria-controls="panel-validate" tabindex="-1">
 379:                         <span class="material-icons">check_circle</span>
 380:                         Validate Only
 381:                     </button>
 382:                 </div>
 383: 
 384:                 <div id="panel-format" class="mode-tab-panel sr-only" role="tabpanel" aria-labelledby="tab-format" aria-hidden="false">
 385:                     Format JSON mode is active. Formatting options and query controls are available before processing.
 386:                 </div>
 387:                 <div id="panel-jsonl" class="mode-tab-panel sr-only" role="tabpanel" aria-labelledby="tab-jsonl" aria-hidden="true" hidden>
 388:                     JSON to JSONL mode is active. The tool converts a JSON array or values into line-delimited JSON output.
 389:                 </div>
 390:                 <div id="panel-jsonlToJson" class="mode-tab-panel sr-only" role="tabpanel" aria-labelledby="tab-jsonlToJson" aria-hidden="true" hidden>
 391:                     JSONL to JSON mode is active. The tool reads line-delimited JSON and combines rows into a JSON array.
 392:                 </div>
 393:                 <div id="panel-validate" class="mode-tab-panel sr-only" role="tabpanel" aria-labelledby="tab-validate" aria-hidden="true" hidden>
 394:                     Validate mode is active. Schema input can be provided and processing returns validation results without reformatting.
 395:                 </div>
 396: 
 397:                 <div class="info-panel">
 398:                     <h4>
 399:                         <span class="material-icons">info</span>
 400:                         <span id="infoTitle">JSON Formatting</span>
 401:                     </h4>
 402:                     <p id="infoText">
 403:                         Format and validate JSON with customizable indentation. 
 404:                         Automatically detects syntax errors and provides helpful error messages.
 405:                     </p>
 406:                 </div>
 407: 
 408:                 <div class="error-panel" id="errorPanel" role="alert" aria-live="assertive" aria-hidden="true">
 409:                     <div class="error-title">
 410:                         <span class="material-icons">error</span>
 411:                         <span id="errorTitleText">Syntax Error</span>
 412:                     </div>
 413:                     <div class="error-message" id="errorMessage"></div>
 414:                 </div>
 415: 
 416:                 <div class="json-stats" id="statsPanel" style="display: none;">
 417:                     <div class="stat-item">
 418:                         <span class="stat-label">Objects</span>
 419:                         <span class="stat-value" id="statObjects">0</span>
 420:                     </div>
 421:                     <div class="stat-item">
 422:                         <span class="stat-label">Arrays</span>
 423:                         <span class="stat-value" id="statArrays">0</span>
 424:                     </div>
 425:                     <div class="stat-item">
 426:                         <span class="stat-label">Keys</span>
 427:                         <span class="stat-value" id="statKeys">0</span>
 428:                     </div>
 429:                     <div class="stat-item">
 430:                         <span class="stat-label">Max Depth</span>
 431:                         <span class="stat-value" id="statDepth">0</span>
 432:                     </div>
 433:                 </div>
 434: 
 435:                 <div class="options-panel" id="optionsPanel">
 436:                     <div class="options-grid">
 437:                         <div class="option-group">
 438:                             <label for="indentSelect">Indentation</label>
 439:                             <select id="indentSelect">
 440:                                 <option value="2">2 spaces</option>
 441:                                 <option value="4">4 spaces</option>
 442:                                 <option value="tab">Tab</option>
 443:                                 <option value="0">Minified</option>
 444:                             </select>
 445:                         </div>
 446:                         <div class="option-group">
 447:                             <label for="sortKeysCheck">
 448:                                 <input type="checkbox" id="sortKeysCheck">
 449:                                 Sort object keys alphabetically
 450:                             </label>
 451:                         </div>
 452:                     </div>
 453:                 </div>
 454: 
 455:                 <div class="aux-inputs">
 456:                     <div class="aux-panel show" id="queryPanel">
 457:                         <div class="aux-panel-header">
 458:                             <label for="jmespathQuery">JMESPath Query (Optional)</label>
 459:                             <span class="stats pill muted">Format / JSON to JSONL</span>
 460:                         </div>
 461:                         <input
 462:                             id="jmespathQuery"
 463:                             class="query-input"
 464:                             type="text"
 465:                             placeholder="Example: users[?active == `true`].{id: id, email: email}"
 466:                             autocomplete="off"
 467:                             spellcheck="false"
 468:                         >
 469:                         <div class="query-help">Applied before formatting or JSONL conversion.</div>
 470:                     </div>
 471: 
 472:                     <div class="aux-panel" id="schemaPanel">
 473:                         <div class="aux-panel-header">
 474:                             <label id="schemaLabel">Schema (Optional)</label>
 475:                             <span class="stats pill muted">AJV / JSON Schema</span>
 476:                         </div>
 477:                         <div class="editor-shell">
 478:                             <div id="schemaEditor" class="ace-host compact" aria-labelledby="schemaLabel"></div>
 479:                         </div>
 480:                     </div>
 481:                 </div>
 482: 
 483:                 <div class="io-container">
 484:                     <div class="io-panel">
 485:                         <div class="io-label">
 486:                             <span id="inputLabelText">Input JSON</span>
 487:                             <span class="stats pill muted" id="inputStats">0 chars</span>
 488:                         </div>
 489:                         <div
 490:                             id="fileDropZone"
 491:                             class="file-drop-zone"
 492:                         >
 493:                             <div class="file-drop-main">
 494:                                 <span class="material-icons" aria-hidden="true">upload_file</span>
 495:                                 <span>Drag & drop a file here, or use the button below</span>
 496:                             </div>
 497:                             <div class="file-drop-actions">
 498:                                 <button id="chooseFileBtn" class="btn btn-secondary btn-compact" type="button">
 499:                                     <span class="material-icons">folder_open</span>
 500:                                     Choose File
 501:                                 </button>
 502:                                 <span class="file-drop-meta" id="fileMeta">Supports `.json`, `.jsonl`, `.ndjson`, and plain text files.</span>
 503:                             </div>
 504:                             <input id="fileInput" type="file" accept=".json,.jsonl,.ndjson,.txt,application/json,text/plain" hidden>
 505:                         </div>
 506:                         <div class="editor-shell">
 507:                             <div id="inputEditor" class="ace-host" aria-label="Input JSON editor"></div>
 508:                         </div>
 509:                     </div>
 510:                     <div class="io-panel">
 511:                         <div class="io-label">
 512:                             <span id="outputLabel">Formatted Output</span>
 513:                             <span class="stats pill muted" id="outputStats">0 chars</span>
 514:                         </div>
 515:                         <div class="editor-shell">
 516:                             <div id="outputEditor" class="ace-host" aria-label="Output editor"></div>
 517:                         </div>
 518:                     </div>
 519:                 </div>
 520: 
 521:                 <div class="status-bar">
 522:                     <div id="statusMessage" class="success" role="status" aria-live="polite">Ready</div>
 523:                     <div id="processingTime">No operations yet</div>
 524:                 </div>
 525:             </div>
 526:         </main>
 527:     </div>
 528: 
 529: 
 530:     <script src="js/theme.js"></script>
 531:     <script src="js/json-tool-page.js"></script>
 532:     <footer class="site-footer">
 533:         <p>&copy; Ian Rastall 2025<br>Contact: moving.form.of.dust@gmail.com<br>Donate: PayPal to merastall@gmail.com</p>
 534:     </footer>
 535: </body>
 536: </html>
 537: 
 538: 
```
----- END FILE: json-tool.html -----

----- BEGIN FILE: css/style.css -----
```css
   1: :root {
   2:     --bg-primary: #121212;
   3:     --bg-secondary: #1e1e1e;
   4:     --bg-tertiary: #252525;
   5:     --text-primary: #e0e0e0;
   6:     --text-secondary: #a0a0a0;
   7:     --border-color: #333;
   8:     --accent: #0d9488;
   9:     --accent-light: #14b8a6;
  10:     --accent-rgb: 13, 148, 136;
  11:     --control-icon-filter: invert(1) brightness(1.25);
  12:     --success: #059669;
  13:     --warning: #d97706;
  14:     --error: #dc2626;
  15:     color-scheme: dark;
  16: }
  17: 
  18: [data-theme="light"] {
  19:     --bg-primary: #ffffff;
  20:     --bg-secondary: #f8fafc;
  21:     --bg-tertiary: #f1f5f9;
  22:     --text-primary: #1e293b;
  23:     --text-secondary: #64748b;
  24:     --border-color: #e2e8f0;
  25:     --control-icon-filter: none;
  26:     color-scheme: light;
  27: }
  28: 
  29: * {
  30:     margin: 0;
  31:     padding: 0;
  32:     box-sizing: border-box;
  33: }
  34: 
  35: body {
  36:     font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', system-ui, sans-serif;
  37:     background: var(--bg-primary);
  38:     color: var(--text-primary);
  39:     line-height: 1.5;
  40:     min-height: 100vh;
  41: }
  42: 
  43: .container {
  44:     width: 100%;
  45:     max-width: none;
  46:     margin: 0 auto;
  47:     padding: 1rem 1.5rem;
  48: }
  49: 
  50: /* Header */
  51: header {
  52:     display: flex;
  53:     justify-content: space-between;
  54:     align-items: center;
  55:     padding: 1rem 0;
  56:     border-bottom: 1px solid var(--border-color);
  57:     margin-bottom: 2rem;
  58:     position: relative;
  59: }
  60: 
  61: .logo {
  62:     display: flex;
  63:     align-items: center;
  64:     gap: 0.5rem;
  65:     font-size: 1.5rem;
  66:     font-weight: 600;
  67: }
  68: 
  69: .logo span {
  70:     color: var(--accent);
  71: }
  72: 
  73: .controls {
  74:     display: flex;
  75:     gap: 1rem;
  76:     align-items: center;
  77: }
  78: 
  79: .site-network {
  80:     position: absolute;
  81:     left: 50%;
  82:     transform: translateX(-50%);
  83:     display: flex;
  84:     flex-direction: column;
  85:     gap: 0.25rem;
  86:     align-items: flex-start;
  87: }
  88: 
  89: .site-network-link {
  90:     color: var(--text-secondary);
  91:     text-decoration: none;
  92:     font-size: 0.9rem;
  93:     display: inline-flex;
  94:     align-items: center;
  95:     gap: 0.25rem;
  96:     line-height: 1.2;
  97: }
  98: 
  99: .site-network-link .material-icons {
 100:     font-size: 1rem;
 101: }
 102: 
 103: .site-network-icon {
 104:     width: 1rem;
 105:     height: 1rem;
 106:     object-fit: contain;
 107:     flex: 0 0 auto;
 108: }
 109: 
 110: .site-network-link:hover {
 111:     color: var(--accent);
 112: }
 113: 
 114: .accent-selector {
 115:     display: flex;
 116:     align-items: center;
 117:     gap: 0.5rem;
 118: }
 119: 
 120: .color-dropdown {
 121:     padding: 0.25rem 0.5rem;
 122:     background: var(--bg-secondary);
 123:     border: 1px solid var(--border-color);
 124:     border-radius: 4px;
 125:     color: var(--text-primary);
 126:     cursor: pointer;
 127: }
 128: 
 129: /* Main Layout */
 130: .main-grid {
 131:     display: block;
 132:     min-height: calc(100vh - 120px);
 133: }
 134: 
 135: /* Sidebar */
 136: .sidebar {
 137:     background: var(--bg-secondary);
 138:     border-radius: 8px;
 139:     padding: 1rem;
 140:     height: fit-content;
 141:     position: sticky;
 142:     top: 1rem;
 143: }
 144: 
 145: .search-box {
 146:     margin-bottom: 1.5rem;
 147: }
 148: 
 149: .search-box input {
 150:     width: 100%;
 151:     padding: 0.5rem;
 152:     background: var(--bg-tertiary);
 153:     border: 1px solid var(--border-color);
 154:     border-radius: 4px;
 155:     color: var(--text-primary);
 156: }
 157: 
 158: .categories {
 159:     display: flex;
 160:     flex-direction: column;
 161:     gap: 0.5rem;
 162: }
 163: 
 164: .category {
 165:     padding: 0.75rem;
 166:     border-radius: 4px;
 167:     cursor: pointer;
 168:     transition: background 0.2s;
 169:     display: flex;
 170:     align-items: center;
 171:     gap: 0.5rem;
 172: }
 173: 
 174: .category:hover {
 175:     background: var(--bg-tertiary);
 176: }
 177: 
 178: .category.active {
 179:     background: var(--accent);
 180:     color: white;
 181: }
 182: 
 183: .recent-tools {
 184:     margin-top: 2rem;
 185:     padding-top: 1rem;
 186:     border-top: 1px solid var(--border-color);
 187: }
 188: 
 189: .recent-tools h4 {
 190:     margin-bottom: 0.5rem;
 191:     color: var(--text-secondary);
 192:     font-size: 0.875rem;
 193: }
 194: 
 195: .tool-chip {
 196:     display: inline-block;
 197:     background: var(--bg-tertiary);
 198:     padding: 0.25rem 0.5rem;
 199:     border-radius: 4px;
 200:     margin: 0.125rem;
 201:     font-size: 0.75rem;
 202:     cursor: pointer;
 203: }
 204: 
 205: /* Tool Container */
 206: .tool-container {
 207:     background: var(--bg-secondary);
 208:     border-radius: 8px;
 209:     padding: 1.5rem;
 210: }
 211: 
 212: .tool-header {
 213:     display: flex;
 214:     justify-content: space-between;
 215:     align-items: center;
 216:     margin-bottom: 1.5rem;
 217: }
 218: 
 219: .tool-title {
 220:     display: flex;
 221:     align-items: center;
 222:     gap: 0.5rem;
 223:     font-size: 1.25rem;
 224: }
 225: 
 226: .tool-description {
 227:     color: var(--text-secondary);
 228:     margin-bottom: 1.5rem;
 229:     font-size: 0.95rem;
 230: }
 231: 
 232: .tool-actions {
 233:     display: flex;
 234:     gap: 0.5rem;
 235: }
 236: 
 237: .btn {
 238:     padding: 0.5rem 1rem;
 239:     border: none;
 240:     border-radius: 4px;
 241:     cursor: pointer;
 242:     display: inline-flex;
 243:     align-items: center;
 244:     gap: 0.5rem;
 245:     font-size: 0.875rem;
 246:     transition: all 0.2s;
 247: }
 248: 
 249: .btn-compact {
 250:     padding: 0.35rem 0.75rem;
 251:     font-size: 0.85rem;
 252: }
 253: 
 254: .btn-primary {
 255:     background: var(--accent);
 256:     color: white;
 257: }
 258: 
 259: .btn-secondary {
 260:     background: var(--bg-tertiary);
 261:     color: var(--text-primary);
 262: }
 263: 
 264: .btn:hover {
 265:     transform: translateY(-1px);
 266:     box-shadow: 0 2px 4px rgba(0,0,0,0.2);
 267: }
 268: 
 269: .btn:disabled {
 270:     opacity: 0.55;
 271:     cursor: not-allowed;
 272: }
 273: 
 274: .btn:disabled:hover {
 275:     transform: none;
 276:     box-shadow: none;
 277: }
 278: 
 279: /* Tool I/O */
 280: .io-container {
 281:     display: grid;
 282:     grid-template-columns: 1fr 1fr;
 283:     gap: 1rem;
 284:     margin-bottom: 1rem;
 285: }
 286: 
 287: @media (max-width: 768px) {
 288:     .io-container {
 289:         grid-template-columns: 1fr;
 290:     }
 291: }
 292: 
 293: .io-panel {
 294:     display: flex;
 295:     flex-direction: column;
 296:     gap: 0.5rem;
 297: }
 298: 
 299: .io-label {
 300:     display: flex;
 301:     justify-content: space-between;
 302:     align-items: center;
 303:     font-size: 0.875rem;
 304:     color: var(--text-secondary);
 305: }
 306: 
 307: .stats {
 308:     font-size: 0.75rem;
 309: }
 310: 
 311: textarea {
 312:     width: 100%;
 313:     min-height: 300px;
 314:     padding: 1rem;
 315:     background: var(--bg-tertiary);
 316:     border: 1px solid var(--border-color);
 317:     border-radius: 4px;
 318:     color: var(--text-primary);
 319:     font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
 320:     font-size: 0.875rem;
 321:     line-height: 1.4;
 322:     resize: vertical;
 323: }
 324: 
 325: textarea:focus {
 326:     outline: none;
 327:     border-color: var(--accent);
 328: }
 329: 
 330: button:focus-visible,
 331: select:focus-visible,
 332: input:focus-visible,
 333: textarea:focus-visible {
 334:     outline: 2px solid var(--accent);
 335:     outline-offset: 2px;
 336: }
 337: 
 338: .output {
 339:     background: var(--bg-primary);
 340: }
 341: 
 342: /* Options Panel */
 343: .options-panel {
 344:     background: var(--bg-tertiary);
 345:     border-radius: 4px;
 346:     padding: 1rem;
 347:     margin-bottom: 1rem;
 348: }
 349: 
 350: .options-grid {
 351:     display: grid;
 352:     grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
 353:     gap: 1rem;
 354: }
 355: 
 356: .option-group {
 357:     display: flex;
 358:     flex-direction: column;
 359:     gap: 0.5rem;
 360: }
 361: 
 362: .option-group label {
 363:     font-size: 0.875rem;
 364:     color: var(--text-secondary);
 365: }
 366: 
 367: select,
 368: input[type="range"],
 369: input[type="checkbox"],
 370: input[type="radio"],
 371: input[type="text"],
 372: input[type="number"],
 373: input[type="search"],
 374: input[type="email"],
 375: input[type="url"],
 376: input[type="tel"],
 377: input[type="password"],
 378: input[type="date"],
 379: input[type="time"],
 380: input[type="datetime-local"],
 381: input[type="month"],
 382: input[type="week"] {
 383:     padding: 0.25rem 0.5rem;
 384:     background: var(--bg-secondary);
 385:     border: 1px solid var(--border-color);
 386:     border-radius: 4px;
 387:     color: var(--text-primary);
 388: }
 389: 
 390: select,
 391: input,
 392: textarea,
 393: button {
 394:     font: inherit;
 395: }
 396: 
 397: input[type="text"]::placeholder,
 398: input[type="number"]::placeholder,
 399: input[type="search"]::placeholder,
 400: input[type="email"]::placeholder,
 401: input[type="url"]::placeholder,
 402: input[type="tel"]::placeholder,
 403: input[type="password"]::placeholder,
 404: textarea::placeholder {
 405:     color: var(--text-secondary);
 406:     opacity: 1;
 407: }
 408: 
 409: select:disabled,
 410: input:disabled,
 411: textarea:disabled {
 412:     opacity: 0.65;
 413:     cursor: not-allowed;
 414: }
 415: 
 416: input[type="color"] {
 417:     background: var(--bg-secondary);
 418:     border: 1px solid var(--border-color);
 419:     border-radius: 4px;
 420:     color: var(--text-primary);
 421: }
 422: 
 423: input[type="color"]::-webkit-color-swatch-wrapper {
 424:     padding: 0;
 425: }
 426: 
 427: input[type="color"]::-webkit-color-swatch {
 428:     border: 1px solid var(--border-color);
 429:     border-radius: 3px;
 430: }
 431: 
 432: input[type="color"]::-moz-color-swatch {
 433:     border: 1px solid var(--border-color);
 434:     border-radius: 3px;
 435: }
 436: 
 437: input[type="date"]::-webkit-calendar-picker-indicator,
 438: input[type="time"]::-webkit-calendar-picker-indicator,
 439: input[type="datetime-local"]::-webkit-calendar-picker-indicator,
 440: input[type="month"]::-webkit-calendar-picker-indicator,
 441: input[type="week"]::-webkit-calendar-picker-indicator,
 442: input[type="search"]::-webkit-search-cancel-button,
 443: input[type="number"]::-webkit-inner-spin-button,
 444: input[type="number"]::-webkit-outer-spin-button {
 445:     filter: var(--control-icon-filter);
 446: }
 447: 
 448: input[type="date"]::-webkit-calendar-picker-indicator,
 449: input[type="time"]::-webkit-calendar-picker-indicator,
 450: input[type="datetime-local"]::-webkit-calendar-picker-indicator,
 451: input[type="month"]::-webkit-calendar-picker-indicator,
 452: input[type="week"]::-webkit-calendar-picker-indicator,
 453: input[type="search"]::-webkit-search-cancel-button {
 454:     cursor: pointer;
 455: }
 456: 
 457: input:-webkit-autofill,
 458: input:-webkit-autofill:hover,
 459: input:-webkit-autofill:focus,
 460: textarea:-webkit-autofill,
 461: textarea:-webkit-autofill:hover,
 462: textarea:-webkit-autofill:focus,
 463: select:-webkit-autofill,
 464: select:-webkit-autofill:hover,
 465: select:-webkit-autofill:focus {
 466:     -webkit-text-fill-color: var(--text-primary);
 467:     box-shadow: 0 0 0 1000px var(--bg-secondary) inset;
 468:     border: 1px solid var(--border-color);
 469:     transition: background-color 9999s ease-in-out 0s;
 470: }
 471: 
 472: input[type="checkbox"], input[type="radio"] {
 473:     width: auto;
 474:     cursor: pointer;
 475: }
 476: 
 477: /* Status Bar */
 478: .status-bar {
 479:     display: flex;
 480:     justify-content: space-between;
 481:     align-items: center;
 482:     padding-top: 1rem;
 483:     border-top: 1px solid var(--border-color);
 484:     font-size: 0.75rem;
 485:     color: var(--text-secondary);
 486: }
 487: 
 488: /* Tool Cards (for homepage) */
 489: .tool-grid {
 490:     display: grid;
 491:     grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
 492:     gap: 1rem;
 493:     margin-top: 1rem;
 494: }
 495: 
 496: .tool-card {
 497:     display: block;
 498:     background: var(--bg-tertiary);
 499:     border-radius: 8px;
 500:     padding: 1.5rem;
 501:     cursor: pointer;
 502:     transition: all 0.2s;
 503:     border: 1px solid transparent;
 504:     color: inherit;
 505:     text-decoration: none;
 506: }
 507: 
 508: .tool-card:hover {
 509:     border-color: var(--accent);
 510:     transform: translateY(-2px);
 511: }
 512: 
 513: .tool-icon {
 514:     width: 40px;
 515:     height: 40px;
 516:     background: var(--accent);
 517:     border-radius: 8px;
 518:     display: flex;
 519:     align-items: center;
 520:     justify-content: center;
 521:     margin-bottom: 1rem;
 522:     color: white;
 523: }
 524: 
 525: .tool-card h3 {
 526:     margin-bottom: 0.5rem;
 527: }
 528: 
 529: .tool-card p {
 530:     font-size: 0.875rem;
 531:     color: var(--text-secondary);
 532: }
 533: 
 534: .site-footer {
 535:     margin-top: 2rem;
 536:     padding: 1.5rem 0;
 537:     border-top: 1px solid var(--border-color);
 538:     text-align: center;
 539:     color: var(--text-secondary);
 540:     line-height: 1.5;
 541:     font-size: 0.95rem;
 542: }
 543: 
 544: .site-footer p {
 545:     margin: 0;
 546:     text-align: center;
 547: }
 548: 
 549: 
 550: .hidden {
 551:     display: none !important;
 552: }
 553: 
 554: .visually-hidden,
 555: .sr-only {
 556:     position: absolute;
 557:     width: 1px;
 558:     height: 1px;
 559:     padding: 0;
 560:     margin: -1px;
 561:     overflow: hidden;
 562:     clip: rect(0, 0, 0, 0);
 563:     white-space: nowrap;
 564:     border: 0;
 565: }
 566: 
 567: .pill {
 568:     padding: 0.35rem 0.75rem;
 569:     border-radius: 999px;
 570:     border: 1px solid var(--accent);
 571:     background: var(--bg-tertiary);
 572:     color: var(--text-primary);
 573:     font-size: 0.85rem;
 574:     display: inline-flex;
 575:     align-items: center;
 576:     gap: 0.25rem;
 577: }
 578: 
 579: .pill.muted {
 580:     border-color: var(--border-color);
 581:     color: var(--text-secondary);
 582: }
 583: 
 584: .success {
 585:     color: var(--success);
 586: }
 587: 
 588: .warning {
 589:     color: var(--warning);
 590: }
 591: 
 592: .error {
 593:     color: var(--error);
 594: }
 595: 
 596: /* Responsive */
 597: @media (max-width: 768px) {
 598:     .main-grid {
 599:         grid-template-columns: 1fr;
 600:     }
 601:     
 602:     .sidebar {
 603:         position: static;
 604:     }
 605:     
 606:     .tool-header {
 607:         flex-direction: column;
 608:         gap: 1rem;
 609:         align-items: flex-start;
 610:     }
 611: 
 612:     .site-network {
 613:         position: static;
 614:         transform: none;
 615:         order: 3;
 616:         width: 100%;
 617:         margin-top: 1rem;
 618:         display: flex;
 619:         flex-direction: column;
 620:         gap: 0.35rem;
 621:         justify-content: center;
 622:         align-items: center;
 623:     }
 624: 
 625:     header {
 626:         flex-wrap: wrap;
 627:     }
 628: }
 629: 
 630: @media (prefers-reduced-motion: reduce) {
 631:     * {
 632:         transition: none !important;
 633:         animation: none !important;
 634:     }
 635: 
 636:     .btn:hover {
 637:         transform: none !important;
 638:         box-shadow: none !important;
 639:     }
 640: }
```
----- END FILE: css/style.css -----

----- BEGIN FILE: index.html -----
```html
   1: <!DOCTYPE html>
   2: <html lang="en">
   3: <head>
   4: <!-- Google tag gtag.js -->
   5: <script async src="https://www.googletagmanager.com/gtag/js?id=G-0V2F0V7FWB"></script>
   6: <script>
   7:   window.dataLayer = window.dataLayer || [];
   8:   function gtag(){dataLayer.push(arguments);}
   9:   gtag('js', new Date());
  10: 
  11:   gtag('config', 'G-0V2F0V7FWB');
  12: </script>
  13:     <meta charset="UTF-8">
  14:     <meta name="viewport" content="width=device-width, initial-scale=1.0">
  15:     <title>Text Utilities</title>
  16:     <script>
  17:         (function () {
  18:             try {
  19:                 const storedTheme = localStorage.getItem('theme');
  20:                 const prefersLight = window.matchMedia && window.matchMedia('(prefers-color-scheme: light)').matches;
  21:                 const resolvedTheme = storedTheme === 'light' || storedTheme === 'dark'
  22:                     ? storedTheme
  23:                     : (prefersLight ? 'light' : 'dark');
  24:                 document.documentElement.setAttribute('data-theme', resolvedTheme);
  25: 
  26:                 const storedAccent = localStorage.getItem('accentColor');
  27:                 let normalizedAccent = typeof storedAccent === 'string' ? storedAccent.trim().toLowerCase() : '';
  28:                 if (/^#[0-9a-f]{3}$/.test(normalizedAccent)) {
  29:                     normalizedAccent = `#${normalizedAccent[1]}${normalizedAccent[1]}${normalizedAccent[2]}${normalizedAccent[2]}${normalizedAccent[3]}${normalizedAccent[3]}`;
  30:                 }
  31: 
  32:                 if (/^#[0-9a-f]{6}$/.test(normalizedAccent)) {
  33:                     const red = parseInt(normalizedAccent.slice(1, 3), 16);
  34:                     const green = parseInt(normalizedAccent.slice(3, 5), 16);
  35:                     const blue = parseInt(normalizedAccent.slice(5, 7), 16);
  36:                     document.documentElement.style.setProperty('--accent', normalizedAccent);
  37:                     document.documentElement.style.setProperty('--accent-rgb', `${red}, ${green}, ${blue}`);
  38:                 }
  39:             } catch (_) {
  40:                 document.documentElement.setAttribute('data-theme', 'dark');
  41:             }
  42:         })();
  43:     </script>
  44:     <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
  45:     <link rel="stylesheet" href="css/style.css">
  46: </head>
  47: <body>
  48:     <div class="container">
  49:         <header>
  50:             <div class="logo">
  51:                 <a href="index.html" style="color: inherit; text-decoration: none;">
  52:                     <span>Text Utilities</span>
  53:                 </a>
  54:             </div>
  55:             <nav class="site-network" aria-label="Network sites">
  56:                 <a href="https://chessnerd.net" class="site-network-link" target="_blank" rel="noopener noreferrer">
  57:                     <img src="img/chessnerd-icon.png" class="site-network-icon" alt="">
  58:                     <span>Chess Nerd</span>
  59:                     <span class="material-icons" aria-hidden="true">open_in_new</span>
  60:                 </a>
  61:                 <a href="https://github.com/ianrastall/text-utils" class="site-network-link" target="_blank" rel="noopener noreferrer">
  62:                     <img src="img/github.png" class="site-network-icon" alt="">
  63:                     <span>GitHub</span>
  64:                     <span class="material-icons" aria-hidden="true">open_in_new</span>
  65:                 </a>
  66:             </nav>
  67:             <div class="controls">
  68:                 <div class="accent-selector">
  69:                     <span class="material-icons">palette</span>
  70:                     <select id="accentColor" class="color-dropdown" aria-label="Accent color"></select>
  71:                 </div>
  72:                 <button id="themeToggle" class="btn btn-secondary" type="button" aria-label="Toggle theme" aria-pressed="false">
  73:                     <span class="material-icons">dark_mode</span>
  74:                 </button>
  75:             </div>
  76:         </header>
  77: 
  78:         <main>
  79:             <div id="homeView">
  80:                 <div class="tool-grid" id="toolGrid"></div>
  81:             </div>
  82:         </main>
  83:     </div>
  84: 
  85:     <script src="js/theme.js"></script>
  86:     <script>
  87: const tools = [
  88:     { id: 'case-converter', name: 'Case Converter', icon: 'text_format', category: 'text', description: 'Convert text between different cases' },
  89:     { id: 'text-info', name: 'Text Info', icon: 'analytics', category: 'text', description: 'Detailed statistics and readability scores for text' },
  90:     { id: 'line-operations', name: 'Line Operations', icon: 'reorder', category: 'text', description: 'Sort, filter, and manipulate lines of text' },
  91:     { id: 'find-replace', name: 'Find & Replace', icon: 'find_replace', category: 'text', description: 'Search and replace text with regex support' },
  92:     { id: 'font-chooser', name: 'Font Chooser', icon: 'text_fields', category: 'text', description: 'Preview fonts, check contrast, and generate CSS snippets' },
  93:     { id: 'ip-info', name: 'IP Info', icon: 'language', category: 'data', description: 'Public IP, provider, location, and device diagnostics' },
  94:     { id: 'font-awesome-chooser', name: 'Font Awesome Chooser', icon: 'code', category: 'data', description: 'Browse Font Awesome icons and generate code snippets' },
  95:     { id: 'google-icons-chooser', name: 'Google Icons Chooser', icon: 'apps', category: 'data', description: 'Browse Google Material icons and generate code snippets' },
  96:     { id: 'color-chooser', name: 'Color Chooser', icon: 'palette', category: 'data', description: 'Pick colors, find matches, and generate code snippets' },
  97:     { id: 'css-unit-converter', name: 'CSS Unit Converter', icon: 'straighten', category: 'convert', description: 'Convert px, em, rem, %, pt, vw, vh with context' },
  98:     { id: 'date-time-info', name: 'Date/Time Info', icon: 'schedule', category: 'data', description: 'View date/time across calendars, formats, and time zones' },
  99:     { id: 'random-numbers', name: 'Random Number Generator', icon: 'casino', category: 'data', description: 'Generate random numbers with range, decimals, uniqueness, and sorting' },
 100:     { id: 'hashing-tool', name: 'Hashing Tool', icon: 'lock', category: 'convert', description: 'Hash, encode, and decode text using various algorithms and formats' },
 101:     { id: 'json-tool', name: 'JSON Tool', icon: 'data_object', category: 'data', description: 'Format, validate, and convert JSON to JSONL format' },
 102:     { id: 'sitemap-generator', name: 'XML Sitemap Generator', icon: 'schema', category: 'data', description: 'Crawl (with optional CORS proxy) and build sitemap.xml' }
 103: ];
 104: 
 105: const toolGrid = document.getElementById('toolGrid');
 106: 
 107: function renderToolGrid(filter = '', category = 'all') {
 108:     toolGrid.innerHTML = '';
 109:     const filteredTools = [...tools]
 110:         .sort((a, b) => a.name.localeCompare(b.name))
 111:         .filter(tool => {
 112:         const matchesSearch = tool.name.toLowerCase().includes(filter.toLowerCase()) || tool.description.toLowerCase().includes(filter.toLowerCase());
 113:         const matchesCategory = category === 'all' || tool.category === category;
 114:         return matchesSearch && matchesCategory;
 115:     });
 116:     
 117:     filteredTools.forEach(tool => {
 118:         const card = document.createElement('a');
 119:         card.className = 'tool-card';
 120:         card.href = `${tool.id}.html`;
 121:         card.setAttribute('aria-label', `${tool.name} tool`);
 122: 
 123:         const iconContainer = document.createElement('div');
 124:         iconContainer.className = 'tool-icon';
 125:         const icon = document.createElement('span');
 126:         icon.className = 'material-icons';
 127:         icon.textContent = tool.icon;
 128:         iconContainer.appendChild(icon);
 129: 
 130:         const title = document.createElement('h3');
 131:         title.textContent = tool.name;
 132: 
 133:         const description = document.createElement('p');
 134:         description.textContent = tool.description;
 135: 
 136:         card.appendChild(iconContainer);
 137:         card.appendChild(title);
 138:         card.appendChild(description);
 139:         toolGrid.appendChild(card);
 140:     });
 141:     
 142:     if (filteredTools.length === 0) {
 143:         const emptyState = document.createElement('p');
 144:         emptyState.textContent = 'No tools found';
 145:         emptyState.style.gridColumn = '1 / -1';
 146:         emptyState.style.textAlign = 'center';
 147:         emptyState.style.color = 'var(--text-secondary)';
 148:         toolGrid.appendChild(emptyState);
 149:     }
 150: }
 151: 
 152: // No search input or filters on this page; always show all tools
 153: 
 154: renderToolGrid();
 155:     </script>
 156:     <footer class="site-footer">
 157:         <p>&copy; Ian Rastall 2025<br>Contact: moving.form.of.dust@gmail.com<br>Donate: PayPal to merastall@gmail.com</p>
 158:     </footer>
 159: </body>
 160: </html>
```
----- END FILE: index.html -----

----- BEGIN FILE: js/json-tool-page.js -----
```javascript
   1: 'use strict';
   2: 
   3: // DOM elements
   4: const processBtn = document.getElementById('processBtn');
   5: const processLabel = document.getElementById('processLabel');
   6: const copyBtn = document.getElementById('copyOutput');
   7: const clearBtn = document.getElementById('clearBtn');
   8: const exampleBtn = document.getElementById('exampleBtn');
   9: const backBtn = document.getElementById('backButton');
  10: const modeTabs = document.querySelectorAll('.mode-tab');
  11: const modeTabPanels = document.querySelectorAll('.mode-tab-panel');
  12: const indentSelect = document.getElementById('indentSelect');
  13: const sortKeysCheck = document.getElementById('sortKeysCheck');
  14: const errorPanel = document.getElementById('errorPanel');
  15: const errorTitleText = document.getElementById('errorTitleText');
  16: const errorMessage = document.getElementById('errorMessage');
  17: const statsPanel = document.getElementById('statsPanel');
  18: const optionsPanel = document.getElementById('optionsPanel');
  19: const queryPanel = document.getElementById('queryPanel');
  20: const schemaPanel = document.getElementById('schemaPanel');
  21: const jmespathQuery = document.getElementById('jmespathQuery');
  22: const infoTitle = document.getElementById('infoTitle');
  23: const infoText = document.getElementById('infoText');
  24: const inputLabelText = document.getElementById('inputLabelText');
  25: const outputLabel = document.getElementById('outputLabel');
  26: const statusMessage = document.getElementById('statusMessage');
  27: const processingTime = document.getElementById('processingTime');
  28: const inputStats = document.getElementById('inputStats');
  29: const outputStats = document.getElementById('outputStats');
  30: const statObjects = document.getElementById('statObjects');
  31: const statArrays = document.getElementById('statArrays');
  32: const statKeys = document.getElementById('statKeys');
  33: const statDepth = document.getElementById('statDepth');
  34: const fileDropZone = document.getElementById('fileDropZone');
  35: const chooseFileBtn = document.getElementById('chooseFileBtn');
  36: const fileInput = document.getElementById('fileInput');
  37: const fileMeta = document.getElementById('fileMeta');
  38: const inputEditorHost = document.getElementById('inputEditor');
  39: const outputEditorHost = document.getElementById('outputEditor');
  40: const schemaEditorHost = document.getElementById('schemaEditor');
  41: 
  42: // State
  43: let currentMode = 'format';
  44: let inputEditor = null;
  45: let outputEditor = null;
  46: let schemaEditor = null;
  47: let jsonWorker = null;
  48: let workerJobCounter = 0;
  49: let isProcessing = false;
  50: let inputStatsRaf = 0;
  51: let statsDebounceTimer = 0;
  52: let latestStatsTicket = 0;
  53: let activeFileLoadId = 0;
  54: let themeObserver = null;
  55: const pendingWorkerJobs = new Map();
  56: 
  57: const LARGE_FILE_THRESHOLD_BYTES = 5 * 1024 * 1024;
  58: const JSONL_STREAM_THRESHOLD_BYTES = 100 * 1024;
  59: const STREAM_READ_YIELD_INTERVAL = 8;
  60: const ANALYZE_DEBOUNCE_MS = 300;
  61: const DEFAULT_FILE_META = 'Supports `.json`, `.jsonl`, `.ndjson`, and plain text files.';
  62: const WORKER_PATH = '/js/json-worker.js';
  63: const ACE_BASE_PATH = 'https://cdnjs.cloudflare.com/ajax/libs/ace/1.32.3/';
  64: const STREAM_PROGRESS_UPDATE_INTERVAL_MS = 100;
  65: 
  66: const exampleJSON = {
  67:     users: [
  68:         { id: 1, name: 'Alice Johnson', email: 'alice@example.com', age: 28, active: true },
  69:         { id: 2, name: 'Bob Smith', email: 'bob@example.com', age: 34, active: false },
  70:         { id: 3, name: 'Carol White', email: 'carol@example.com', age: 31, active: true }
  71:     ],
  72:     metadata: {
  73:         total: 3,
  74:         page: 1,
  75:         timestamp: '2024-01-15T10:30:00Z'
  76:     }
  77: };
  78: 
  79: const exampleJSONL = [
  80:     '{"id":1,"name":"Alice Johnson","active":true}',
  81:     '{"id":2,"name":"Bob Smith","active":false}',
  82:     '{"id":3,"name":"Carol White","active":true}'
  83: ].join('\n');
  84: 
  85: const exampleSchema = {
  86:     type: 'object',
  87:     required: ['users', 'metadata'],
  88:     properties: {
  89:         users: {
  90:             type: 'array',
  91:             items: {
  92:                 type: 'object',
  93:                 required: ['id', 'name', 'email', 'active'],
  94:                 properties: {
  95:                     id: { type: 'integer' },
  96:                     name: { type: 'string' },
  97:                     email: { type: 'string', format: 'email' },
  98:                     age: { type: 'integer' },
  99:                     active: { type: 'boolean' }
 100:                 }
 101:             }
 102:         },
 103:         metadata: {
 104:             type: 'object',
 105:             required: ['total'],
 106:             properties: {
 107:                 total: { type: 'integer' },
 108:                 page: { type: 'integer' },
 109:                 timestamp: { type: 'string' }
 110:             }
 111:         }
 112:     }
 113: };
 114: 
 115: const modeInfo = {
 116:     format: {
 117:         title: 'JSON Formatting',
 118:         text: 'Format JSON with optional key sorting and optional JMESPath pre-filtering. Syntax parsing and structural analysis run in a background worker.',
 119:         inputLabel: 'Input JSON',
 120:         outputLabel: 'Formatted Output',
 121:         outputAceMode: 'ace/mode/json',
 122:         showOptions: true,
 123:         showQuery: true,
 124:         showSchema: false,
 125:         actionLabel: 'Format',
 126:         actionIcon: 'play_arrow'
 127:     },
 128:     jsonl: {
 129:         title: 'JSON to JSONL Conversion',
 130:         text: 'Convert JSON (typically arrays) to JSON Lines. Use a JMESPath query to pre-filter or extract a subset before conversion.',
 131:         inputLabel: 'Input JSON',
 132:         outputLabel: 'JSONL Output',
 133:         outputAceMode: 'ace/mode/json',
 134:         showOptions: false,
 135:         showQuery: true,
 136:         showSchema: false,
 137:         actionLabel: 'Convert',
 138:         actionIcon: 'play_arrow'
 139:     },
 140:     jsonlToJson: {
 141:         title: 'JSONL to JSON Conversion',
 142:         text: 'Parse JSON Lines (one JSON value per line), skip empty lines, and re-stringify as a valid JSON array. Large inputs are processed in a background worker.',
 143:         inputLabel: 'Input JSONL',
 144:         outputLabel: 'JSON Output',
 145:         outputAceMode: 'ace/mode/json',
 146:         showOptions: true,
 147:         showQuery: false,
 148:         showSchema: false,
 149:         actionLabel: 'Convert',
 150:         actionIcon: 'play_arrow'
 151:     },
 152:     validate: {
 153:         title: 'JSON Validation',
 154:         text: 'Validate JSON syntax with JSONLint for precise line/character errors. Optionally validate against a JSON Schema using Ajv.',
 155:         inputLabel: 'Input JSON',
 156:         outputLabel: 'Validation Result',
 157:         outputAceMode: 'ace/mode/text',
 158:         showOptions: false,
 159:         showQuery: false,
 160:         showSchema: true,
 161:         actionLabel: 'Validate',
 162:         actionIcon: 'check_circle'
 163:     }
 164: };
 165: 
 166: function initAceEditors() {
 167:     if (!window.ace) {
 168:         throw new Error('Ace Editor failed to load from CDN.');
 169:     }
 170: 
 171:     ace.config.set('basePath', ACE_BASE_PATH);
 172:     ace.config.set('modePath', ACE_BASE_PATH);
 173:     ace.config.set('themePath', ACE_BASE_PATH);
 174: 
 175:     inputEditor = ace.edit(inputEditorHost);
 176:     outputEditor = ace.edit(outputEditorHost);
 177:     schemaEditor = ace.edit(schemaEditorHost);
 178: 
 179:     configureEditor(inputEditor, { readOnly: false, mode: 'ace/mode/json' });
 180:     configureEditor(outputEditor, { readOnly: true, mode: 'ace/mode/json' });
 181:     outputEditor.setOptions({
 182:         highlightActiveLine: false,
 183:         highlightGutterLine: false
 184:     });
 185:     configureEditor(schemaEditor, { readOnly: false, mode: 'ace/mode/json' });
 186: 
 187:     inputEditor.commands.addCommand({
 188:         name: 'process-json-tool',
 189:         bindKey: { win: 'Ctrl-Enter', mac: 'Command-Enter' },
 190:         exec: () => processJSON()
 191:     });
 192: }
 193: 
 194: function configureEditor(editor, options) {
 195:     editor.setOptions({
 196:         readOnly: Boolean(options.readOnly),
 197:         showPrintMargin: false,
 198:         useWorker: false,
 199:         wrap: true,
 200:         fontSize: '14px',
 201:         tabSize: 2,
 202:         useSoftTabs: true,
 203:         displayIndentGuides: true,
 204:         behavioursEnabled: true
 205:     });
 206:     editor.session.setMode(options.mode || 'ace/mode/json');
 207:     editor.session.setUseWorker(false);
 208:     editor.session.setUseWrapMode(true);
 209:     editor.session.setTabSize(2);
 210:     editor.session.setUseSoftTabs(true);
 211:     editor.renderer.setShowPrintMargin(false);
 212:     editor.renderer.setScrollMargin(8, 8, 8, 8);
 213: }
 214: function applyEditorTheme() {
 215:     const isLight = document.documentElement.getAttribute('data-theme') === 'light';
 216:     const aceTheme = isLight ? 'ace/theme/github' : 'ace/theme/monokai';
 217:     [inputEditor, outputEditor, schemaEditor].forEach(editor => {
 218:         if (editor) {
 219:             editor.setTheme(aceTheme);
 220:         }
 221:     });
 222: }
 223: 
 224: function setupThemeSync() {
 225:     applyEditorTheme();
 226: 
 227:     if (themeObserver) {
 228:         themeObserver.disconnect();
 229:     }
 230: 
 231:     themeObserver = new MutationObserver(mutations => {
 232:         for (const mutation of mutations) {
 233:             if (mutation.type === 'attributes' && mutation.attributeName === 'data-theme') {
 234:                 applyEditorTheme();
 235:                 break;
 236:             }
 237:         }
 238:     });
 239: 
 240:     themeObserver.observe(document.documentElement, {
 241:         attributes: true,
 242:         attributeFilter: ['data-theme']
 243:     });
 244: }
 245: 
 246: function ensureWorker() {
 247:     if (jsonWorker) {
 248:         return jsonWorker;
 249:     }
 250: 
 251:     if (!window.Worker) {
 252:         throw new Error('Web Workers are not supported in this browser.');
 253:     }
 254: 
 255:     jsonWorker = new Worker(WORKER_PATH);
 256: 
 257:     jsonWorker.addEventListener('message', event => {
 258:         const data = event.data || {};
 259:         const pending = pendingWorkerJobs.get(data.jobId);
 260:         if (!pending) {
 261:             return;
 262:         }
 263: 
 264:         pendingWorkerJobs.delete(data.jobId);
 265:         if (data.ok) {
 266:             pending.resolve(data);
 267:         } else {
 268:             pending.reject(data);
 269:         }
 270:     });
 271: 
 272:     jsonWorker.addEventListener('error', event => {
 273:         console.error('JSON worker error:', event);
 274:         const fatalPayload = {
 275:             error: {
 276:                 errorType: 'processing',
 277:                 title: 'Worker Error',
 278:                 message: event.message || 'The background JSON worker failed.'
 279:             }
 280:         };
 281: 
 282:         for (const pending of pendingWorkerJobs.values()) {
 283:             pending.reject(fatalPayload);
 284:         }
 285:         pendingWorkerJobs.clear();
 286: 
 287:         try {
 288:             jsonWorker.terminate();
 289:         } catch (_) {
 290:             // Ignore terminate failures.
 291:         }
 292:         jsonWorker = null;
 293:     });
 294: 
 295:     return jsonWorker;
 296: }
 297: 
 298: function runWorkerJob(action, payload) {
 299:     const worker = ensureWorker();
 300:     return new Promise((resolve, reject) => {
 301:         const jobId = ++workerJobCounter;
 302:         pendingWorkerJobs.set(jobId, { resolve, reject });
 303:         worker.postMessage({ jobId, action, payload });
 304:     });
 305: }
 306: 
 307: function setActiveTab(activeTab) {
 308:     let activePanelId = '';
 309: 
 310:     modeTabs.forEach(tab => {
 311:         const isActive = tab === activeTab;
 312:         tab.classList.toggle('active', isActive);
 313:         tab.setAttribute('aria-selected', isActive ? 'true' : 'false');
 314:         tab.setAttribute('tabindex', isActive ? '0' : '-1');
 315:         if (isActive) {
 316:             activePanelId = tab.getAttribute('aria-controls') || '';
 317:         }
 318:     });
 319: 
 320:     modeTabPanels.forEach(panel => {
 321:         const isActive = panel.id === activePanelId;
 322:         panel.hidden = !isActive;
 323:         panel.setAttribute('aria-hidden', isActive ? 'false' : 'true');
 324:     });
 325: }
 326: 
 327: function setOutputEditorMode(modePath) {
 328:     if (!outputEditor) {
 329:         return;
 330:     }
 331:     outputEditor.session.setMode(modePath || 'ace/mode/text');
 332:     outputEditor.session.setUseWorker(false);
 333: }
 334: 
 335: function updateModeUI() {
 336:     const info = modeInfo[currentMode];
 337:     if (!info) {
 338:         throw new Error(`Unknown mode: ${currentMode}`);
 339:     }
 340: 
 341:     infoTitle.textContent = info.title;
 342:     infoText.textContent = info.text;
 343:     inputLabelText.textContent = info.inputLabel;
 344:     outputLabel.textContent = info.outputLabel;
 345: 
 346:     optionsPanel.style.display = info.showOptions ? 'block' : 'none';
 347:     queryPanel.classList.toggle('show', info.showQuery);
 348:     schemaPanel.classList.toggle('show', info.showSchema);
 349: 
 350:     const processIcon = processBtn.querySelector('.material-icons');
 351:     if (processIcon) {
 352:         processIcon.textContent = info.actionIcon;
 353:     }
 354:     processLabel.textContent = info.actionLabel;
 355:     setOutputEditorMode(info.outputAceMode);
 356: 
 357:     hideError();
 358:     hideStats();
 359:     scheduleAsyncInputAnalysis();
 360: 
 361:     requestAnimationFrame(() => {
 362:         inputEditor.resize(true);
 363:         outputEditor.resize(true);
 364:         if (info.showSchema) {
 365:             schemaEditor.resize(true);
 366:         }
 367:     });
 368: }
 369: 
 370: function displayStats(stats) {
 371:     if (!stats) {
 372:         hideStats();
 373:         return;
 374:     }
 375: 
 376:     statObjects.textContent = Number.isFinite(stats.objects) ? stats.objects : 0;
 377:     statArrays.textContent = Number.isFinite(stats.arrays) ? stats.arrays : 0;
 378:     statKeys.textContent = Number.isFinite(stats.keys) ? stats.keys : 0;
 379:     statDepth.textContent = Number.isFinite(stats.maxDepth) ? stats.maxDepth : 0;
 380:     statsPanel.style.display = 'grid';
 381: }
 382: 
 383: function hideStats() {
 384:     statsPanel.style.display = 'none';
 385: }
 386: 
 387: function hideError() {
 388:     errorPanel.classList.remove('show');
 389:     errorPanel.setAttribute('aria-hidden', 'true');
 390:     errorTitleText.textContent = 'Syntax Error';
 391:     errorMessage.textContent = '';
 392: }
 393: 
 394: function getErrorTitle(error) {
 395:     switch (error && error.errorType) {
 396:         case 'schema':
 397:             return 'Schema Validation Failed';
 398:         case 'schemaSyntax':
 399:             return 'Schema Syntax Error';
 400:         case 'query':
 401:             return 'JMESPath Query Error';
 402:         case 'processing':
 403:             return 'Processing Error';
 404:         default:
 405:             return 'Syntax Error';
 406:     }
 407: }
 408: 
 409: function showErrorPanel(error) {
 410:     const normalized = error && typeof error === 'object'
 411:         ? error
 412:         : { message: String(error) };
 413: 
 414:     errorTitleText.textContent = normalized.title || getErrorTitle(normalized);
 415: 
 416:     const lines = [];
 417:     const message = normalized.message ? String(normalized.message) : 'An unknown error occurred.';
 418:     lines.push(message);
 419: 
 420:     if (normalized.line || normalized.column) {
 421:         const parts = [];
 422:         if (normalized.line) {
 423:             parts.push(`Line ${normalized.line}`);
 424:         }
 425:         if (normalized.column) {
 426:             parts.push(`Character ${normalized.column}`);
 427:         }
 428:         const hasLineInMessage = /line\s+\d+/i.test(message);
 429:         const hasColumnInMessage = /(?:column|character)\s+\d+/i.test(message);
 430:         const shouldAppendLocation = parts.length > 0
 431:             && (!hasLineInMessage || (normalized.column && !hasColumnInMessage));
 432:         if (shouldAppendLocation) {
 433:             lines.push(`Location: ${parts.join(', ')}`);
 434:         }
 435:     }
 436: 
 437:     if (normalized.source === 'schema') {
 438:         lines.push('Source: Schema input');
 439:     }
 440: 
 441:     errorMessage.textContent = lines.join('\n\n');
 442:     errorPanel.classList.add('show');
 443:     errorPanel.setAttribute('aria-hidden', 'false');
 444: }
 445: 
 446: function showStatus(message, type = 'success') {
 447:     statusMessage.textContent = message;
 448:     statusMessage.className = type;
 449: }
 450: function formatCounts(chars, lines) {
 451:     return `${chars} chars, ${lines} lines`;
 452: }
 453: 
 454: function updateInputStatsLabel(rawInput) {
 455:     const text = typeof rawInput === 'string' ? rawInput : inputEditor.getValue();
 456:     const lines = text.length === 0
 457:         ? 0
 458:         : (typeof rawInput === 'string' ? text.split(/\r?\n/).length : inputEditor.session.getLength());
 459:     inputStats.textContent = formatCounts(text.length, lines);
 460: }
 461: 
 462: function updateOutputStatsLabel(rawOutput) {
 463:     const text = typeof rawOutput === 'string' ? rawOutput : outputEditor.getValue();
 464:     const lines = text.length === 0
 465:         ? 0
 466:         : (typeof rawOutput === 'string' ? text.split(/\r?\n/).length : outputEditor.session.getLength());
 467:     outputStats.textContent = formatCounts(text.length, lines);
 468: }
 469: 
 470: function queueInputStatsLabelUpdate() {
 471:     if (inputStatsRaf) {
 472:         return;
 473:     }
 474: 
 475:     inputStatsRaf = requestAnimationFrame(() => {
 476:         inputStatsRaf = 0;
 477:         updateInputStatsLabel();
 478:     });
 479: }
 480: 
 481: function setInputEditorValue(text) {
 482:     inputEditor.setValue(text || '', -1);
 483:     inputEditor.clearSelection();
 484:     queueInputStatsLabelUpdate();
 485:     scheduleAsyncInputAnalysis();
 486: }
 487: 
 488: function setOutputEditorValue(text, modePath) {
 489:     if (modePath) {
 490:         setOutputEditorMode(modePath);
 491:     }
 492:     outputEditor.setValue(text || '', -1);
 493:     outputEditor.clearSelection();
 494:     updateOutputStatsLabel(text || '');
 495: }
 496: 
 497: function setProcessingState(busy) {
 498:     isProcessing = Boolean(busy);
 499:     processBtn.disabled = isProcessing;
 500:     chooseFileBtn.disabled = isProcessing;
 501: 
 502:     modeTabs.forEach(tab => {
 503:         tab.disabled = isProcessing;
 504:     });
 505: }
 506: 
 507: function buildWorkerPayload(rawInput) {
 508:     return {
 509:         rawInput,
 510:         mode: currentMode,
 511:         options: {
 512:             indent: indentSelect.value,
 513:             sortKeys: Boolean(sortKeysCheck.checked),
 514:             query: jmespathQuery.value || '',
 515:             schemaText: schemaEditor.getValue()
 516:         }
 517:     };
 518: }
 519: 
 520: function safeFirstLine(text) {
 521:     return String(text || '').split(/\r?\n/, 1)[0] || 'Processing failed';
 522: }
 523: 
 524: async function processJSON() {
 525:     const rawInput = inputEditor.getValue();
 526: 
 527:     if (!rawInput.trim()) {
 528:         hideError();
 529:         setOutputEditorValue('', modeInfo[currentMode].outputAceMode);
 530:         hideStats();
 531:         showStatus('Please enter some JSON/JSONL to process.', 'warning');
 532:         processingTime.textContent = 'No operations yet';
 533:         return;
 534:     }
 535: 
 536:     hideError();
 537:     setProcessingState(true);
 538:     const startedAt = performance.now();
 539: 
 540:     try {
 541:         const response = await runWorkerJob('process', buildWorkerPayload(rawInput));
 542: 
 543:         if (response.stats) {
 544:             displayStats(response.stats);
 545:         } else {
 546:             hideStats();
 547:         }
 548: 
 549:         setOutputEditorValue(
 550:             response.resultText || '',
 551:             response.outputMode || modeInfo[currentMode].outputAceMode
 552:         );
 553: 
 554:         showStatus(response.message || 'Success!', 'success');
 555: 
 556:         const totalMs = Math.round(performance.now() - startedAt);
 557:         const workerMs = Number.isFinite(response.durationMs)
 558:             ? ` (worker ${Math.round(response.durationMs)}ms)`
 559:             : '';
 560:         processingTime.textContent = `Processed in ${totalMs}ms${workerMs}`;
 561:     } catch (failure) {
 562:         console.error('Processing error:', failure);
 563: 
 564:         const payload = failure && typeof failure === 'object' ? failure : {};
 565:         const error = payload.error || { message: String(failure), errorType: 'processing' };
 566: 
 567:         if (payload.stats) {
 568:             displayStats(payload.stats);
 569:         } else {
 570:             hideStats();
 571:         }
 572: 
 573:         if (typeof payload.validationReport === 'string') {
 574:             setOutputEditorValue(payload.validationReport, 'ace/mode/text');
 575:         } else {
 576:             setOutputEditorValue('', modeInfo[currentMode].outputAceMode);
 577:         }
 578: 
 579:         showErrorPanel(error);
 580:         showStatus(`Error: ${safeFirstLine(error.message)}`, 'error');
 581:         processingTime.textContent = `Processing failed after ${Math.round(performance.now() - startedAt)}ms`;
 582:     } finally {
 583:         setProcessingState(false);
 584:     }
 585: }
 586: 
 587: function buildExampleInputForMode(mode) {
 588:     return mode === 'jsonlToJson'
 589:         ? exampleJSONL
 590:         : JSON.stringify(exampleJSON, null, 2);
 591: }
 592: 
 593: function loadExample() {
 594:     hideError();
 595:     setInputEditorValue(buildExampleInputForMode(currentMode));
 596:     setOutputEditorValue('', modeInfo[currentMode].outputAceMode);
 597:     hideStats();
 598: 
 599:     if (currentMode === 'validate' && !schemaEditor.getValue().trim()) {
 600:         schemaEditor.setValue(JSON.stringify(exampleSchema, null, 2), -1);
 601:         schemaEditor.clearSelection();
 602:     }
 603: 
 604:     fileMeta.textContent = DEFAULT_FILE_META;
 605:     showStatus('Example loaded', 'success');
 606:     processingTime.textContent = 'Ready to process example';
 607: }
 608: 
 609: function clearAll() {
 610:     activeFileLoadId += 1;
 611:     latestStatsTicket += 1;
 612:     clearTimeout(statsDebounceTimer);
 613: 
 614:     hideError();
 615:     hideStats();
 616:     jmespathQuery.value = '';
 617:     schemaEditor.setValue('', -1);
 618:     schemaEditor.clearSelection();
 619:     setInputEditorValue('');
 620:     setOutputEditorValue('', modeInfo[currentMode].outputAceMode);
 621:     fileMeta.textContent = DEFAULT_FILE_META;
 622:     showStatus('Cleared', 'success');
 623:     processingTime.textContent = 'No operations yet';
 624: }
 625: 
 626: async function copyToClipboard() {
 627:     const text = outputEditor.getValue();
 628:     if (!text) {
 629:         showStatus('Nothing to copy', 'warning');
 630:         return;
 631:     }
 632: 
 633:     try {
 634:         if (typeof window.textUtilsClipboardWrite === 'function') {
 635:             await window.textUtilsClipboardWrite(text);
 636:         } else if (navigator.clipboard && typeof navigator.clipboard.writeText === 'function') {
 637:             await navigator.clipboard.writeText(text);
 638:         } else {
 639:             throw new Error('Clipboard API unavailable');
 640:         }
 641:         showStatus('Copied to clipboard!', 'success');
 642:     } catch {
 643:         showStatus('Copy failed', 'error');
 644:     }
 645: }
 646: 
 647: function scheduleAsyncInputAnalysis() {
 648:     if (!inputEditor) {
 649:         return;
 650:     }
 651: 
 652:     const rawInput = inputEditor.getValue();
 653:     if (!rawInput.trim()) {
 654:         hideStats();
 655:         return;
 656:     }
 657: 
 658:     latestStatsTicket += 1;
 659:     const ticket = latestStatsTicket;
 660:     clearTimeout(statsDebounceTimer);
 661: 
 662:     statsDebounceTimer = window.setTimeout(async () => {
 663:         try {
 664:             const response = await runWorkerJob('analyzeInput', {
 665:                 rawInput: inputEditor.getValue(),
 666:                 mode: currentMode
 667:             });
 668: 
 669:             if (ticket !== latestStatsTicket) {
 670:                 return;
 671:             }
 672: 
 673:             if (response.valid && response.stats) {
 674:                 displayStats(response.stats);
 675:             } else if (!isProcessing) {
 676:                 hideStats();
 677:             }
 678:         } catch {
 679:             if (ticket === latestStatsTicket && !isProcessing) {
 680:                 hideStats();
 681:             }
 682:         }
 683:     }, ANALYZE_DEBOUNCE_MS);
 684: }
 685: function formatBytes(bytes) {
 686:     if (!Number.isFinite(bytes) || bytes < 0) {
 687:         return '0 B';
 688:     }
 689: 
 690:     const units = ['B', 'KB', 'MB', 'GB'];
 691:     let value = bytes;
 692:     let unitIndex = 0;
 693:     while (value >= 1024 && unitIndex < units.length - 1) {
 694:         value /= 1024;
 695:         unitIndex += 1;
 696:     }
 697:     return `${value >= 10 || unitIndex === 0 ? value.toFixed(0) : value.toFixed(1)} ${units[unitIndex]}`;
 698: }
 699: 
 700: function shouldUseStreamRead(file) {
 701:     return Boolean(
 702:         file
 703:         && typeof file.stream === 'function'
 704:         && (file.size >= LARGE_FILE_THRESHOLD_BYTES
 705:             || ((currentMode === 'jsonl' || currentMode === 'jsonlToJson')
 706:                 && file.size >= JSONL_STREAM_THRESHOLD_BYTES))
 707:     );
 708: }
 709: 
 710: function waitForNextTick() {
 711:     return new Promise(resolve => setTimeout(resolve, 0));
 712: }
 713: 
 714: async function readFileAsTextStream(file, loadId) {
 715:     const reader = file.stream().getReader();
 716:     const decoder = new TextDecoder();
 717:     const chunks = [];
 718:     let bytesRead = 0;
 719:     let chunkCount = 0;
 720:     let lastProgressUpdateAt = 0;
 721: 
 722:     try {
 723:         while (true) {
 724:             if (loadId !== activeFileLoadId) {
 725:                 try {
 726:                     await reader.cancel();
 727:                 } catch (_) {
 728:                     // Ignore cancel failures when a newer load starts.
 729:                 }
 730:                 throw new Error('File load superseded.');
 731:             }
 732: 
 733:             const { done, value } = await reader.read();
 734:             if (done) {
 735:                 break;
 736:             }
 737: 
 738:             bytesRead += value.byteLength;
 739:             chunks.push(decoder.decode(value, { stream: true }));
 740: 
 741:             const now = Date.now();
 742:             if (now - lastProgressUpdateAt >= STREAM_PROGRESS_UPDATE_INTERVAL_MS) {
 743:                 fileMeta.textContent = `${file.name}  ${formatBytes(bytesRead)} / ${formatBytes(file.size)} (streaming)`;
 744:                 lastProgressUpdateAt = now;
 745:             }
 746: 
 747:             chunkCount += 1;
 748:             if (chunkCount % STREAM_READ_YIELD_INTERVAL === 0) {
 749:                 await waitForNextTick();
 750:             }
 751:         }
 752: 
 753:         chunks.push(decoder.decode());
 754:         return chunks.join('');
 755:     } finally {
 756:         try {
 757:             reader.releaseLock();
 758:         } catch (_) {
 759:             // Ignore release failures.
 760:         }
 761:     }
 762: }
 763: 
 764: async function readFileAsText(file, loadId) {
 765:     if (shouldUseStreamRead(file)) {
 766:         return readFileAsTextStream(file, loadId);
 767:     }
 768: 
 769:     return file.text();
 770: }
 771: 
 772: async function loadFileIntoEditor(file) {
 773:     if (!file) {
 774:         return;
 775:     }
 776: 
 777:     if (isProcessing) {
 778:         showStatus('Please wait for the current operation to finish before loading a file.', 'warning');
 779:         return;
 780:     }
 781: 
 782:     const loadId = ++activeFileLoadId;
 783:     hideError();
 784:     showStatus(`Loading ${file.name}...`, 'success');
 785:     processingTime.textContent = 'Loading file from disk...';
 786:     fileMeta.textContent = `${file.name}  ${formatBytes(file.size)}`;
 787: 
 788:     try {
 789:         const rawText = await readFileAsText(file, loadId);
 790:         if (loadId !== activeFileLoadId) {
 791:             return;
 792:         }
 793: 
 794:         setInputEditorValue(rawText);
 795:         setOutputEditorValue('', modeInfo[currentMode].outputAceMode);
 796:         hideError();
 797: 
 798:         fileMeta.textContent = `${file.name}  ${formatBytes(file.size)}  loaded`;
 799:         processingTime.textContent = `Loaded ${formatBytes(file.size)} from disk`;
 800: 
 801:         const largeHint = rawText.length >= LARGE_FILE_THRESHOLD_BYTES
 802:             ? ' Large input loaded; processing will run in the background worker.'
 803:             : '';
 804:         showStatus(`Loaded ${file.name}.${largeHint}`, 'success');
 805:     } catch (error) {
 806:         if (String(error && error.message).includes('superseded')) {
 807:             return;
 808:         }
 809: 
 810:         console.error('File load error:', error);
 811:         const message = error && error.message ? error.message : String(error);
 812:         showErrorPanel({
 813:             errorType: 'processing',
 814:             title: 'File Load Error',
 815:             message
 816:         });
 817:         showStatus(`Error: ${safeFirstLine(message)}`, 'error');
 818:         processingTime.textContent = 'File load failed';
 819:     }
 820: }
 821: 
 822: function handleModeTabClick(tab) {
 823:     if (isProcessing) {
 824:         return;
 825:     }
 826:     setActiveTab(tab);
 827:     currentMode = tab.dataset.mode;
 828:     updateModeUI();
 829: }
 830: 
 831: function setupModeTabs() {
 832:     modeTabs.forEach(tab => {
 833:         tab.addEventListener('click', () => handleModeTabClick(tab));
 834:     });
 835: 
 836:     modeTabs.forEach((tab, index) => {
 837:         tab.addEventListener('keydown', event => {
 838:             if (!['ArrowLeft', 'ArrowRight', 'Home', 'End'].includes(event.key)) {
 839:                 return;
 840:             }
 841: 
 842:             event.preventDefault();
 843:             let nextIndex = index;
 844: 
 845:             if (event.key === 'ArrowRight') {
 846:                 nextIndex = (index + 1) % modeTabs.length;
 847:             } else if (event.key === 'ArrowLeft') {
 848:                 nextIndex = (index - 1 + modeTabs.length) % modeTabs.length;
 849:             } else if (event.key === 'Home') {
 850:                 nextIndex = 0;
 851:             } else if (event.key === 'End') {
 852:                 nextIndex = modeTabs.length - 1;
 853:             }
 854: 
 855:             const nextTab = modeTabs[nextIndex];
 856:             nextTab.focus();
 857:             nextTab.click();
 858:         });
 859:     });
 860: }
 861: 
 862: function setupFileDropZone() {
 863:     function preventDefaults(event) {
 864:         event.preventDefault();
 865:         event.stopPropagation();
 866:     }
 867: 
 868:     ['dragenter', 'dragover'].forEach(eventName => {
 869:         fileDropZone.addEventListener(eventName, event => {
 870:             preventDefaults(event);
 871:             if (!isProcessing) {
 872:                 fileDropZone.classList.add('drag-active');
 873:             }
 874:         });
 875:     });
 876: 
 877:     ['dragleave', 'drop'].forEach(eventName => {
 878:         fileDropZone.addEventListener(eventName, event => {
 879:             preventDefaults(event);
 880:             fileDropZone.classList.remove('drag-active');
 881:         });
 882:     });
 883: 
 884:     fileDropZone.addEventListener('drop', event => {
 885:         if (isProcessing) {
 886:             return;
 887:         }
 888:         const files = event.dataTransfer && event.dataTransfer.files;
 889:         if (files && files.length > 0) {
 890:             loadFileIntoEditor(files[0]);
 891:         }
 892:     });
 893:     fileDropZone.addEventListener('click', event => {
 894:         if (isProcessing) {
 895:             return;
 896:         }
 897:         if (event.target.closest('#chooseFileBtn')) {
 898:             return;
 899:         }
 900:         fileInput.click();
 901:     });
 902: 
 903:     chooseFileBtn.addEventListener('click', event => {
 904:         event.stopPropagation();
 905:         if (!isProcessing) {
 906:             fileInput.click();
 907:         }
 908:     });
 909: 
 910:     fileInput.addEventListener('change', () => {
 911:         const file = fileInput.files && fileInput.files[0];
 912:         if (file) {
 913:             loadFileIntoEditor(file);
 914:         }
 915:         fileInput.value = '';
 916:     });
 917: }
 918: 
 919: function setupEventListeners() {
 920:     processBtn.addEventListener('click', processJSON);
 921:     copyBtn.addEventListener('click', copyToClipboard);
 922:     clearBtn.addEventListener('click', clearAll);
 923:     exampleBtn.addEventListener('click', loadExample);
 924:     backBtn.addEventListener('click', () => {
 925:         window.location.href = 'index.html';
 926:     });
 927: 
 928:     jmespathQuery.addEventListener('keydown', event => {
 929:         if ((event.ctrlKey || event.metaKey) && event.key === 'Enter') {
 930:             event.preventDefault();
 931:             processJSON();
 932:         }
 933:     });
 934: 
 935:     inputEditor.session.on('change', () => {
 936:         queueInputStatsLabelUpdate();
 937:         scheduleAsyncInputAnalysis();
 938:     });
 939: 
 940:     inputEditor.on('paste', pastedText => {
 941:         const text = typeof pastedText === 'string'
 942:             ? pastedText
 943:             : (pastedText && typeof pastedText.text === 'string' ? pastedText.text : '');
 944:         if (text.length >= LARGE_FILE_THRESHOLD_BYTES) {
 945:             showStatus('Large paste detected. Parsing and formatting will run in a background worker.', 'warning');
 946:         }
 947:     });
 948: 
 949:     window.addEventListener('beforeunload', () => {
 950:         if (jsonWorker) {
 951:             try {
 952:                 jsonWorker.terminate();
 953:             } catch (_) {
 954:                 // Ignore terminate failures.
 955:             }
 956:         }
 957: 
 958:         if (themeObserver) {
 959:             themeObserver.disconnect();
 960:         }
 961:     });
 962: }
 963: 
 964: function initialize() {
 965:     try {
 966:         initAceEditors();
 967:     } catch (error) {
 968:         console.error('Ace editor initialization failed:', error);
 969:         hideStats();
 970:         showErrorPanel({
 971:             errorType: 'processing',
 972:             title: 'Editor Load Error',
 973:             message: 'The Ace editor failed to load from the CDN. Reload the page and check your network connection or content blocker settings.'
 974:         });
 975:         showStatus('Editor failed to load. Reload and check your network/CDN access.', 'error');
 976:         processingTime.textContent = 'Editor unavailable';
 977:         fileMeta.textContent = DEFAULT_FILE_META;
 978:         processBtn.disabled = true;
 979:         copyBtn.disabled = true;
 980:         clearBtn.disabled = true;
 981:         exampleBtn.disabled = true;
 982:         chooseFileBtn.disabled = true;
 983:         return;
 984:     }
 985: 
 986:     setupThemeSync();
 987:     setupModeTabs();
 988:     setupFileDropZone();
 989:     setupEventListeners();
 990: 
 991:     const initialTab = Array.from(modeTabs).find(tab => tab.dataset.mode === currentMode);
 992:     if (initialTab) {
 993:         setActiveTab(initialTab);
 994:     }
 995: 
 996:     updateInputStatsLabel('');
 997:     updateOutputStatsLabel('');
 998:     fileMeta.textContent = DEFAULT_FILE_META;
 999:     updateModeUI();
1000:     setOutputEditorValue('', modeInfo[currentMode].outputAceMode);
1001: 
1002:     // Warm up the worker so the first process call has less startup overhead.
1003:     try {
1004:         ensureWorker();
1005:     } catch (error) {
1006:         console.error(error);
1007:         showStatus('Worker initialization failed. Processing may not be available.', 'error');
1008:     }
1009: }
1010: 
1011: initialize();
```
----- END FILE: js/json-tool-page.js -----

----- BEGIN FILE: js/json-worker.js -----
```javascript
   1: 'use strict';
   2: 
   3: // Load optional heavy libraries inside the worker so parsing/validation/querying stays off the UI thread.
   4: const CDN_URLS = {
   5:     jsonlint: 'https://cdnjs.cloudflare.com/ajax/libs/jsonlint/1.6.0/jsonlint.min.js',
   6:     ajv: 'https://cdnjs.cloudflare.com/ajax/libs/ajv/8.12.0/ajv7.min.js',
   7:     jmespath: 'https://cdnjs.cloudflare.com/ajax/libs/jmespath.js/0.16.0/jmespath.min.js'
   8: };
   9: 
  10: const libraryStatus = {
  11:     jsonlint: false,
  12:     ajv: false,
  13:     jmespath: false
  14: };
  15: 
  16: const MAX_RECURSION_DEPTH = 100;
  17: 
  18: safeImport('jsonlint', CDN_URLS.jsonlint);
  19: safeImport('ajv', CDN_URLS.ajv);
  20: safeImport('jmespath', CDN_URLS.jmespath);
  21: 
  22: self.addEventListener('message', event => {
  23:     const data = event.data || {};
  24:     const jobId = data.jobId;
  25:     const action = data.action;
  26:     const payload = data.payload || {};
  27: 
  28:     if (typeof jobId !== 'number' || typeof action !== 'string') {
  29:         return;
  30:     }
  31: 
  32:     const startedAt = now();
  33: 
  34:     try {
  35:         let result;
  36:         if (action === 'process') {
  37:             result = processRequest(payload);
  38:         } else if (action === 'analyzeInput') {
  39:             result = analyzeInputRequest(payload);
  40:         } else {
  41:             throw makeCustomError('processing', `Unknown worker action: ${action}`);
  42:         }
  43: 
  44:         self.postMessage({
  45:             jobId,
  46:             action,
  47:             ok: true,
  48:             durationMs: now() - startedAt,
  49:             ...result
  50:         });
  51:     } catch (error) {
  52:         const normalized = normalizeThrownError(error);
  53:         const response = {
  54:             jobId,
  55:             action,
  56:             ok: false,
  57:             durationMs: now() - startedAt,
  58:             error: normalized.error || normalized
  59:         };
  60: 
  61:         if (normalized.stats) {
  62:             response.stats = normalized.stats;
  63:         }
  64:         if (typeof normalized.validationReport === 'string') {
  65:             response.validationReport = normalized.validationReport;
  66:         }
  67: 
  68:         self.postMessage(response);
  69:     }
  70: });
  71: 
  72: function safeImport(key, url) {
  73:     try {
  74:         importScripts(url);
  75:         libraryStatus[key] = true;
  76:     } catch (error) {
  77:         libraryStatus[key] = false;
  78:         // Keep running with fallbacks where possible.
  79:     }
  80: }
  81: 
  82: function now() {
  83:     if (typeof performance !== 'undefined' && typeof performance.now === 'function') {
  84:         return performance.now();
  85:     }
  86:     return Date.now();
  87: }
  88: 
  89: function processRequest(payload) {
  90:     const rawInput = typeof payload.rawInput === 'string' ? payload.rawInput : '';
  91:     const mode = typeof payload.mode === 'string' ? payload.mode : 'format';
  92:     const options = payload.options && typeof payload.options === 'object' ? payload.options : {};
  93: 
  94:     switch (mode) {
  95:         case 'format':
  96:             return processFormatMode(rawInput, options);
  97:         case 'jsonl':
  98:             return processJsonToJsonlMode(rawInput, options);
  99:         case 'jsonlToJson':
 100:             return processJsonlToJsonMode(rawInput, options);
 101:         case 'validate':
 102:             return processValidateMode(rawInput, options);
 103:         default:
 104:             throw makeCustomError('processing', `Unknown mode: ${mode}`);
 105:     }
 106: }
 107: 
 108: function analyzeInputRequest(payload) {
 109:     const rawInput = typeof payload.rawInput === 'string' ? payload.rawInput : '';
 110:     const mode = typeof payload.mode === 'string' ? payload.mode : 'format';
 111: 
 112:     if (!rawInput.trim()) {
 113:         return { valid: false };
 114:     }
 115: 
 116:     try {
 117:         let value;
 118:         if (mode === 'jsonlToJson') {
 119:             value = parseJsonLines(rawInput).data;
 120:         } else {
 121:             value = parseJsonText(rawInput, 'input');
 122:         }
 123:         return {
 124:             valid: true,
 125:             stats: analyzeJSON(value)
 126:         };
 127:     } catch {
 128:         return { valid: false };
 129:     }
 130: }
 131: 
 132: function processFormatMode(rawInput, options) {
 133:     let value = parseJsonText(rawInput, 'input');
 134:     value = applyQueryIfPresent(value, options.query);
 135: 
 136:     if (options.sortKeys) {
 137:         value = sortObjectKeys(value);
 138:     }
 139: 
 140:     const stats = analyzeJSON(value);
 141:     const resultText = stringifyJson(value, options.indent);
 142: 
 143:     return {
 144:         resultText,
 145:         outputMode: 'ace/mode/json',
 146:         stats,
 147:         message: 'JSON formatted successfully.'
 148:     };
 149: }
 150: 
 151: function processJsonToJsonlMode(rawInput, options) {
 152:     let value = parseJsonText(rawInput, 'input');
 153:     const hasQuery = typeof options.query === 'string' && options.query.trim().length > 0;
 154:     value = applyQueryIfPresent(value, options.query);
 155: 
 156:     const stats = analyzeJSON(value);
 157:     const conversion = convertJsonToJsonl(value, { allowSingleValue: hasQuery });
 158:     const querySingleValueWarning = hasQuery && conversion.singleValueOutput
 159:         ? ' Query returned a single value; output contains one JSONL line.'
 160:         : '';
 161: 
 162:     return {
 163:         resultText: conversion.text,
 164:         outputMode: 'ace/mode/json',
 165:         stats,
 166:         message: `Converted ${conversion.count} record(s) to JSONL.${querySingleValueWarning}`
 167:     };
 168: }
 169: 
 170: function processJsonlToJsonMode(rawInput, options) {
 171:     const parsed = parseJsonLines(rawInput);
 172:     let value = parsed.data;
 173: 
 174:     if (options.sortKeys) {
 175:         value = sortObjectKeys(value);
 176:     }
 177: 
 178:     const stats = analyzeJSON(value);
 179:     const resultText = stringifyJson(value, options.indent);
 180: 
 181:     return {
 182:         resultText,
 183:         outputMode: 'ace/mode/json',
 184:         stats,
 185:         message: `Converted ${parsed.recordCount} JSONL line(s) to a JSON array.`
 186:     };
 187: }
 188: 
 189: function processValidateMode(rawInput, options) {
 190:     const value = parseJsonText(rawInput, 'input');
 191:     const stats = analyzeJSON(value);
 192:     const schemaText = typeof options.schemaText === 'string' ? options.schemaText : '';
 193: 
 194:     if (schemaText.trim()) {
 195:         let schemaValue;
 196:         let validation;
 197: 
 198:         try {
 199:             schemaValue = parseSchemaText(schemaText);
 200:             validation = validateWithSchema(value, schemaValue);
 201:         } catch (error) {
 202:             if (error && typeof error === 'object') {
 203:                 if (error.error && typeof error.error === 'object') {
 204:                     error.stats = error.stats || stats;
 205:                 } else if (error.errorType === 'schemaSyntax' || error.errorType === 'schema') {
 206:                     throw { error, stats };
 207:                 }
 208:             }
 209:             throw error;
 210:         }
 211: 
 212:         if (!validation.valid) {
 213:             throw {
 214:                 error: {
 215:                     errorType: 'schema',
 216:                     title: 'Schema Validation Failed',
 217:                     message: `JSON is valid but failed schema validation (${validation.errors.length} violation(s)).`
 218:                 },
 219:                 stats,
 220:                 validationReport: buildSchemaFailureReport(validation.errors, stats)
 221:             };
 222:         }
 223: 
 224:         return {
 225:             resultText: buildValidationSuccessReport(value, stats, {
 226:                 schemaChecked: true,
 227:                 schemaErrorCount: 0
 228:             }),
 229:             outputMode: 'ace/mode/text',
 230:             stats,
 231:             message: 'JSON and schema validation passed.'
 232:         };
 233:     }
 234: 
 235:     return {
 236:         resultText: buildValidationSuccessReport(value, stats, {
 237:             schemaChecked: false,
 238:             schemaErrorCount: 0
 239:         }),
 240:         outputMode: 'ace/mode/text',
 241:         stats,
 242:         message: 'JSON is valid.'
 243:     };
 244: }
 245: function parseJsonText(text, source) {
 246:     try {
 247:         return parseJsonStrict(text);
 248:     } catch (error) {
 249:         throw makeParseError(error, text, source || 'input', 'syntax');
 250:     }
 251: }
 252: 
 253: function parseSchemaText(text) {
 254:     try {
 255:         return parseJsonStrict(text);
 256:     } catch (error) {
 257:         throw makeParseError(error, text, 'schema', 'schemaSyntax');
 258:     }
 259: }
 260: 
 261: function parseJsonStrict(text) {
 262:     if (self.jsonlint && typeof self.jsonlint.parse === 'function') {
 263:         return self.jsonlint.parse(text);
 264:     }
 265:     return JSON.parse(text);
 266: }
 267: 
 268: function parseJsonLines(text) {
 269:     const records = [];
 270:     let lineNumber = 1;
 271:     let startIndex = 0;
 272: 
 273:     while (startIndex <= text.length) {
 274:         let endIndex = text.indexOf('\n', startIndex);
 275:         if (endIndex === -1) {
 276:             endIndex = text.length;
 277:         }
 278: 
 279:         let line = text.slice(startIndex, endIndex);
 280:         if (line.endsWith('\r')) {
 281:             line = line.slice(0, -1);
 282:         }
 283: 
 284:         if (line.trim()) {
 285:             try {
 286:                 records.push(parseJsonStrict(line));
 287:             } catch (error) {
 288:                 const lineError = makeParseError(error, line, 'input', 'syntax');
 289:                 lineError.line = lineNumber;
 290:                 if (!lineError.message.toLowerCase().includes('jsonl')) {
 291:                     lineError.message = `JSONL parse error on line ${lineNumber}: ${lineError.message}`;
 292:                 }
 293:                 throw lineError;
 294:             }
 295:         }
 296: 
 297:         if (endIndex === text.length) {
 298:             break;
 299:         }
 300: 
 301:         startIndex = endIndex + 1;
 302:         lineNumber += 1;
 303:     }
 304: 
 305:     return { data: records, recordCount: records.length };
 306: }
 307: 
 308: function convertJsonToJsonl(value, options) {
 309:     const allowSingleValue = Boolean(options && options.allowSingleValue);
 310: 
 311:     if (Array.isArray(value)) {
 312:         return {
 313:             text: value.map(item => stringifyLine(item)).join('\n'),
 314:             count: value.length,
 315:             singleValueOutput: false
 316:         };
 317:     }
 318: 
 319:     if (!allowSingleValue) {
 320:         throw makeCustomError(
 321:             'processing',
 322:             'Input must be a JSON array for JSONL conversion. Apply a JMESPath query that returns an array, or switch to Format mode.'
 323:         );
 324:     }
 325: 
 326:     return {
 327:         text: stringifyLine(value),
 328:         count: 1,
 329:         singleValueOutput: true
 330:     };
 331: }
 332: 
 333: function stringifyLine(value) {
 334:     const text = JSON.stringify(value);
 335:     if (typeof text !== 'string') {
 336:         throw makeCustomError('processing', 'Unable to serialize a JSONL line (query returned an unsupported value).');
 337:     }
 338:     return text;
 339: }
 340: 
 341: function stringifyJson(value, indentOption) {
 342:     const indent = resolveIndent(indentOption);
 343:     const text = JSON.stringify(value, null, indent);
 344:     if (typeof text !== 'string') {
 345:         throw makeCustomError('processing', 'Unable to serialize output JSON.');
 346:     }
 347:     return text;
 348: }
 349: 
 350: function resolveIndent(indentOption) {
 351:     if (indentOption === 'tab') {
 352:         return '\t';
 353:     }
 354:     if (indentOption === '0' || indentOption === 0) {
 355:         return 0;
 356:     }
 357: 
 358:     const parsed = Number.parseInt(indentOption, 10);
 359:     if (!Number.isFinite(parsed) || parsed < 0) {
 360:         return 2;
 361:     }
 362:     return Math.min(parsed, 10);
 363: }
 364: 
 365: function applyQueryIfPresent(value, queryText) {
 366:     const query = typeof queryText === 'string' ? queryText.trim() : '';
 367:     if (!query) {
 368:         return value;
 369:     }
 370: 
 371:     if (!(self.jmespath && typeof self.jmespath.search === 'function')) {
 372:         throw makeCustomError('query', 'JMESPath library is unavailable in the worker.');
 373:     }
 374: 
 375:     try {
 376:         const result = self.jmespath.search(value, query);
 377:         if (typeof result === 'undefined') {
 378:             throw makeCustomError('query', 'JMESPath query returned no result (undefined).');
 379:         }
 380:         return result;
 381:     } catch (error) {
 382:         if (error && error.errorType) {
 383:             throw error;
 384:         }
 385:         throw makeCustomError('query', error && error.message ? error.message : String(error));
 386:     }
 387: }
 388: 
 389: function analyzeJSON(value, depth = 0, stats) {
 390:     if (depth > MAX_RECURSION_DEPTH) {
 391:         throw makeCustomError('processing', `JSON is nested too deeply to analyze (> ${MAX_RECURSION_DEPTH} levels).`);
 392:     }
 393: 
 394:     const nextStats = stats || { objects: 0, arrays: 0, keys: 0, maxDepth: 0 };
 395:     nextStats.maxDepth = Math.max(nextStats.maxDepth, depth);
 396: 
 397:     if (Array.isArray(value)) {
 398:         nextStats.arrays += 1;
 399:         for (const item of value) {
 400:             analyzeJSON(item, depth + 1, nextStats);
 401:         }
 402:         return nextStats;
 403:     }
 404: 
 405:     if (value && typeof value === 'object') {
 406:         nextStats.objects += 1;
 407:         const keys = Object.keys(value);
 408:         nextStats.keys += keys.length;
 409:         for (const key of keys) {
 410:             analyzeJSON(value[key], depth + 1, nextStats);
 411:         }
 412:         return nextStats;
 413:     }
 414: 
 415:     return nextStats;
 416: }
 417: 
 418: function sortObjectKeys(value, depth = 0) {
 419:     if (depth > MAX_RECURSION_DEPTH) {
 420:         throw makeCustomError('processing', `JSON is nested too deeply to sort (> ${MAX_RECURSION_DEPTH} levels).`);
 421:     }
 422: 
 423:     if (Array.isArray(value)) {
 424:         return value.map(item => sortObjectKeys(item, depth + 1));
 425:     }
 426: 
 427:     if (value && typeof value === 'object') {
 428:         const out = {};
 429:         for (const key of Object.keys(value).sort()) {
 430:             out[key] = sortObjectKeys(value[key], depth + 1);
 431:         }
 432:         return out;
 433:     }
 434: 
 435:     return value;
 436: }
 437: function validateWithSchema(data, schema) {
 438:     const AjvCtor = resolveAjvConstructor();
 439:     if (!AjvCtor) {
 440:         throw makeCustomError('processing', 'Ajv failed to load in the worker, so schema validation is unavailable.');
 441:     }
 442: 
 443:     let ajv;
 444:     try {
 445:         ajv = new AjvCtor({
 446:             allErrors: true,
 447:             strict: false,
 448:             allowUnionTypes: true,
 449:             validateFormats: false
 450:         });
 451:     } catch (error) {
 452:         throw makeCustomError('processing', error && error.message ? error.message : String(error));
 453:     }
 454: 
 455:     let validateFn;
 456:     try {
 457:         validateFn = ajv.compile(schema);
 458:     } catch (error) {
 459:         throw {
 460:             error: {
 461:                 errorType: 'schema',
 462:                 title: 'Schema Compilation Error',
 463:                 message: error && error.message ? error.message : String(error)
 464:             }
 465:         };
 466:     }
 467: 
 468:     const valid = Boolean(validateFn(data));
 469:     return {
 470:         valid,
 471:         errors: valid ? [] : formatAjvErrors(validateFn.errors)
 472:     };
 473: }
 474: 
 475: function resolveAjvConstructor() {
 476:     if (self.ajv7) {
 477:         if (typeof self.ajv7 === 'function') {
 478:             return self.ajv7;
 479:         }
 480:         if (typeof self.ajv7.Ajv === 'function') {
 481:             return self.ajv7.Ajv;
 482:         }
 483:         if (typeof self.ajv7.default === 'function') {
 484:             return self.ajv7.default;
 485:         }
 486:     }
 487: 
 488:     if (typeof self.Ajv === 'function') {
 489:         return self.Ajv;
 490:     }
 491: 
 492:     if (self.Ajv && typeof self.Ajv.Ajv === 'function') {
 493:         return self.Ajv.Ajv;
 494:     }
 495: 
 496:     for (const key of ['ajv', 'ajv2019', 'ajv2020']) {
 497:         const candidate = self[key];
 498:         if (!candidate) {
 499:             continue;
 500:         }
 501:         if (typeof candidate === 'function') {
 502:             return candidate;
 503:         }
 504:         if (typeof candidate.Ajv === 'function') {
 505:             return candidate.Ajv;
 506:         }
 507:         if (typeof candidate.default === 'function') {
 508:             return candidate.default;
 509:         }
 510:     }
 511: 
 512:     return null;
 513: }
 514: 
 515: function formatAjvErrors(errors) {
 516:     return (errors || []).map((error, index) => ({
 517:         index: index + 1,
 518:         instancePath: error && typeof error.instancePath === 'string' && error.instancePath
 519:             ? error.instancePath
 520:             : '/',
 521:         schemaPath: error && typeof error.schemaPath === 'string' ? error.schemaPath : '',
 522:         keyword: error && typeof error.keyword === 'string' ? error.keyword : '',
 523:         message: error && typeof error.message === 'string' ? error.message : 'Schema validation error'
 524:     }));
 525: }
 526: 
 527: function buildValidationSuccessReport(value, stats, options) {
 528:     const type = describeType(value);
 529:     const schemaChecked = Boolean(options && options.schemaChecked);
 530:     const lines = [
 531:         'Valid JSON',
 532:         '',
 533:         `Type: ${type}`,
 534:         `Objects: ${stats.objects}`,
 535:         `Arrays: ${stats.arrays}`,
 536:         `Total Keys: ${stats.keys}`,
 537:         `Max Depth: ${stats.maxDepth}`,
 538:         `Schema Checked: ${schemaChecked ? 'Yes (passed)' : 'No'}`
 539:     ];
 540: 
 541:     return lines.join('\n');
 542: }
 543: 
 544: function buildSchemaFailureReport(errors, stats) {
 545:     const lines = [
 546:         'Schema validation failed',
 547:         '',
 548:         `Violations: ${errors.length}`,
 549:         ''
 550:     ];
 551: 
 552:     for (const error of errors) {
 553:         const path = error.instancePath || '/';
 554:         const schemaPath = error.schemaPath ? ` (${error.schemaPath})` : '';
 555:         lines.push(`${error.index}. ${path}: ${error.message}${schemaPath}`);
 556:     }
 557: 
 558:     lines.push('');
 559:     lines.push('JSON Stats');
 560:     lines.push(`Objects: ${stats.objects}`);
 561:     lines.push(`Arrays: ${stats.arrays}`);
 562:     lines.push(`Total Keys: ${stats.keys}`);
 563:     lines.push(`Max Depth: ${stats.maxDepth}`);
 564: 
 565:     return lines.join('\n');
 566: }
 567: 
 568: function describeType(value) {
 569:     if (value === null) {
 570:         return 'null';
 571:     }
 572:     if (Array.isArray(value)) {
 573:         return 'Array';
 574:     }
 575:     if (typeof value === 'object') {
 576:         return 'Object';
 577:     }
 578:     return typeof value;
 579: }
 580: function makeParseError(originalError, sourceText, source, errorType) {
 581:     const message = originalError && originalError.message
 582:         ? String(originalError.message)
 583:         : String(originalError);
 584: 
 585:     const location = extractErrorLocation(originalError, sourceText);
 586:     return {
 587:         errorType: errorType || 'syntax',
 588:         source: source || 'input',
 589:         message,
 590:         ...(location.line ? { line: location.line } : {}),
 591:         ...(location.column ? { column: location.column } : {})
 592:     };
 593: }
 594: 
 595: function extractErrorLocation(error, sourceText) {
 596:     const out = { line: null, column: null };
 597: 
 598:     if (error && error.hash && error.hash.loc) {
 599:         const loc = error.hash.loc;
 600:         if (Number.isFinite(loc.first_line)) {
 601:             out.line = Number(loc.first_line);
 602:         }
 603:         if (Number.isFinite(loc.first_column)) {
 604:             out.column = Number(loc.first_column) + 1;
 605:         }
 606:     }
 607: 
 608:     const message = error && error.message ? String(error.message) : String(error);
 609: 
 610:     if (!out.line) {
 611:         const lineMatch = message.match(/line\s+(\d+)/i);
 612:         if (lineMatch) {
 613:             out.line = Number(lineMatch[1]);
 614:         }
 615:     }
 616: 
 617:     if (!out.column) {
 618:         const columnMatch = message.match(/(?:column|character)\s+(\d+)/i);
 619:         if (columnMatch) {
 620:             out.column = Number(columnMatch[1]);
 621:         }
 622:     }
 623: 
 624:     if (!out.column) {
 625:         const messageLines = message.split(/\r?\n/);
 626:         for (const line of messageLines) {
 627:             const caretIndex = line.indexOf('^');
 628:             if (caretIndex >= 0) {
 629:                 out.column = caretIndex + 1;
 630:                 break;
 631:             }
 632:         }
 633:     }
 634: 
 635:     if ((!out.line || !out.column) && typeof sourceText === 'string') {
 636:         const posMatch = message.match(/(?:at\s+)?position\s+(\d+)/i);
 637:         if (posMatch) {
 638:             const position = Math.max(0, Math.min(sourceText.length, Number(posMatch[1])));
 639:             const calculated = positionToLineColumn(sourceText, position);
 640:             if (!out.line) {
 641:                 out.line = calculated.line;
 642:             }
 643:             if (!out.column) {
 644:                 out.column = calculated.column;
 645:             }
 646:         }
 647:     }
 648: 
 649:     return out;
 650: }
 651: 
 652: function positionToLineColumn(text, position) {
 653:     let line = 1;
 654:     let column = 1;
 655: 
 656:     for (let index = 0; index < position; index += 1) {
 657:         if (text[index] === '\n') {
 658:             line += 1;
 659:             column = 1;
 660:         } else {
 661:             column += 1;
 662:         }
 663:     }
 664: 
 665:     return { line, column };
 666: }
 667: 
 668: function makeCustomError(errorType, message, extra) {
 669:     return {
 670:         errorType: errorType || 'processing',
 671:         message: typeof message === 'string' ? message : String(message),
 672:         ...(extra && typeof extra === 'object' ? extra : {})
 673:     };
 674: }
 675: 
 676: function normalizeThrownError(error) {
 677:     if (!error) {
 678:         return { error: makeCustomError('processing', 'Unknown worker error.') };
 679:     }
 680: 
 681:     if (error.error && typeof error.error === 'object') {
 682:         return {
 683:             error: {
 684:                 errorType: error.error.errorType || 'processing',
 685:                 title: error.error.title,
 686:                 source: error.error.source,
 687:                 message: error.error.message || 'Worker error',
 688:                 ...(Number.isFinite(error.error.line) ? { line: error.error.line } : {}),
 689:                 ...(Number.isFinite(error.error.column) ? { column: error.error.column } : {})
 690:             },
 691:             ...(error.stats ? { stats: error.stats } : {}),
 692:             ...(typeof error.validationReport === 'string' ? { validationReport: error.validationReport } : {})
 693:         };
 694:     }
 695: 
 696:     if (error.errorType) {
 697:         return {
 698:             error: {
 699:                 errorType: error.errorType || 'processing',
 700:                 title: error.title,
 701:                 source: error.source,
 702:                 message: error.message || 'Worker error',
 703:                 ...(Number.isFinite(error.line) ? { line: error.line } : {}),
 704:                 ...(Number.isFinite(error.column) ? { column: error.column } : {})
 705:             }
 706:         };
 707:     }
 708: 
 709:     if (error instanceof Error) {
 710:         return { error: makeCustomError('processing', error.message || String(error)) };
 711:     }
 712: 
 713:     return { error: makeCustomError('processing', String(error)) };
 714: }
```
----- END FILE: js/json-worker.js -----

----- BEGIN FILE: js/theme.js -----
```javascript
   1: // Theme and accent color management
   2: var textUtilsStorage = window.__textUtilsStorage || {
   3:     get(key) {
   4:         try {
   5:             return localStorage.getItem(key);
   6:         } catch (_) {
   7:             return null;
   8:         }
   9:     },
  10:     set(key, value) {
  11:         try {
  12:             localStorage.setItem(key, value);
  13:         } catch (_) {
  14:             // Ignore storage write failures (private mode / quota).
  15:         }
  16:     },
  17:     remove(key) {
  18:         try {
  19:             localStorage.removeItem(key);
  20:         } catch (_) {
  21:             // Ignore storage removal failures.
  22:         }
  23:     }
  24: };
  25: window.__textUtilsStorage = textUtilsStorage;
  26: 
  27: if (typeof window.textUtilsClipboardWrite !== 'function') {
  28:     window.textUtilsClipboardWrite = async function textUtilsClipboardWrite(value) {
  29:         const text = String(value ?? '');
  30: 
  31:         if (navigator.clipboard && typeof navigator.clipboard.writeText === 'function') {
  32:             return navigator.clipboard.writeText(text);
  33:         }
  34: 
  35:         const textarea = document.createElement('textarea');
  36:         textarea.value = text;
  37:         textarea.setAttribute('readonly', '');
  38:         textarea.setAttribute('aria-hidden', 'true');
  39:         textarea.style.position = 'fixed';
  40:         textarea.style.top = '0';
  41:         textarea.style.left = '-9999px';
  42:         textarea.style.opacity = '0';
  43: 
  44:         const previousActive = document.activeElement;
  45: 
  46:         document.body.appendChild(textarea);
  47:         textarea.focus();
  48:         textarea.select();
  49:         textarea.setSelectionRange(0, textarea.value.length);
  50: 
  51:         let copied = false;
  52:         try {
  53:             copied = typeof document.execCommand === 'function'
  54:                 && document.execCommand('copy');
  55:         } finally {
  56:             textarea.remove();
  57:             if (previousActive && typeof previousActive.focus === 'function') {
  58:                 previousActive.focus();
  59:             }
  60:         }
  61: 
  62:         if (!copied) {
  63:             throw new Error('Clipboard copy unavailable');
  64:         }
  65:     };
  66: }
  67: 
  68: (function() {
  69:     'use strict';
  70: 
  71:     if (window.__textUtilsThemeModuleLoaded) {
  72:         return;
  73:     }
  74:     window.__textUtilsThemeModuleLoaded = true;
  75: 
  76:     const ACCENT_PALETTE = [
  77:         { value: '#0d9488', label: 'Teal' },
  78:         { value: '#3b82f6', label: 'Blue' },
  79:         { value: '#8b5cf6', label: 'Purple' },
  80:         { value: '#10b981', label: 'Emerald' },
  81:         { value: '#f59e0b', label: 'Amber' },
  82:         { value: '#ef4444', label: 'Red' },
  83:         { value: '#ec4899', label: 'Soft Pink' },
  84:         { value: '#fb7185', label: 'Coral' },
  85:         { value: '#5f9ea0', label: 'Cadet Blue' },
  86:         { value: '#6495ed', label: 'Cornflower' },
  87:         { value: '#deb887', label: 'Burlywood' },
  88:         { value: '#60a5fa', label: 'Sky Blue' },
  89:         { value: '#7c3aed', label: 'Violet' }
  90:     ];
  91:     const DEFAULT_ACCENT = '#0d9488';
  92: 
  93:     let themeToggle = null;
  94:     let accentColor = null;
  95: 
  96:     function captureControls() {
  97:         themeToggle = document.getElementById('themeToggle');
  98:         accentColor = document.getElementById('accentColor');
  99: 
 100:         if (themeToggle) {
 101:             themeToggle.type = 'button';
 102:         }
 103: 
 104:         if (accentColor && !accentColor.getAttribute('aria-label')) {
 105:             accentColor.setAttribute('aria-label', 'Accent color');
 106:         }
 107:     }
 108: 
 109:     function normalizeHexColor(color) {
 110:         if (typeof color !== 'string') {
 111:             return DEFAULT_ACCENT;
 112:         }
 113: 
 114:         let candidate = color.trim().toLowerCase();
 115:         if (/^#[0-9a-f]{3}$/.test(candidate)) {
 116:             candidate = `#${candidate[1]}${candidate[1]}${candidate[2]}${candidate[2]}${candidate[3]}${candidate[3]}`;
 117:         }
 118: 
 119:         if (/^#[0-9a-f]{6}$/.test(candidate)) {
 120:             return candidate;
 121:         }
 122: 
 123:         return DEFAULT_ACCENT;
 124:     }
 125: 
 126:     function hexToRgbTuple(hex) {
 127:         const normalized = normalizeHexColor(hex).slice(1);
 128:         const red = parseInt(normalized.slice(0, 2), 16);
 129:         const green = parseInt(normalized.slice(2, 4), 16);
 130:         const blue = parseInt(normalized.slice(4, 6), 16);
 131:         return `${red}, ${green}, ${blue}`;
 132:     }
 133: 
 134:     function clampUnit(value) {
 135:         return Math.min(Math.max(value, 0), 1);
 136:     }
 137: 
 138:     function rgbToHsl(red, green, blue) {
 139:         const r = red / 255;
 140:         const g = green / 255;
 141:         const b = blue / 255;
 142:         const max = Math.max(r, g, b);
 143:         const min = Math.min(r, g, b);
 144:         const delta = max - min;
 145: 
 146:         let hue = 0;
 147:         let saturation = 0;
 148:         const lightness = (max + min) / 2;
 149: 
 150:         if (delta !== 0) {
 151:             saturation = delta / (1 - Math.abs((2 * lightness) - 1));
 152: 
 153:             switch (max) {
 154:                 case r:
 155:                     hue = ((g - b) / delta) % 6;
 156:                     break;
 157:                 case g:
 158:                     hue = ((b - r) / delta) + 2;
 159:                     break;
 160:                 default:
 161:                     hue = ((r - g) / delta) + 4;
 162:                     break;
 163:             }
 164: 
 165:             hue *= 60;
 166:             if (hue < 0) {
 167:                 hue += 360;
 168:             }
 169:         }
 170: 
 171:         return { hue, saturation, lightness };
 172:     }
 173: 
 174:     function hslToRgb(hue, saturation, lightness) {
 175:         const chroma = (1 - Math.abs((2 * lightness) - 1)) * saturation;
 176:         const huePrime = (hue % 360) / 60;
 177:         const x = chroma * (1 - Math.abs((huePrime % 2) - 1));
 178:         let r1 = 0;
 179:         let g1 = 0;
 180:         let b1 = 0;
 181: 
 182:         if (huePrime >= 0 && huePrime < 1) {
 183:             r1 = chroma;
 184:             g1 = x;
 185:         } else if (huePrime < 2) {
 186:             r1 = x;
 187:             g1 = chroma;
 188:         } else if (huePrime < 3) {
 189:             g1 = chroma;
 190:             b1 = x;
 191:         } else if (huePrime < 4) {
 192:             g1 = x;
 193:             b1 = chroma;
 194:         } else if (huePrime < 5) {
 195:             r1 = x;
 196:             b1 = chroma;
 197:         } else {
 198:             r1 = chroma;
 199:             b1 = x;
 200:         }
 201: 
 202:         const match = lightness - (chroma / 2);
 203:         const red = Math.round((r1 + match) * 255);
 204:         const green = Math.round((g1 + match) * 255);
 205:         const blue = Math.round((b1 + match) * 255);
 206:         return { red, green, blue };
 207:     }
 208: 
 209:     function adjustColor(color, amount) {
 210:         const normalized = normalizeHexColor(color).slice(1);
 211:         const parsed = parseInt(normalized, 16);
 212: 
 213:         if (Number.isNaN(parsed)) {
 214:             return DEFAULT_ACCENT;
 215:         }
 216: 
 217:         const red = (parsed >> 16) & 0xFF;
 218:         const green = (parsed >> 8) & 0xFF;
 219:         const blue = parsed & 0xFF;
 220:         const hsl = rgbToHsl(red, green, blue);
 221:         const adjustedLightness = clampUnit(hsl.lightness + (amount / 255));
 222:         const adjusted = hslToRgb(hsl.hue, hsl.saturation, adjustedLightness);
 223: 
 224:         return `#${((adjusted.red << 16) | (adjusted.green << 8) | adjusted.blue).toString(16).padStart(6, '0')}`;
 225:     }
 226: 
 227:     function applyAccent(color) {
 228:         const normalized = normalizeHexColor(color);
 229:         document.documentElement.style.setProperty('--accent', normalized);
 230:         document.documentElement.style.setProperty('--accent-light', adjustColor(normalized, 20));
 231:         document.documentElement.style.setProperty('--accent-rgb', hexToRgbTuple(normalized));
 232:         return normalized;
 233:     }
 234: 
 235:     function ensureAccentOptionExists(value) {
 236:         if (!accentColor) {
 237:             return;
 238:         }
 239: 
 240:         const normalized = normalizeHexColor(value);
 241:         if (accentColor.querySelector(`option[value="${normalized}"]`)) {
 242:             return;
 243:         }
 244: 
 245:         const customOption = document.createElement('option');
 246:         customOption.value = normalized;
 247:         customOption.textContent = `Custom (${normalized})`;
 248:         accentColor.appendChild(customOption);
 249:     }
 250: 
 251:     function populateAccentDropdown(selectedColor) {
 252:         if (!accentColor) {
 253:             return;
 254:         }
 255: 
 256:         accentColor.replaceChildren();
 257: 
 258:         ACCENT_PALETTE.forEach(({ value, label }) => {
 259:             const option = document.createElement('option');
 260:             option.value = value;
 261:             option.textContent = label;
 262:             accentColor.appendChild(option);
 263:         });
 264: 
 265:         const normalizedSelected = normalizeHexColor(selectedColor);
 266:         const hasSavedColor = ACCENT_PALETTE.some(
 267:             ({ value }) => value.toLowerCase() === normalizedSelected
 268:         );
 269: 
 270:         if (!hasSavedColor) {
 271:             ensureAccentOptionExists(normalizedSelected);
 272:         }
 273: 
 274:         accentColor.value = normalizedSelected;
 275:     }
 276: 
 277:     function updateThemeToggleIcon(theme) {
 278:         if (!themeToggle) {
 279:             return;
 280:         }
 281: 
 282:         const icon = document.createElement('span');
 283:         icon.className = 'material-icons';
 284:         icon.setAttribute('aria-hidden', 'true');
 285:         icon.textContent = theme === 'dark' ? 'dark_mode' : 'light_mode';
 286: 
 287:         themeToggle.replaceChildren(icon);
 288: 
 289:         const isDark = theme === 'dark';
 290:         themeToggle.setAttribute('aria-pressed', isDark ? 'true' : 'false');
 291:         themeToggle.setAttribute('title', isDark ? 'Dark mode' : 'Light mode');
 292:         themeToggle.setAttribute(
 293:             'aria-label',
 294:             isDark ? 'Switch to light theme' : 'Switch to dark theme'
 295:         );
 296:     }
 297: 
 298:     function getDefaultTheme() {
 299:         const prefersLight = window.matchMedia
 300:             && window.matchMedia('(prefers-color-scheme: light)').matches;
 301:         return prefersLight ? 'light' : 'dark';
 302:     }
 303: 
 304:     function loadPreferences() {
 305:         const storedTheme = textUtilsStorage.get('theme');
 306:         const savedTheme = storedTheme === 'light' || storedTheme === 'dark'
 307:             ? storedTheme
 308:             : getDefaultTheme();
 309: 
 310:         document.documentElement.setAttribute('data-theme', savedTheme);
 311:         updateThemeToggleIcon(savedTheme);
 312: 
 313:         const storedColor = textUtilsStorage.get('accentColor');
 314:         const savedColor = normalizeHexColor(storedColor || DEFAULT_ACCENT);
 315:         const appliedColor = applyAccent(savedColor);
 316:         populateAccentDropdown(appliedColor);
 317:     }
 318: 
 319:     function toggleTheme() {
 320:         const currentTheme = document.documentElement.getAttribute('data-theme');
 321:         const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
 322:         document.documentElement.setAttribute('data-theme', newTheme);
 323:         textUtilsStorage.set('theme', newTheme);
 324:         updateThemeToggleIcon(newTheme);
 325:     }
 326: 
 327:     function changeAccentColor(color) {
 328:         const normalized = applyAccent(color);
 329:         textUtilsStorage.set('accentColor', normalized);
 330:         if (accentColor) {
 331:             ensureAccentOptionExists(normalized);
 332:             accentColor.value = normalized;
 333:         }
 334:     }
 335: 
 336:     function setupEventListeners() {
 337:         if (themeToggle && themeToggle.dataset.themeBound !== '1') {
 338:             themeToggle.addEventListener('click', toggleTheme);
 339:             themeToggle.dataset.themeBound = '1';
 340:         }
 341: 
 342:         if (accentColor && accentColor.dataset.accentBound !== '1') {
 343:             accentColor.addEventListener('change', (event) => {
 344:                 changeAccentColor(event.target.value);
 345:             });
 346:             accentColor.dataset.accentBound = '1';
 347:         }
 348:     }
 349: 
 350:     function init() {
 351:         captureControls();
 352:         loadPreferences();
 353:         setupEventListeners();
 354:     }
 355: 
 356:     if (document.readyState === 'loading') {
 357:         document.addEventListener('DOMContentLoaded', init);
 358:     } else {
 359:         init();
 360:     }
 361: 
 362:     window.themeUtils = {
 363:         adjustColor,
 364:         applyAccent,
 365:         normalizeHexColor,
 366:         toggleTheme() {
 367:             captureControls();
 368:             toggleTheme();
 369:         },
 370:         changeAccentColor(color) {
 371:             captureControls();
 372:             changeAccentColor(color);
 373:         },
 374:         loadPreferences() {
 375:             captureControls();
 376:             loadPreferences();
 377:         }
 378:     };
 379: })();
 380: 
 381: (function() {
 382:     'use strict';
 383: 
 384:     if (window.__textUtilsSnowModuleLoaded) {
 385:         return;
 386:     }
 387:     window.__textUtilsSnowModuleLoaded = true;
 388: 
 389:     const STORAGE_KEY = 'holiday_snow_enabled';
 390:     const BTN_CLASS = 'btn btn-secondary';
 391:     const BTN_ID = 'snowToggle';
 392: 
 393:     let canvas = null;
 394:     let ctx = null;
 395:     let width = 0;
 396:     let height = 0;
 397:     let particles = [];
 398:     let animationId = null;
 399:     let isSnowing = false;
 400:     let resizeAttached = false;
 401: 
 402:     function isHolidaySeason() {
 403:         const now = new Date();
 404:         const month = now.getMonth();
 405:         const date = now.getDate();
 406: 
 407:         if (month === 0 && date === 1) {
 408:             return true;
 409:         }
 410: 
 411:         if (month === 11) {
 412:             return true;
 413:         }
 414: 
 415:         if (month === 10) {
 416:             const firstOfNovember = new Date(now.getFullYear(), 10, 1);
 417:             const firstDay = firstOfNovember.getDay();
 418:             const daysToFirstThursday = (4 - firstDay + 7) % 7;
 419:             const thanksgivingDate = 1 + daysToFirstThursday + 21;
 420:             return date >= thanksgivingDate;
 421:         }
 422: 
 423:         return false;
 424:     }
 425: 
 426:     if (!isHolidaySeason()) {
 427:         return;
 428:     }
 429: 
 430:     function resize() {
 431:         if (!canvas || !ctx) {
 432:             return;
 433:         }
 434: 
 435:         const dpr = window.devicePixelRatio || 1;
 436:         width = window.innerWidth;
 437:         height = window.innerHeight;
 438: 
 439:         canvas.width = Math.floor(width * dpr);
 440:         canvas.height = Math.floor(height * dpr);
 441:         canvas.style.width = '100%';
 442:         canvas.style.height = '100%';
 443:         ctx.setTransform(dpr, 0, 0, dpr, 0, 0);
 444:     }
 445: 
 446:     function buildParticles() {
 447:         const particleCount = Math.min(Math.floor(window.innerWidth / 10), 50);
 448:         particles = [];
 449: 
 450:         for (let index = 0; index < particleCount; index++) {
 451:             particles.push({
 452:                 x: Math.random() * width,
 453:                 y: Math.random() * height,
 454:                 r: 1 + Math.random() * 2.5,
 455:                 v: 0.4 + Math.random() * 1.2,
 456:                 drift: (Math.random() * 2 - 1) * 0.5
 457:             });
 458:         }
 459:     }
 460: 
 461:     function draw() {
 462:         if (!isSnowing || !ctx) {
 463:             return;
 464:         }
 465: 
 466:         ctx.clearRect(0, 0, width, height);
 467: 
 468:         const theme = document.documentElement.getAttribute('data-theme');
 469:         ctx.fillStyle = theme === 'light'
 470:             ? 'rgba(0, 0, 0, 0.25)'
 471:             : 'rgba(255, 255, 255, 0.65)';
 472: 
 473:         for (const particle of particles) {
 474:             ctx.beginPath();
 475:             ctx.arc(particle.x, particle.y, particle.r, 0, Math.PI * 2);
 476:             ctx.fill();
 477: 
 478:             particle.y += particle.v;
 479:             particle.x += particle.drift;
 480: 
 481:             if (particle.y > height + 5) {
 482:                 particle.y = -5;
 483:                 particle.x = Math.random() * width;
 484:             }
 485: 
 486:             if (particle.x < -5) {
 487:                 particle.x = width + 5;
 488:             } else if (particle.x > width + 5) {
 489:                 particle.x = -5;
 490:             }
 491:         }
 492: 
 493:         animationId = requestAnimationFrame(draw);
 494:     }
 495: 
 496:     function startSnow() {
 497:         if (window.matchMedia && window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
 498:             isSnowing = false;
 499:             return;
 500:         }
 501: 
 502:         isSnowing = true;
 503: 
 504:         if (!canvas) {
 505:             canvas = document.createElement('canvas');
 506:             canvas.style.cssText = 'position:fixed;top:0;left:0;width:100%;height:100%;pointer-events:none;z-index:100;';
 507:             document.body.appendChild(canvas);
 508:             ctx = canvas.getContext('2d');
 509:         }
 510: 
 511:         if (!resizeAttached) {
 512:             window.addEventListener('resize', resize, { passive: true });
 513:             resizeAttached = true;
 514:         }
 515: 
 516:         resize();
 517:         buildParticles();
 518: 
 519:         if (!animationId) {
 520:             animationId = requestAnimationFrame(draw);
 521:         }
 522:     }
 523: 
 524:     function stopSnow() {
 525:         isSnowing = false;
 526: 
 527:         if (animationId) {
 528:             cancelAnimationFrame(animationId);
 529:             animationId = null;
 530:         }
 531: 
 532:         particles = [];
 533: 
 534:         if (resizeAttached) {
 535:             window.removeEventListener('resize', resize);
 536:             resizeAttached = false;
 537:         }
 538: 
 539:         if (canvas) {
 540:             canvas.remove();
 541:             canvas = null;
 542:             ctx = null;
 543:         }
 544:     }
 545: 
 546:     function handleVisibilityChange() {
 547:         if (!isSnowing) {
 548:             return;
 549:         }
 550: 
 551:         if (document.hidden) {
 552:             if (animationId) {
 553:                 cancelAnimationFrame(animationId);
 554:                 animationId = null;
 555:             }
 556:         } else if (!animationId) {
 557:             animationId = requestAnimationFrame(draw);
 558:         }
 559:     }
 560: 
 561:     function updateSnowButtonState(button, snowEnabled) {
 562:         const icon = document.createElement('span');
 563:         icon.className = 'material-icons';
 564:         icon.setAttribute('aria-hidden', 'true');
 565:         icon.textContent = 'ac_unit';
 566: 
 567:         button.replaceChildren(
 568:             icon,
 569:             document.createTextNode(snowEnabled ? ' Disable Snow' : ' Enable Snow')
 570:         );
 571: 
 572:         button.setAttribute('aria-pressed', snowEnabled ? 'true' : 'false');
 573:         button.setAttribute(
 574:             'aria-label',
 575:             snowEnabled ? 'Disable snow effect' : 'Enable snow effect'
 576:         );
 577:     }
 578: 
 579:     function createSnowButton() {
 580:         const controls = document.querySelector('.controls');
 581:         if (!controls) {
 582:             return null;
 583:         }
 584: 
 585:         const existingButton = document.getElementById(BTN_ID);
 586:         if (existingButton) {
 587:             return existingButton;
 588:         }
 589: 
 590:         const button = document.createElement('button');
 591:         button.className = BTN_CLASS;
 592:         button.id = BTN_ID;
 593:         button.type = 'button';
 594:         button.style.marginLeft = '0.5rem';
 595:         controls.appendChild(button);
 596:         return button;
 597:     }
 598: 
 599:     function init() {
 600:         document.addEventListener('visibilitychange', handleVisibilityChange);
 601: 
 602:         const persistedState = textUtilsStorage.get(STORAGE_KEY) === 'true';
 603:         if (persistedState) {
 604:             startSnow();
 605:         }
 606: 
 607:         const button = createSnowButton();
 608:         if (!button) {
 609:             return;
 610:         }
 611: 
 612:         updateSnowButtonState(button, isSnowing);
 613:         button.addEventListener('click', () => {
 614:             if (isSnowing) {
 615:                 stopSnow();
 616:             } else {
 617:                 startSnow();
 618:             }
 619: 
 620:             textUtilsStorage.set(STORAGE_KEY, isSnowing ? 'true' : 'false');
 621:             updateSnowButtonState(button, isSnowing);
 622:         });
 623:     }
 624: 
 625:     if (document.readyState === 'loading') {
 626:         document.addEventListener('DOMContentLoaded', init);
 627:     } else {
 628:         init();
 629:     }
 630: })();
```
----- END FILE: js/theme.js -----

----- BEGIN FILE: scripts/code-dump-json-tool.py -----
```python
   1: #!/usr/bin/env python3
   2: """Convenience wrapper for generating the JSON Tool context dump."""
   3: 
   4: from __future__ import annotations
   5: 
   6: from pathlib import Path
   7: 
   8: from tool_context_dump import run
   9: 
  10: 
  11: if __name__ == "__main__":
  12:     raise SystemExit(
  13:         run(
  14:             default_tool="json-tool",
  15:             default_output=Path("context/code-dump-json-tool.txt"),
  16:         )
  17:     )
```
----- END FILE: scripts/code-dump-json-tool.py -----

----- BEGIN FILE: scripts/tool_context_dump.py -----
```python
   1: #!/usr/bin/env python3
   2: """Generate LLM-friendly context packs for standalone tool pages."""
   3: 
   4: from __future__ import annotations
   5: 
   6: import argparse
   7: import datetime as dt
   8: import re
   9: from dataclasses import dataclass
  10: from pathlib import Path
  11: from typing import Iterable, List, Optional, Sequence, Set, Tuple
  12: 
  13: 
  14: IGNORE_DIRS = {
  15:     ".git",
  16:     "__pycache__",
  17:     ".pytest_cache",
  18:     "node_modules",
  19:     ".venv",
  20:     "venv",
  21:     ".idea",
  22:     ".vscode",
  23: }
  24: 
  25: CODE_EXTENSIONS = {
  26:     ".html",
  27:     ".js",
  28:     ".css",
  29:     ".xml",
  30:     ".py",
  31:     ".ps1",
  32:     ".json",
  33:     ".ts",
  34:     ".tsx",
  35:     ".jsx",
  36: }
  37: 
  38: DOC_EXTENSIONS = {".md", ".txt", ".rst"}
  39: TEXT_EXTENSIONS = CODE_EXTENSIONS | DOC_EXTENSIONS | {
  40:     ".yml",
  41:     ".yaml",
  42:     ".toml",
  43:     ".ini",
  44:     ".csv",
  45:     ".tsv",
  46:     ".svg",
  47: }
  48: 
  49: ASSET_REFERENCE_PATTERN = re.compile(
  50:     r'(?:href|src)\s*=\s*["\']([^"\']+)["\']', re.IGNORECASE
  51: )
  52: WORKER_PATH_LITERAL_PATTERN = re.compile(
  53:     r"new\s+(?:window\.)?Worker\s*\(\s*['\"]([^'\"]+)['\"]",
  54:     re.IGNORECASE,
  55: )
  56: WORKER_PATH_IDENTIFIER_PATTERN = re.compile(
  57:     r"new\s+(?:window\.)?Worker\s*\(\s*([A-Za-z_$][\w$]*)\b",
  58:     re.IGNORECASE,
  59: )
  60: JS_STRING_ASSIGNMENT_PATTERN = re.compile(
  61:     r"\b(?:const|let|var)\s+([A-Za-z_$][\w$]*)\s*=\s*['\"]([^'\"]+)['\"]"
  62: )
  63: MARKDOWN_HEADING_PATTERN = re.compile(r"^\s{0,3}#{1,6}\s+(.*\S)\s*$")
  64: 
  65: 
  66: @dataclass(frozen=True)
  67: class Excerpt:
  68:     rel_path: str
  69:     label: str
  70:     start_line: int
  71:     end_line: int
  72:     content: str
  73: 
  74: 
  75: def parse_args(argv: Optional[Sequence[str]] = None) -> argparse.Namespace:
  76:     parser = argparse.ArgumentParser(
  77:         description=(
  78:             "Generate an LLM context pack for a tool page by collecting related code "
  79:             "files and relevant text excerpts."
  80:         )
  81:     )
  82:     parser.add_argument(
  83:         "-t",
  84:         "--tool",
  85:         help="Tool id or page name (for example: json-tool or json-tool.html).",
  86:     )
  87:     parser.add_argument(
  88:         "--target",
  89:         help="Explicit path to the tool page. Relative paths are resolved from repo root.",
  90:     )
  91:     parser.add_argument(
  92:         "-o",
  93:         "--output",
  94:         help=(
  95:             "Output file path. Defaults to context/code-dump-<tool>.txt "
  96:             "(relative to repo root)."
  97:         ),
  98:     )
  99:     parser.add_argument(
 100:         "--repo-root",
 101:         help="Repository root path. Defaults to the parent of this script's directory.",
 102:     )
 103:     parser.add_argument(
 104:         "--max-sections-per-file",
 105:         type=int,
 106:         default=3,
 107:         help="Maximum number of extracted sections per reference text file. Default: 3.",
 108:     )
 109:     parser.add_argument(
 110:         "--context-lines",
 111:         type=int,
 112:         default=10,
 113:         help="Line context radius for non-heading excerpts. Default: 10.",
 114:     )
 115: 
 116:     return parser.parse_args(argv)
 117: 
 118: 
 119: def normalize_key(value: str) -> str:
 120:     return re.sub(r"[^a-z0-9]+", "", value.lower())
 121: 
 122: 
 123: def slugify(value: str) -> str:
 124:     slug = re.sub(r"[^a-z0-9]+", "-", value.lower()).strip("-")
 125:     return slug or "tool"
 126: 
 127: 
 128: def to_repo_relative(path: Path, repo_root: Path) -> str:
 129:     try:
 130:         return path.resolve().relative_to(repo_root.resolve()).as_posix()
 131:     except ValueError:
 132:         return path.resolve().as_posix()
 133: 
 134: 
 135: def is_external_reference(reference: str) -> bool:
 136:     lowered = reference.lower()
 137:     return lowered.startswith("http://") or lowered.startswith("https://") or lowered.startswith("//")
 138: 
 139: 
 140: def is_non_file_reference(reference: str) -> bool:
 141:     lowered = reference.lower()
 142:     return (
 143:         lowered.startswith("data:")
 144:         or lowered.startswith("mailto:")
 145:         or lowered.startswith("javascript:")
 146:         or lowered.startswith("tel:")
 147:         or lowered.startswith("#")
 148:     )
 149: 
 150: 
 151: def should_skip_path(path: Path, repo_root: Path) -> bool:
 152:     try:
 153:         relative = path.resolve().relative_to(repo_root.resolve())
 154:     except ValueError:
 155:         return True
 156:     return any(part in IGNORE_DIRS or part == "context" for part in relative.parts)
 157: 
 158: 
 159: def read_text(path: Path) -> str:
 160:     try:
 161:         return path.read_text(encoding="utf-8")
 162:     except UnicodeDecodeError:
 163:         return path.read_text(encoding="utf-8", errors="ignore")
 164: 
 165: 
 166: def iter_repo_files(repo_root: Path) -> Iterable[Path]:
 167:     for file_path in repo_root.rglob("*"):
 168:         if not file_path.is_file():
 169:             continue
 170:         if should_skip_path(file_path, repo_root):
 171:             continue
 172:         yield file_path
 173: 
 174: 
 175: def get_language_tag(path: Path) -> str:
 176:     language_map = {
 177:         ".html": "html",
 178:         ".css": "css",
 179:         ".js": "javascript",
 180:         ".xml": "xml",
 181:         ".ps1": "powershell",
 182:         ".py": "python",
 183:         ".md": "markdown",
 184:         ".json": "json",
 185:         ".yml": "yaml",
 186:         ".yaml": "yaml",
 187:         ".ts": "typescript",
 188:         ".tsx": "tsx",
 189:         ".jsx": "jsx",
 190:         ".txt": "text",
 191:     }
 192:     return language_map.get(path.suffix.lower(), "text")
 193: 
 194: 
 195: def get_numbered_content(text: str, start_line: int = 1) -> str:
 196:     lines = text.splitlines()
 197:     return "\n".join(
 198:         f"{start_line + idx:4}: {line}" for idx, line in enumerate(lines)
 199:     )
 200: 
 201: 
 202: def merge_ranges(ranges: Iterable[Tuple[int, int]]) -> List[Tuple[int, int]]:
 203:     sorted_ranges = sorted(ranges, key=lambda pair: (pair[0], pair[1]))
 204:     if not sorted_ranges:
 205:         return []
 206: 
 207:     merged: List[Tuple[int, int]] = [sorted_ranges[0]]
 208:     for start, end in sorted_ranges[1:]:
 209:         last_start, last_end = merged[-1]
 210:         if start <= last_end:
 211:             merged[-1] = (last_start, max(last_end, end))
 212:         else:
 213:             merged.append((start, end))
 214:     return merged
 215: 
 216: 
 217: def extract_windows(
 218:     lines: Sequence[str],
 219:     patterns: Sequence[re.Pattern[str]],
 220:     context_lines: int,
 221:     max_sections: int,
 222:     label_prefix: str,
 223: ) -> List[Tuple[str, int, int, str]]:
 224:     hit_lines: List[int] = []
 225:     for idx, line in enumerate(lines):
 226:         if any(pattern.search(line) for pattern in patterns):
 227:             hit_lines.append(idx)
 228: 
 229:     if not hit_lines:
 230:         return []
 231: 
 232:     ranges = [
 233:         (max(0, idx - context_lines), min(len(lines), idx + context_lines + 1))
 234:         for idx in hit_lines
 235:     ]
 236:     merged = merge_ranges(ranges)[:max_sections]
 237: 
 238:     excerpts: List[Tuple[str, int, int, str]] = []
 239:     for start, end in merged:
 240:         label = f"{label_prefix} lines {start + 1}-{end}"
 241:         content = "\n".join(lines[start:end])
 242:         excerpts.append((label, start + 1, end, content))
 243:     return excerpts
 244: 
 245: 
 246: def extract_markdown_sections(
 247:     text: str,
 248:     patterns: Sequence[re.Pattern[str]],
 249:     max_sections: int,
 250:     context_lines: int,
 251: ) -> List[Tuple[str, int, int, str]]:
 252:     lines = text.splitlines()
 253:     heading_indices = [
 254:         idx for idx, line in enumerate(lines) if MARKDOWN_HEADING_PATTERN.match(line)
 255:     ]
 256: 
 257:     section_results: List[Tuple[str, int, int, str]] = []
 258:     for idx, start in enumerate(heading_indices):
 259:         end = heading_indices[idx + 1] if idx + 1 < len(heading_indices) else len(lines)
 260:         section_text = "\n".join(lines[start:end])
 261:         if not any(pattern.search(section_text) for pattern in patterns):
 262:             continue
 263: 
 264:         heading_match = MARKDOWN_HEADING_PATTERN.match(lines[start])
 265:         heading = heading_match.group(1).strip() if heading_match else "Untitled section"
 266:         label = f"Section: {heading}"
 267:         section_results.append((label, start + 1, end, section_text))
 268:         if len(section_results) >= max_sections:
 269:             break
 270: 
 271:     if section_results:
 272:         return section_results
 273: 
 274:     return extract_windows(
 275:         lines=lines,
 276:         patterns=patterns,
 277:         context_lines=context_lines,
 278:         max_sections=max_sections,
 279:         label_prefix="Reference",
 280:     )
 281: 
 282: 
 283: def extract_text_sections(
 284:     path: Path,
 285:     text: str,
 286:     patterns: Sequence[re.Pattern[str]],
 287:     max_sections: int,
 288:     context_lines: int,
 289: ) -> List[Tuple[str, int, int, str]]:
 290:     if path.suffix.lower() == ".md":
 291:         return extract_markdown_sections(
 292:             text=text,
 293:             patterns=patterns,
 294:             max_sections=max_sections,
 295:             context_lines=context_lines,
 296:         )
 297: 
 298:     lines = text.splitlines()
 299:     return extract_windows(
 300:         lines=lines,
 301:         patterns=patterns,
 302:         context_lines=context_lines,
 303:         max_sections=max_sections,
 304:         label_prefix="Reference",
 305:     )
 306: 
 307: 
 308: def resolve_target_reference(reference: str, target_file: Path, repo_root: Path) -> Optional[Path]:
 309:     reference_path = reference.split("#", 1)[0].split("?", 1)[0].strip()
 310:     if not reference_path:
 311:         return None
 312:     if is_external_reference(reference_path) or is_non_file_reference(reference_path):
 313:         return None
 314: 
 315:     if reference_path.startswith("/"):
 316:         candidate = (repo_root / reference_path.lstrip("/")).resolve()
 317:         return candidate if candidate.exists() else None
 318: 
 319:     rel_parts = [part for part in reference_path.split("/") if part not in ("", ".")]
 320:     candidate_rel = Path(*rel_parts)
 321:     candidate_from_target = (target_file.parent / candidate_rel).resolve()
 322:     if candidate_from_target.exists():
 323:         return candidate_from_target
 324: 
 325:     candidate_from_root = (repo_root / candidate_rel).resolve()
 326:     return candidate_from_root if candidate_from_root.exists() else None
 327: 
 328: 
 329: def collect_js_runtime_dependencies(
 330:     source_text: str, source_file: Path, repo_root: Path
 331: ) -> Set[str]:
 332:     local: Set[str] = set()
 333:     string_assignments = {
 334:         match.group(1): match.group(2)
 335:         for match in JS_STRING_ASSIGNMENT_PATTERN.finditer(source_text)
 336:     }
 337: 
 338:     candidate_references = [match.group(1).strip() for match in WORKER_PATH_LITERAL_PATTERN.finditer(source_text)]
 339: 
 340:     for match in WORKER_PATH_IDENTIFIER_PATTERN.finditer(source_text):
 341:         variable_name = match.group(1)
 342:         assigned_value = string_assignments.get(variable_name, "").strip()
 343:         if assigned_value:
 344:             candidate_references.append(assigned_value)
 345: 
 346:     for raw_reference in candidate_references:
 347:         if not raw_reference:
 348:             continue
 349:         if is_external_reference(raw_reference) or is_non_file_reference(raw_reference):
 350:             continue
 351: 
 352:         resolved = resolve_target_reference(raw_reference, source_file, repo_root)
 353:         if resolved is None:
 354:             continue
 355:         if should_skip_path(resolved, repo_root):
 356:             continue
 357:         if resolved.suffix.lower() not in TEXT_EXTENSIONS:
 358:             continue
 359:         local.add(to_repo_relative(resolved, repo_root))
 360: 
 361:     return local
 362: 
 363: 
 364: def collect_local_dependencies(target_text: str, target_file: Path, repo_root: Path) -> Tuple[List[str], List[str]]:
 365:     local: Set[str] = set()
 366:     external: Set[str] = set()
 367:     js_scan_queue: List[Path] = []
 368:     scanned_js: Set[str] = set()
 369: 
 370:     for match in ASSET_REFERENCE_PATTERN.finditer(target_text):
 371:         raw_reference = match.group(1).strip()
 372:         if not raw_reference:
 373:             continue
 374: 
 375:         if is_external_reference(raw_reference):
 376:             external.add(raw_reference)
 377:             continue
 378:         if is_non_file_reference(raw_reference):
 379:             continue
 380: 
 381:         resolved = resolve_target_reference(raw_reference, target_file, repo_root)
 382:         if resolved is None:
 383:             continue
 384:         if should_skip_path(resolved, repo_root):
 385:             continue
 386:         if resolved.suffix.lower() not in TEXT_EXTENSIONS:
 387:             continue
 388:         local.add(to_repo_relative(resolved, repo_root))
 389:         if resolved.suffix.lower() == ".js":
 390:             js_scan_queue.append(resolved)
 391: 
 392:     while js_scan_queue:
 393:         source_file = js_scan_queue.pop()
 394:         source_key = str(source_file.resolve()).lower()
 395:         if source_key in scanned_js:
 396:             continue
 397:         scanned_js.add(source_key)
 398: 
 399:         source_text = read_text(source_file)
 400:         for rel_path in collect_js_runtime_dependencies(source_text, source_file, repo_root):
 401:             if rel_path in local:
 402:                 continue
 403:             local.add(rel_path)
 404:             discovered_path = (repo_root / Path(rel_path)).resolve()
 405:             if discovered_path.suffix.lower() == ".js":
 406:                 js_scan_queue.append(discovered_path)
 407: 
 408:     return sorted(local), sorted(external)
 409: 
 410: 
 411: def extract_tool_title(target_text: str, target_file: Path) -> str:
 412:     h2_match = re.search(r"<h2[^>]*>\s*([^<]+?)\s*</h2>", target_text, flags=re.IGNORECASE)
 413:     if h2_match:
 414:         return re.sub(r"\s+", " ", h2_match.group(1)).strip()
 415: 
 416:     title_match = re.search(
 417:         r"<title[^>]*>\s*(.*?)\s*</title>", target_text, flags=re.IGNORECASE | re.DOTALL
 418:     )
 419:     if title_match:
 420:         title = re.sub(r"\s+", " ", title_match.group(1)).strip()
 421:         title = re.sub(r"\s*-\s*Text Utilities\s*$", "", title, flags=re.IGNORECASE)
 422:         if title:
 423:             return title
 424: 
 425:     return target_file.stem.replace("-", " ").replace("_", " ").title()
 426: 
 427: 
 428: def build_reference_patterns(
 429:     target_rel: str,
 430:     tool_slug: str,
 431:     tool_title: str,
 432:     tool_stem: str,
 433: ) -> List[re.Pattern[str]]:
 434:     target_rel_pattern = re.escape(target_rel).replace(r"\/", r"[\\/]")
 435:     target_name_pattern = re.escape(Path(target_rel).name)
 436:     id_pattern = rf"id\s*:\s*['\"]{re.escape(tool_slug)}['\"]"
 437:     stem_pattern = re.escape(tool_stem)
 438:     title_pattern = re.escape(tool_title)
 439: 
 440:     return [
 441:         re.compile(target_rel_pattern, re.IGNORECASE),
 442:         re.compile(target_name_pattern, re.IGNORECASE),
 443:         re.compile(id_pattern, re.IGNORECASE),
 444:         re.compile(stem_pattern, re.IGNORECASE),
 445:         re.compile(title_pattern, re.IGNORECASE),
 446:     ]
 447: 
 448: 
 449: def collect_incoming_code_refs(
 450:     repo_root: Path,
 451:     target_file: Path,
 452:     patterns: Sequence[re.Pattern[str]],
 453: ) -> List[str]:
 454:     incoming: Set[str] = set()
 455:     for file_path in iter_repo_files(repo_root):
 456:         if file_path.resolve() == target_file.resolve():
 457:             continue
 458:         if file_path.suffix.lower() not in CODE_EXTENSIONS:
 459:             continue
 460: 
 461:         content = read_text(file_path)
 462:         if any(pattern.search(content) for pattern in patterns):
 463:             incoming.add(to_repo_relative(file_path, repo_root))
 464:     return sorted(incoming)
 465: 
 466: 
 467: def collect_direct_docs(
 468:     repo_root: Path,
 469:     target_file: Path,
 470:     tool_slug: str,
 471:     tool_stem: str,
 472: ) -> List[str]:
 473:     slug_key = normalize_key(tool_slug)
 474:     stem_key = normalize_key(tool_stem)
 475:     docs: Set[str] = set()
 476: 
 477:     for file_path in iter_repo_files(repo_root):
 478:         if file_path.suffix.lower() not in DOC_EXTENSIONS:
 479:             continue
 480:         if file_path.resolve() == target_file.resolve():
 481:             continue
 482: 
 483:         stem_key_candidate = normalize_key(file_path.stem)
 484:         name_key_candidate = normalize_key(file_path.name)
 485:         if slug_key and slug_key in name_key_candidate:
 486:             docs.add(to_repo_relative(file_path, repo_root))
 487:             continue
 488:         if stem_key and stem_key in stem_key_candidate:
 489:             docs.add(to_repo_relative(file_path, repo_root))
 490: 
 491:     return sorted(docs)
 492: 
 493: 
 494: def collect_reference_excerpts(
 495:     repo_root: Path,
 496:     patterns: Sequence[re.Pattern[str]],
 497:     excluded_rel_paths: Set[str],
 498:     max_sections_per_file: int,
 499:     context_lines: int,
 500: ) -> List[Excerpt]:
 501:     excerpts: List[Excerpt] = []
 502: 
 503:     for file_path in iter_repo_files(repo_root):
 504:         rel_path = to_repo_relative(file_path, repo_root)
 505:         if rel_path in excluded_rel_paths:
 506:             continue
 507:         if file_path.suffix.lower() not in DOC_EXTENSIONS:
 508:             continue
 509: 
 510:         content = read_text(file_path)
 511:         if not any(pattern.search(content) for pattern in patterns):
 512:             continue
 513: 
 514:         sections = extract_text_sections(
 515:             path=file_path,
 516:             text=content,
 517:             patterns=patterns,
 518:             max_sections=max_sections_per_file,
 519:             context_lines=context_lines,
 520:         )
 521:         for label, start_line, end_line, section_content in sections:
 522:             excerpts.append(
 523:                 Excerpt(
 524:                     rel_path=rel_path,
 525:                     label=label,
 526:                     start_line=start_line,
 527:                     end_line=end_line,
 528:                     content=section_content,
 529:                 )
 530:             )
 531: 
 532:     return sorted(excerpts, key=lambda item: (item.rel_path.lower(), item.start_line))
 533: 
 534: 
 535: def add_unique(ordered: List[str], seen: Set[str], rel_path: str) -> None:
 536:     key = rel_path.lower()
 537:     if key in seen:
 538:         return
 539:     seen.add(key)
 540:     ordered.append(rel_path)
 541: 
 542: 
 543: def build_context_output(
 544:     *,
 545:     repo_root: Path,
 546:     output_path: Path,
 547:     tool_slug: str,
 548:     tool_title: str,
 549:     target_rel: str,
 550:     full_files: Sequence[str],
 551:     local_dependencies: Sequence[str],
 552:     incoming_refs: Sequence[str],
 553:     direct_docs: Sequence[str],
 554:     external_dependencies: Sequence[str],
 555:     excerpts: Sequence[Excerpt],
 556: ) -> str:
 557:     generated_utc = dt.datetime.now(dt.timezone.utc).strftime("%Y-%m-%d %H:%M:%S UTC")
 558:     output_rel = to_repo_relative(output_path, repo_root)
 559: 
 560:     lines: List[str] = []
 561:     lines.append(f"# LLM Context Pack: {tool_title}")
 562:     lines.append("")
 563:     lines.append(
 564:         "This generated file is designed as a context bundle for LLM prompts."
 565:     )
 566:     lines.append(
 567:         "It contains full source text for files directly associated with the tool, "
 568:         "plus extracted sections from broader docs that reference the tool."
 569:     )
 570:     lines.append(
 571:         "Every included block is wrapped with explicit BEGIN/END markers for "
 572:         "reliable chunking."
 573:     )
 574:     lines.append("")
 575:     lines.append(f"Generated: {generated_utc}")
 576:     lines.append(f"Repository: `{repo_root}`")
 577:     lines.append(f"Tool slug: `{tool_slug}`")
 578:     lines.append(f"Tool page: `{target_rel}`")
 579:     lines.append(f"Output file: `{output_rel}`")
 580:     lines.append("")
 581: 
 582:     lines.append("## Discovery Summary")
 583:     lines.append(f"- Full files included: {len(full_files)}")
 584:     lines.append(f"- Direct local dependencies: {len(local_dependencies)}")
 585:     lines.append(f"- Incoming code references: {len(incoming_refs)}")
 586:     lines.append(f"- Direct tool docs (full): {len(direct_docs)}")
 587:     lines.append(f"- Cross-file text excerpts: {len(excerpts)}")
 588:     lines.append(f"- External dependencies in tool page: {len(external_dependencies)}")
 589:     lines.append("")
 590: 
 591:     lines.append("## Included Full Files")
 592:     for rel_path in full_files:
 593:         lines.append(f"- `{rel_path}`")
 594:     lines.append("")
 595: 
 596:     lines.append("## External Dependencies")
 597:     if external_dependencies:
 598:         for dependency in external_dependencies:
 599:             lines.append(f"- `{dependency}`")
 600:     else:
 601:         lines.append("- None detected")
 602:     lines.append("")
 603: 
 604:     lines.append("## Full File Dumps")
 605:     lines.append("")
 606: 
 607:     for rel_path in full_files:
 608:         full_path = (repo_root / Path(rel_path)).resolve()
 609:         lines.append(f"----- BEGIN FILE: {rel_path} -----")
 610:         if not full_path.exists():
 611:             lines.append("Missing at dump time.")
 612:             lines.append(f"----- END FILE: {rel_path} -----")
 613:             lines.append("")
 614:             continue
 615: 
 616:         file_text = read_text(full_path)
 617:         numbered_content = get_numbered_content(file_text)
 618:         language = get_language_tag(full_path)
 619:         lines.append(f"```{language}")
 620:         lines.append(numbered_content)
 621:         lines.append("```")
 622:         lines.append(f"----- END FILE: {rel_path} -----")
 623:         lines.append("")
 624: 
 625:     lines.append("## Referenced Text Excerpts")
 626:     lines.append("")
 627: 
 628:     if not excerpts:
 629:         lines.append("No additional text excerpts were needed.")
 630:         lines.append("")
 631:     else:
 632:         for excerpt in excerpts:
 633:             marker = (
 634:                 f"{excerpt.rel_path} | {excerpt.label} "
 635:                 f"(lines {excerpt.start_line}-{excerpt.end_line})"
 636:             )
 637:             lines.append(f"----- BEGIN EXCERPT: {marker} -----")
 638:             numbered_excerpt = get_numbered_content(
 639:                 excerpt.content, start_line=excerpt.start_line
 640:             )
 641:             lines.append("```text")
 642:             lines.append(numbered_excerpt)
 643:             lines.append("```")
 644:             lines.append(f"----- END EXCERPT: {marker} -----")
 645:             lines.append("")
 646: 
 647:     return "\n".join(lines).rstrip() + "\n"
 648: 
 649: 
 650: def generate_context_pack(
 651:     *,
 652:     repo_root: Path,
 653:     target_relative: Path,
 654:     tool_slug: str,
 655:     output_path: Path,
 656:     max_sections_per_file: int,
 657:     context_lines: int,
 658: ) -> Tuple[str, int]:
 659:     target_file = (repo_root / target_relative).resolve()
 660:     if not target_file.exists():
 661:         raise FileNotFoundError(f"Unable to find target tool page: {target_file}")
 662: 
 663:     target_text = read_text(target_file)
 664:     target_rel = to_repo_relative(target_file, repo_root)
 665:     tool_title = extract_tool_title(target_text, target_file)
 666: 
 667:     local_dependencies, external_dependencies = collect_local_dependencies(
 668:         target_text=target_text,
 669:         target_file=target_file,
 670:         repo_root=repo_root,
 671:     )
 672:     patterns = build_reference_patterns(
 673:         target_rel=target_rel,
 674:         tool_slug=tool_slug,
 675:         tool_title=tool_title,
 676:         tool_stem=target_file.stem,
 677:     )
 678:     incoming_refs = collect_incoming_code_refs(
 679:         repo_root=repo_root,
 680:         target_file=target_file,
 681:         patterns=patterns,
 682:     )
 683:     direct_docs = collect_direct_docs(
 684:         repo_root=repo_root,
 685:         target_file=target_file,
 686:         tool_slug=tool_slug,
 687:         tool_stem=target_file.stem,
 688:     )
 689: 
 690:     ordered_files: List[str] = []
 691:     seen: Set[str] = set()
 692:     add_unique(ordered_files, seen, target_rel)
 693:     for rel in local_dependencies:
 694:         add_unique(ordered_files, seen, rel)
 695:     for rel in incoming_refs:
 696:         add_unique(ordered_files, seen, rel)
 697:     for rel in direct_docs:
 698:         add_unique(ordered_files, seen, rel)
 699: 
 700:     excerpts = collect_reference_excerpts(
 701:         repo_root=repo_root,
 702:         patterns=patterns,
 703:         excluded_rel_paths=set(ordered_files),
 704:         max_sections_per_file=max_sections_per_file,
 705:         context_lines=context_lines,
 706:     )
 707: 
 708:     output_text = build_context_output(
 709:         repo_root=repo_root,
 710:         output_path=output_path,
 711:         tool_slug=tool_slug,
 712:         tool_title=tool_title,
 713:         target_rel=target_rel,
 714:         full_files=ordered_files,
 715:         local_dependencies=local_dependencies,
 716:         incoming_refs=incoming_refs,
 717:         direct_docs=direct_docs,
 718:         external_dependencies=external_dependencies,
 719:         excerpts=excerpts,
 720:     )
 721: 
 722:     output_path.parent.mkdir(parents=True, exist_ok=True)
 723:     output_path.write_text(output_text, encoding="utf-8", newline="\n")
 724:     return target_rel, len(ordered_files)
 725: 
 726: 
 727: def run(
 728:     *,
 729:     default_tool: Optional[str] = None,
 730:     default_output: Optional[Path] = None,
 731:     argv: Optional[Sequence[str]] = None,
 732: ) -> int:
 733:     args = parse_args(argv=argv)
 734: 
 735:     script_dir = Path(__file__).resolve().parent
 736:     repo_root = (
 737:         Path(args.repo_root).expanduser().resolve()
 738:         if args.repo_root
 739:         else script_dir.parent.resolve()
 740:     )
 741: 
 742:     if args.target:
 743:         target_relative = Path(args.target).expanduser()
 744:         if target_relative.is_absolute():
 745:             try:
 746:                 target_relative = target_relative.resolve().relative_to(repo_root)
 747:             except ValueError:
 748:                 raise ValueError(
 749:                     f"Target must be inside repository root ({repo_root}): {args.target}"
 750:                 )
 751:     else:
 752:         tool_value = args.tool or default_tool
 753:         if not tool_value:
 754:             raise ValueError("Missing tool id. Provide --tool or configure a default tool.")
 755:         if tool_value.lower().endswith(".html"):
 756:             target_relative = Path(tool_value)
 757:         else:
 758:             target_relative = Path(f"{tool_value}.html")
 759: 
 760:     target_name_for_slug = args.tool or default_tool or target_relative.stem
 761:     if str(target_name_for_slug).lower().endswith(".html"):
 762:         tool_slug = slugify(Path(str(target_name_for_slug)).stem)
 763:     else:
 764:         tool_slug = slugify(str(target_name_for_slug))
 765: 
 766:     if args.output:
 767:         output_path = Path(args.output).expanduser()
 768:     elif default_output is not None:
 769:         output_path = default_output
 770:     else:
 771:         output_path = Path(f"context/code-dump-{tool_slug}.txt")
 772: 
 773:     if not output_path.is_absolute():
 774:         output_path = (repo_root / output_path).resolve()
 775: 
 776:     target_rel, included_count = generate_context_pack(
 777:         repo_root=repo_root,
 778:         target_relative=target_relative,
 779:         tool_slug=tool_slug,
 780:         output_path=output_path,
 781:         max_sections_per_file=max(1, args.max_sections_per_file),
 782:         context_lines=max(1, args.context_lines),
 783:     )
 784: 
 785:     print(f"Tool context dump complete: {output_path}")
 786:     print(f"Target page: {target_rel}")
 787:     print(f"Files included (full): {included_count}")
 788:     return 0
 789: 
 790: 
 791: def main(argv: Optional[Sequence[str]] = None) -> int:
 792:     try:
 793:         return run(argv=argv)
 794:     except Exception as exc:
 795:         print(f"Error: {exc}")
 796:         return 1
 797: 
 798: 
 799: if __name__ == "__main__":
 800:     raise SystemExit(main())
```
----- END FILE: scripts/tool_context_dump.py -----

----- BEGIN FILE: sitemap.xml -----
```xml
   1: <?xml version="1.0" encoding="UTF-8"?>
   2: <urlset xmlns="http://www.sitemaps.org/schemas/sitemap/0.9">
   3:   <url>
   4:     <loc>https://text-utils.net/</loc>
   5:     <lastmod>2026-02-18</lastmod>
   6:     <changefreq>weekly</changefreq>
   7:     <priority>1.0</priority>
   8:   </url>
   9: 
  10:   <url>
  11:     <loc>https://text-utils.net/case-converter.html</loc>
  12:     <lastmod>2026-02-18</lastmod>
  13:     <changefreq>monthly</changefreq>
  14:     <priority>0.8</priority>
  15:   </url>
  16:   <url>
  17:     <loc>https://text-utils.net/color-chooser.html</loc>
  18:     <lastmod>2026-02-18</lastmod>
  19:     <changefreq>monthly</changefreq>
  20:     <priority>0.8</priority>
  21:   </url>
  22:   <url>
  23:     <loc>https://text-utils.net/css-unit-converter.html</loc>
  24:     <lastmod>2026-02-18</lastmod>
  25:     <changefreq>monthly</changefreq>
  26:     <priority>0.8</priority>
  27:   </url>
  28:   <url>
  29:     <loc>https://text-utils.net/date-time-info.html</loc>
  30:     <lastmod>2026-02-18</lastmod>
  31:     <changefreq>monthly</changefreq>
  32:     <priority>0.8</priority>
  33:   </url>
  34:   <url>
  35:     <loc>https://text-utils.net/find-replace.html</loc>
  36:     <lastmod>2026-02-18</lastmod>
  37:     <changefreq>monthly</changefreq>
  38:     <priority>0.8</priority>
  39:   </url>
  40:   <url>
  41:     <loc>https://text-utils.net/font-awesome-chooser.html</loc>
  42:     <lastmod>2026-02-18</lastmod>
  43:     <changefreq>monthly</changefreq>
  44:     <priority>0.8</priority>
  45:   </url>
  46:   <url>
  47:     <loc>https://text-utils.net/font-chooser.html</loc>
  48:     <lastmod>2026-02-18</lastmod>
  49:     <changefreq>monthly</changefreq>
  50:     <priority>0.8</priority>
  51:   </url>
  52:   <url>
  53:     <loc>https://text-utils.net/google-icons-chooser.html</loc>
  54:     <lastmod>2026-02-18</lastmod>
  55:     <changefreq>monthly</changefreq>
  56:     <priority>0.8</priority>
  57:   </url>
  58:   <url>
  59:     <loc>https://text-utils.net/hashing-tool.html</loc>
  60:     <lastmod>2026-02-18</lastmod>
  61:     <changefreq>monthly</changefreq>
  62:     <priority>0.8</priority>
  63:   </url>
  64:   <url>
  65:     <loc>https://text-utils.net/ip-info.html</loc>
  66:     <lastmod>2026-02-18</lastmod>
  67:     <changefreq>monthly</changefreq>
  68:     <priority>0.8</priority>
  69:   </url>
  70:   <url>
  71:     <loc>https://text-utils.net/json-tool.html</loc>
  72:     <lastmod>2026-02-18</lastmod>
  73:     <changefreq>monthly</changefreq>
  74:     <priority>0.8</priority>
  75:   </url>
  76:   <url>
  77:     <loc>https://text-utils.net/line-operations.html</loc>
  78:     <lastmod>2026-02-18</lastmod>
  79:     <changefreq>monthly</changefreq>
  80:     <priority>0.8</priority>
  81:   </url>
  82:   <url>
  83:     <loc>https://text-utils.net/random-numbers.html</loc>
  84:     <lastmod>2026-02-18</lastmod>
  85:     <changefreq>monthly</changefreq>
  86:     <priority>0.8</priority>
  87:   </url>
  88:   <url>
  89:     <loc>https://text-utils.net/sitemap-generator.html</loc>
  90:     <lastmod>2026-02-18</lastmod>
  91:     <changefreq>monthly</changefreq>
  92:     <priority>0.8</priority>
  93:   </url>
  94:   <url>
  95:     <loc>https://text-utils.net/text-info.html</loc>
  96:     <lastmod>2026-02-18</lastmod>
  97:     <changefreq>monthly</changefreq>
  98:     <priority>0.8</priority>
  99:   </url>
 100: </urlset>
```
----- END FILE: sitemap.xml -----

----- BEGIN FILE: JSON-TOOL-MIGRATION.md -----
```markdown
   1: # JSON Tool - Migration & Feature Summary
   2: 
   3: ## ? Migration Complete
   4: 
   5: The JSON Tool has been successfully created as a comprehensive standalone tool, replacing the simple inline JSON formatter with an advanced multi-mode JSON processor.
   6: 
   7: ## ?? File Created
   8: 
   9: **`json-tool.html`** (600+ lines)
  10: 
  11: ## ?? Three Operational Modes
  12: 
  13: ### 1. Format JSON Mode
  14: **Purpose**: Pretty-print and format JSON with customizable options
  15: 
  16: **Features**:
  17: - ? Configurable indentation (2 spaces, 4 spaces, tabs, minified)
  18: - ? Optional alphabetical key sorting
  19: - ? Syntax validation with detailed error messages
  20: - ? Automatic structure analysis
  21: - ? Preserves data types and special characters
  22: 
  23: **Example Use Cases**:
  24: - Formatting minified API responses
  25: - Cleaning up hand-written JSON
  26: - Preparing JSON for version control
  27: - Converting between indentation styles
  28: 
  29: ### 2. JSON to JSONL Mode
  30: **Purpose**: Convert JSON arrays to JSON Lines format
  31: 
  32: **Features**:
  33: - ? Converts array elements to separate lines
  34: - ? Each line is valid JSON
  35: - ? Validates array structure
  36: - ? Shows conversion statistics
  37: - ? Handles nested objects properly
  38: 
  39: **JSONL Format**:
  40: ```
  41: {"id":1,"name":"Alice","age":28}
  42: {"id":2,"name":"Bob","age":34}
  43: {"id":3,"name":"Carol","age":31}
  44: ```
  45: 
  46: **Example Use Cases**:
  47: - Big data processing (Hadoop, Spark)
  48: - Streaming data pipelines
  49: - Log file generation
  50: - Database imports
  51: - Machine learning datasets
  52: 
  53: **Why JSONL?**:
  54: - Line-by-line processing (memory efficient)
  55: - Streamable format
  56: - Easy to append records
  57: - Popular in data engineering
  58: - Compatible with tools like `jq`, `grep`
  59: 
  60: ### 3. Validate Only Mode
  61: **Purpose**: Check JSON syntax without formatting
  62: 
  63: **Features**:
  64: - ? Syntax validation
  65: - ? Structure analysis (objects, arrays, depth)
  66: - ? Error position detection (line/column)
  67: - ? Type identification
  68: - ? Statistics display
  69: 
  70: **Output Example**:
  71: ```
  72:  Valid JSON
  73: 
  74: Type: Object
  75: Objects: 4
  76: Arrays: 1
  77: Total Keys: 17
  78: Max Depth: 3
  79: ```
  80: 
  81: ## ?? Advanced UI Features
  82: 
  83: ### Mode Switching Tabs
  84: ```html
  85: <div class="mode-tabs">
  86:     <button class="mode-tab active" data-mode="format">
  87:         <span class="material-icons">code</span>
  88:         Format JSON
  89:     </button>
  90:     <!-- More tabs... -->
  91: </div>
  92: ```
  93: 
  94: **Benefits**:
  95: - Clear visual indication of current mode
  96: - Single-click mode switching
  97: - Icon + text labels for clarity
  98: - Active state highlighting
  99: 
 100: ### Context-Sensitive Info Panel
 101: Dynamic information panel that changes based on selected mode:
 102: 
 103: ```javascript
 104: const modeInfo = {
 105:     format: {
 106:         title: 'JSON Formatting',
 107:         text: 'Format and validate JSON with customizable indentation...'
 108:     },
 109:     jsonl: {
 110:         title: 'JSON to JSONL Conversion',
 111:         text: 'Convert JSON arrays to JSON Lines format...'
 112:     },
 113:     validate: {
 114:         title: 'JSON Validation',
 115:         text: 'Validate JSON syntax and structure...'
 116:     }
 117: };
 118: ```
 119: 
 120: **User Benefits**:
 121: - Contextual help without clutter
 122: - Educational (explains what each mode does)
 123: - Reduces confusion for new users
 124: 
 125: ### Error Panel with Position Detection
 126: ```javascript
 127: function showError(error, sourceText) {
 128:     const ffLineColMatch = message.match(/line\s+(\d+)\s+column\s+(\d+)/i);
 129:     if (ffLineColMatch) {
 130:         message += `\n\nLocation: Line ${ffLineColMatch[1]}, Column ${ffLineColMatch[2]}`;
 131:         return;
 132:     }
 133: 
 134:     const posMatch = message.match(/(?:at\s+)?position\s+(\d+)/i);
 135:     if (posMatch) {
 136:         const pos = parseInt(posMatch[1], 10);
 137:         const lines = sourceText.substring(0, pos).split('\n');
 138:         const line = lines.length;
 139:         const col = lines[lines.length - 1].length + 1;
 140:         message += `\n\nLocation: Line ${line}, Column ${col}`;
 141:     }
 142: }
 143: ```
 144: 
 145: **Features**:
 146: - Extracts error position from JavaScript error
 147: - Calculates line and column numbers
 148: - Shows exact location of syntax error
 149: - Styled error panel with icon
 150: - Auto-hides when processing succeeds
 151: 
 152: ### Real-time Statistics Dashboard
 153: ```html
 154: <div class="json-stats">
 155:     <div class="stat-item">
 156:         <span class="stat-label">Objects</span>
 157:         <span class="stat-value">4</span>
 158:     </div>
 159:     <!-- More stats... -->
 160: </div>
 161: ```
 162: 
 163: **Statistics Tracked**:
 164: - Number of objects
 165: - Number of arrays
 166: - Total key count
 167: - Maximum nesting depth
 168: 
 169: **Analysis Function**:
 170: ```javascript
 171: function analyzeJSON(obj, depth = 0, stats = null) {
 172:     // Recursively traverses JSON structure
 173:     // Tracks objects, arrays, keys, and depth
 174:     // Returns comprehensive statistics
 175: }
 176: ```
 177: 
 178: ### Smart Options Panel
 179: - Shows only in Format mode
 180: - Hidden in JSONL and Validate modes
 181: - Reduces clutter
 182: - Context-appropriate controls
 183: 
 184: ## ?? Technical Implementation
 185: 
 186: ### 1. Recursive JSON Analysis
 187: ```javascript
 188: function analyzeJSON(obj, depth = 0, stats = null) {
 189:     stats.maxDepth = Math.max(stats.maxDepth, depth);
 190:     
 191:     if (Array.isArray(obj)) {
 192:         stats.arrays++;
 193:         obj.forEach(item => analyzeJSON(item, depth + 1, stats));
 194:     } else if (obj !== null && typeof obj === 'object') {
 195:         stats.objects++;
 196:         stats.keys += Object.keys(obj).length;
 197:         Object.values(obj).forEach(value => 
 198:             analyzeJSON(value, depth + 1, stats)
 199:         );
 200:     }
 201:     
 202:     return stats;
 203: }
 204: ```
 205: 
 206: **Features**:
 207: - Handles deeply nested structures
 208: - Counts all data types
 209: - Tracks maximum depth
 210: - Efficient single-pass algorithm
 211: 
 212: ### 2. Alphabetical Key Sorting
 213: ```javascript
 214: function sortObjectKeys(obj) {
 215:     if (Array.isArray(obj)) {
 216:         return obj.map(sortObjectKeys);
 217:     } else if (obj !== null && typeof obj === 'object') {
 218:         return Object.keys(obj)
 219:             .sort()
 220:             .reduce((sorted, key) => {
 221:                 sorted[key] = sortObjectKeys(obj[key]);
 222:                 return sorted;
 223:             }, {});
 224:     }
 225:     return obj;
 226: }
 227: ```
 228: 
 229: **Features**:
 230: - Recursive sorting (handles nested objects)
 231: - Preserves array order
 232: - Maintains primitive values
 233: - Optional feature (checkbox)
 234: 
 235: ### 3. JSONL Conversion
 236: ```javascript
 237: function convertToJSONL(input) {
 238:     const parsed = JSON.parse(input);
 239:     
 240:     if (!Array.isArray(parsed)) {
 241:         throw new Error('Input must be a JSON array...');
 242:     }
 243:     
 244:     return parsed.map(item => JSON.stringify(item)).join('\n');
 245: }
 246: ```
 247: 
 248: **Validation**:
 249: - Ensures input is array
 250: - Checks for empty arrays
 251: - Each line is valid JSON
 252: - Proper newline separation
 253: 
 254: ### 4. Error Handling
 255: ```javascript
 256: try {
 257:     const startTime = performance.now();
 258:     let result;
 259:     
 260:     switch (currentMode) {
 261:         case 'format': result = formatJSON(input); break;
 262:         case 'jsonl': result = convertToJSONL(input); break;
 263:         case 'validate': result = validateJSON(input); break;
 264:     }
 265:     
 266:     const endTime = performance.now();
 267:     // Success handling...
 268:     
 269: } catch (error) {
 270:     showError(error);
 271:     outputText.value = '';
 272:     showStatus('Error: ' + error.message, 'error');
 273: }
 274: ```
 275: 
 276: **Benefits**:
 277: - Graceful error handling
 278: - User-friendly error messages
 279: - Performance timing
 280: - Clean error recovery
 281: 
 282: ## ?? Comparison: Old vs New
 283: 
 284: | Feature | Old (Inline) | New (Standalone) | Improvement |
 285: |---------|-------------|------------------|-------------|
 286: | **Lines of Code** | ~30 | 600+ | 20x more features |
 287: | **Modes** | 1 (Format only) | 3 (Format, JSONL, Validate) | 3x functionality |
 288: | **Options** | 1 (Indentation) | 2 (Indentation + Sort) | 2x customization |
 289: | **Error Display** | Basic | Detailed with position | Professional |
 290: | **Statistics** | None | 4 metrics + depth | Analytical |
 291: | **JSONL Support** | No | Yes | New feature |
 292: | **Info Panel** | No | Yes (context-aware) | Educational |
 293: | **Example Data** | No | Yes | User-friendly |
 294: | **Key Sorting** | No | Yes | Professional |
 295: | **Validation Mode** | No | Yes | New feature |
 296: 
 297: ## ?? Educational Value
 298: 
 299: ### JSONL Format Explanation
 300: The tool includes educational information about JSONL:
 301: 
 302: ```
 303: Convert JSON arrays to JSON Lines format (JSONL). 
 304: Each array element becomes a separate line of valid JSON. 
 305: Perfect for streaming data and big data processing.
 306: ```
 307: 
 308: **Teaches Users**:
 309: - What JSONL is
 310: - When to use it
 311: - Why it's useful
 312: - Real-world applications
 313: 
 314: ### JSON Structure Analysis
 315: Shows users metrics about their JSON:
 316: - How nested their data is (depth)
 317: - Number of objects vs arrays
 318: - Total key count
 319: - Structure complexity
 320: 
 321: **Benefits**:
 322: - Understand JSON structure
 323: - Optimize data models
 324: - Identify over-nesting
 325: - Learn best practices
 326: 
 327: ## ?? Performance Characteristics
 328: 
 329: ### Processing Speed
 330: - **Small JSON** (<1KB): <5ms
 331: - **Medium JSON** (10-100KB): 5-20ms
 332: - **Large JSON** (1MB+): 50-200ms
 333: 
 334: ### Memory Efficiency
 335: - Uses native `JSON.parse()` (highly optimized)
 336: - Single-pass analysis
 337: - No intermediate string copies
 338: - Efficient for large files
 339: 
 340: ### Browser Compatibility
 341: - Modern browsers (ES6+)
 342: - Uses native JSON methods
 343: - No polyfills needed
 344: - Works offline (no server calls)
 345: 
 346: ## ?? Use Case Examples
 347: 
 348: ### 1. API Response Formatting
 349: **Scenario**: You receive minified JSON from an API
 350: 
 351: **Input**:
 352: ```json
 353: {"status":"ok","data":[{"id":1,"name":"Alice"},{"id":2,"name":"Bob"}],"count":2}
 354: ```
 355: 
 356: **Process**: Format mode with 2-space indent
 357: 
 358: **Output**:
 359: ```json
 360: {
 361:   "status": "ok",
 362:   "data": [
 363:     {
 364:       "id": 1,
 365:       "name": "Alice"
 366:     },
 367:     {
 368:       "id": 2,
 369:       "name": "Bob"
 370:     }
 371:   ],
 372:   "count": 2
 373: }
 374: ```
 375: 
 376: ### 2. Database Import Preparation
 377: **Scenario**: Convert user array to JSONL for MongoDB import
 378: 
 379: **Input**:
 380: ```json
 381: [
 382:   {"username": "alice", "email": "alice@example.com"},
 383:   {"username": "bob", "email": "bob@example.com"}
 384: ]
 385: ```
 386: 
 387: **Process**: JSONL mode
 388: 
 389: **Output**:
 390: ```
 391: {"username":"alice","email":"alice@example.com"}
 392: {"username":"bob","email":"bob@example.com"}
 393: ```
 394: 
 395: **Command**: `mongoimport --file users.jsonl --collection users`
 396: 
 397: ### 3. Config File Standardization
 398: **Scenario**: Standardize team's JSON configs with sorted keys
 399: 
 400: **Input**:
 401: ```json
 402: {"port":3000,"host":"localhost","debug":true,"name":"API"}
 403: ```
 404: 
 405: **Process**: Format mode with "Sort keys" checked
 406: 
 407: **Output**:
 408: ```json
 409: {
 410:   "debug": true,
 411:   "host": "localhost",
 412:   "name": "API",
 413:   "port": 3000
 414: }
 415: ```
 416: 
 417: **Benefit**: Easier git diffs, consistent formatting
 418: 
 419: ## ?? Security & Privacy
 420: 
 421: ### Client-Side Only
 422: - All processing in browser
 423: - No data sent to servers
 424: - JSON payloads are not sent to third-party APIs
 425: - Google Analytics is present for page-level traffic analytics
 426: 
 427: ### Safe Error Handling
 428: - Errors don't expose system info
 429: - No stack traces to users
 430: - Sanitized error messages
 431: - Prevents injection attacks
 432: 
 433: ## ?? Testing Checklist
 434: 
 435: ### Format Mode
 436: - [x] 2-space indentation works
 437: - [x] 4-space indentation works
 438: - [x] Tab indentation works
 439: - [x] Minified output (0 spaces) works
 440: - [x] Key sorting preserves values
 441: - [x] Nested objects format correctly
 442: - [x] Arrays format correctly
 443: - [x] Special characters preserved
 444: - [x] Unicode handled properly
 445: - [x] Empty objects/arrays work
 446: 
 447: ### JSONL Mode
 448: - [x] Array conversion works
 449: - [x] Error on non-array input
 450: - [x] Error on empty array
 451: - [x] Each line is valid JSON
 452: - [x] Nested objects handled
 453: - [x] Statistics panel updates correctly
 454: - [x] Large arrays process correctly
 455: 
 456: ### Validate Mode
 457: - [x] Valid JSON shows success
 458: - [x] Invalid JSON shows error
 459: - [x] Error position detected
 460: - [x] Statistics display
 461: - [x] Type identification works
 462: - [x] Depth calculation correct
 463: 
 464: ### UI/UX
 465: - [x] Mode tabs switch correctly
 466: - [x] Info panel updates per mode
 467: - [x] Options panel hides in non-format modes
 468: - [x] Error panel shows/hides properly
 469: - [x] Stats panel toggles correctly
 470: - [x] Example button loads data
 471: - [x] Copy button works
 472: - [x] Clear button resets all
 473: - [x] Back button returns to index
 474: - [x] Keyboard shortcuts work (Ctrl+Enter)
 475: - [x] Theme switching works
 476: - [x] Accent colors apply
 477: - [x] Mobile responsive
 478: 
 479: ### Edge Cases
 480: - [x] Empty input handled
 481: - [x] Whitespace-only input handled
 482: - [x] Very large JSON (1MB+) works
 483: - [x] Deeply nested JSON (10+ levels) works
 484: - [x] Special characters in keys work
 485: - [x] null values preserved
 486: - [x] Boolean values preserved
 487: - [x] Number precision maintained
 488: 
 489: ## ?? Bonus Features
 490: 
 491: ### 1. Example Data Button
 492: One-click to load realistic example JSON for testing
 493: 
 494: ### 2. Processing Time Display
 495: Shows performance metrics: "Processed in 15ms"
 496: 
 497: ### 3. Dual Character Counters
 498: Both input and output show char + line count
 499: 
 500: ### 4. Context-Aware Button Labels
 501: "Process" vs "Validate" changes based on mode
 502: 
 503: ### 5. Smart Error Recovery
 504: Errors clear automatically on next successful process
 505: 
 506: ## ?? Documentation Integration
 507: 
 508: ### Updated Files
 509: - `index.html` - Added JSON Tool to tools array
 510: - `json-tool.html` - New standalone page created
 511: - `JSON-TOOL-MIGRATION.md` - This documentation
 512: 
 513: ### Navigation Pattern
 514: ```javascript
 515: // From index.html
 516: if (!tool.function) {
 517:     window.location.href = `${tool.id}.html`;
 518: }
 519: 
 520: // Tool card click -> json-tool.html
 521: ```
 522: 
 523: ## ?? Migration from Inline
 524: 
 525: ### Before (Inline in index.html)
 526: ```javascript
 527: {
 528:     id: 'json-formatter',
 529:     name: 'JSON Formatter',
 530:     function: (input, options) => {
 531:         const obj = JSON.parse(input);
 532:         const indent = parseInt(options.indent) || 2;
 533:         return JSON.stringify(obj, null, indent);
 534:     },
 535:     options: [...]
 536: }
 537: ```
 538: 
 539: **Limitations**:
 540: - Single mode only
 541: - Basic error handling
 542: - No JSONL support
 543: - No validation mode
 544: - No statistics
 545: - No key sorting
 546: 
 547: ### After (Standalone Page)
 548: ```javascript
 549: {
 550:     id: 'json-tool',
 551:     name: 'JSON Tool',
 552:     icon: 'data_object',
 553:     category: 'data',
 554:     description: 'Format, validate, and convert JSON to JSONL format'
 555: }
 556: ```
 557: 
 558: **Benefits**:
 559: - Three operational modes
 560: - Advanced error handling
 561: - JSONL conversion
 562: - Structure analysis
 563: - Educational info panels
 564: - Professional UI
 565: 
 566: ## ?? Future Enhancement Ideas
 567: 
 568: ### Phase 1 (Completed) ?
 569: - Format JSON
 570: - Validate JSON
 571: - Convert to JSONL
 572: - Sort keys
 573: - Show statistics
 574: 
 575: ### Phase 2 (Potential)
 576: - JSONL to JSON (reverse conversion)
 577: - JSON Schema validation
 578: - JSONPath query support
 579: - JSON diff/compare tool
 580: - Bulk file processing
 581: 
 582: ### Phase 3 (Advanced)
 583: - JSON to YAML conversion
 584: - JSON to CSV conversion
 585: - Custom formatter rules
 586: - Syntax highlighting
 587: - Auto-save drafts
 588: 
 589: ## ?? Architecture Benefits
 590: 
 591: ### Scalability
 592: - Independent standalone page
 593: - No impact on index.html size
 594: - Can add features without bloating main app
 595: - Easy to maintain and update
 596: 
 597: ### User Experience
 598: - Fast loading (no unnecessary code)
 599: - Clear mode separation
 600: - Educational info panels
 601: - Professional error handling
 602: 
 603: ### Developer Experience
 604: - Clean code organization
 605: - Well-documented functions
 606: - Easy to test individual modes
 607: - Clear separation of concerns
 608: 
 609: ## ? Summary
 610: 
 611: **Status**: ? Production Ready
 612: 
 613: **Tool Capability Score**: ?????
 614: - Format JSON: ?
 615: - Validate JSON: ?
 616: - Convert to JSONL: ?
 617: - Sort Keys: ?
 618: - Analyze Structure: ?
 619: - Error Handling: ?
 620: - User Education: ?
 621: 
 622: **Lines of Code**: 600+
 623: **Modes**: 3
 624: **Options**: 2
 625: **Statistics**: 4
 626: **Error Messages**: Detailed with position
 627: 
 628: **Complexity**: High (but well-organized)
 629: **Maintainability**: Excellent
 630: **User Experience**: Professional
 631: **Feature Set**: Comprehensive
 632: 
 633: ---
 634: 
 635: **Next Migration Target**: Consider tools that would benefit from multi-mode operation similar to JSON Tool's architecture! ??
 636: 
```
----- END FILE: JSON-TOOL-MIGRATION.md -----

----- BEGIN FILE: docs/doc-json-tool.md -----
```markdown
   1: # JSON Tool: Full Technical Walkthrough
   2: 
   3: This document explains how `json-tool.html` works internally, including rendering structure, state flow, processing algorithms, error handling, and integration with shared site modules.
   4: 
   5: ## Scope
   6: 
   7: Primary implementation:
   8: 
   9: - `json-tool.html`
  10: 
  11: Shared dependencies and integration points:
  12: 
  13: - `css/style.css`
  14: - `js/theme.js`
  15: - `index.html`
  16: - `sitemap.xml`
  17: 
  18: ## What the Tool Does
  19: 
  20: JSON Tool is a browser-side utility with three modes:
  21: 
  22: - **Format JSON**: parse + pretty-print JSON with indentation and optional recursive key sorting
  23: - **JSON to JSONL**: parse JSON arrays and emit one compact JSON object per line
  24: - **Validate Only**: parse JSON and return a validation summary with structure statistics
  25: 
  26: The tool never sends user data to a backend; all processing is done in-page with native JavaScript (`JSON.parse`, `JSON.stringify`).
  27: 
  28: ## Page Composition (`json-tool.html`)
  29: 
  30: The page includes:
  31: 
  32: - Shared site shell (logo, network links, accent selector, theme toggle, footer)
  33: - Tool header actions (`Back`, `Example`, `Copy`, `Clear`, `Process`)
  34: - Mode tab strip (`format`, `jsonl`, `validate`)
  35: - Context info panel (`#infoTitle`, `#infoText`)
  36: - Error panel (`#errorPanel`, `#errorMessage`)
  37: - Statistics panel (`#statsPanel`) with object/array/key/depth counters
  38: - Format-only options panel (`#optionsPanel`) for indentation and key sorting
  39: - Input/output textareas and status bar
  40: - Inline script for all tool logic
  41: 
  42: ## Runtime Lifecycle
  43: 
  44: ### 1. Early theme bootstrap
  45: 
  46: Before stylesheet rendering, an inline `<script>` in `<head>`:
  47: 
  48: - resolves theme (`light`/`dark`) from `localStorage.theme` or `prefers-color-scheme`
  49: - resolves accent from `localStorage.accentColor`
  50: - normalizes short hex accents (`#abc` -> `#aabbcc`)
  51: - writes `data-theme` and accent CSS vars to avoid flash of wrong theme
  52: 
  53: ### 2. Shared module initialization
  54: 
  55: `js/theme.js` loads after the page body and handles:
  56: 
  57: - theme toggle button behavior
  58: - accent dropdown options and persistence
  59: - seasonal snow toggle/canvas behavior in holiday window
  60: 
  61: ### 3. JSON Tool script setup
  62: 
  63: The inline JSON Tool script:
  64: 
  65: 1. Caches DOM handles for all controls and outputs.
  66: 2. Sets mutable runtime state with `currentMode = 'format'`.
  67: 3. Defines mode metadata (`modeInfo`) and sample payload (`exampleJSON`).
  68: 4. Registers event listeners for tabs, actions, typing, and keyboard shortcuts.
  69: 5. Calls `updateStats()` and `updateModeUI()` for initial render.
  70: 
  71: ## State Model
  72: 
  73: The tool is lightweight and DOM-driven:
  74: 
  75: - **State variable**: `currentMode`
  76: - **Input state**: `inputText.value`
  77: - **Output state**: `outputText.value`
  78: - **Mode presentation**: tab active classes + `modeInfo` driven labels/text
  79: - **Status state**: `#statusMessage` text + class (`success`, `warning`, `error`)
  80: - **Timing state**: `#processingTime` text
  81: - **Stats state**: `#statsPanel` values + display mode
  82: 
  83: No central store, framework, or persistence layer is used for tool data.
  84: 
  85: ## Mode Switching Internals
  86: 
  87: Each `.mode-tab` sets `currentMode = tab.dataset.mode` and triggers `updateModeUI()`.
  88: 
  89: `updateModeUI()`:
  90: 
  91: - updates info panel title/body from `modeInfo[currentMode]`
  92: - updates output label text
  93: - shows format options only when mode is `format`
  94: - swaps process button icon/text (`play_arrow`/`check_circle`, `Process`/`Validate`)
  95: 
  96: ## Core Processing Algorithms
  97: 
  98: ### 1. Recursive structure analysis (`analyzeJSON`)
  99: 
 100: `analyzeJSON(obj, depth = 0, stats = null)` traverses parsed JSON recursively and tracks:
 101: 
 102: - object count
 103: - array count
 104: - total key count
 105: - maximum nesting depth
 106: 
 107: Implementation details:
 108: 
 109: - arrays increment `stats.arrays` and recurse over each element
 110: - objects increment `stats.objects`, add `Object.keys(obj).length`, and recurse over values
 111: - primitives only update depth
 112: 
 113: This function is reused by all three modes.
 114: 
 115: ### 2. Recursive key sorting (`sortObjectKeys`)
 116: 
 117: When `Sort object keys alphabetically` is enabled in Format mode:
 118: 
 119: - arrays preserve order while each item is recursively sorted
 120: - objects are rebuilt from sorted key lists
 121: - primitives pass through unchanged
 122: 
 123: This guarantees deterministic key ordering across nested structures.
 124: 
 125: ### 3. Format mode (`formatJSON`)
 126: 
 127: Flow:
 128: 
 129: 1. Parse with `JSON.parse(input)`.
 130: 2. Optionally apply recursive sort.
 131: 3. Resolve indentation:
 132:    - `tab` -> `'\t'`
 133:    - `0` -> minified output
 134:    - numeric string -> `parseInt(...)`
 135: 4. Analyze JSON and update stats panel.
 136: 5. Return `JSON.stringify(obj, null, indent)`.
 137: 
 138: ### 4. JSONL mode (`convertToJSONL`)
 139: 
 140: Flow:
 141: 
 142: 1. Parse input JSON.
 143: 2. Enforce array input; throw if input is not an array.
 144: 3. Reject empty arrays with explicit error.
 145: 4. Analyze parsed array and display stats.
 146: 5. Return `parsed.map(item => JSON.stringify(item)).join('\n')`.
 147: 
 148: Output is newline-delimited compact JSON objects, suitable for line-oriented ingestion.
 149: 
 150: ### 5. Validate mode (`validateJSON`)
 151: 
 152: Flow:
 153: 
 154: 1. Parse input.
 155: 2. Analyze structure.
 156: 3. Infer top-level type (`Array`, `Object`, or primitive type).
 157: 4. Return a plain-text validation summary.
 158: 
 159: This mode confirms parse validity without reformatting into canonical JSON output.
 160: 
 161: ## Processing Pipeline (`processJSON`)
 162: 
 163: `processJSON()` is the orchestration function for the `Process` button and Ctrl/Cmd+Enter.
 164: 
 165: Execution path:
 166: 
 167: 1. Trim input; if empty, show warning and stop.
 168: 2. Hide stale error panel.
 169: 3. Start timer (`performance.now()`).
 170: 4. Dispatch by mode:
 171:    - `format` -> `formatJSON`
 172:    - `jsonl` -> `convertToJSONL`
 173:    - `validate` -> `validateJSON`
 174: 5. Write output text.
 175: 6. Show success status.
 176: 7. Show elapsed time in milliseconds.
 177: 8. Refresh char/line stats.
 178: 
 179: Failure path:
 180: 
 181: - catches thrown errors
 182: - logs to console
 183: - shows formatted error panel (`showError`)
 184: - clears output
 185: - updates status and timing to failure state
 186: 
 187: ## Error Handling Details
 188: 
 189: `showError(error)` enhances parse errors by extracting `"position N"` from the native JSON parser message:
 190: 
 191: - maps character offset to line/column using substring split by `\n`
 192: - appends `Location: Line X, Column Y` to the user-facing message
 193: - shows `#errorPanel`
 194: - hides stats panel to avoid stale metrics
 195: 
 196: `hideError()` removes the error panel when a new run starts.
 197: 
 198: ## Auxiliary Actions
 199: 
 200: - `loadExample()` loads a representative nested example payload.
 201: - `clearAll()` resets input/output, hides error + stats, and restores status.
 202: - `copyToClipboard()` copies output if non-empty and reports success/failure.
 203: - `updateStats()` updates input/output char and line counters continuously.
 204: 
 205: ## Event Wiring
 206: 
 207: Bound listeners:
 208: 
 209: - mode tab `click` -> update mode + UI
 210: - process button `click` -> `processJSON()`
 211: - copy button `click` -> `copyToClipboard()`
 212: - clear button `click` -> `clearAll()`
 213: - example button `click` -> `loadExample()`
 214: - back button `click` -> navigate to `index.html`
 215: - input textarea `input` -> `updateStats()`
 216: - input textarea `keydown` with Ctrl/Cmd+Enter -> `processJSON()`
 217: 
 218: ## Site Integration
 219: 
 220: ### `index.html`
 221: 
 222: Tool registry includes:
 223: 
 224: - `id: 'json-tool'`
 225: - card metadata for icon/category/description
 226: 
 227: Card navigation resolves to `json-tool.html`.
 228: 
 229: ### `sitemap.xml`
 230: 
 231: Includes `https://text-utils.net/json-tool.html`.
 232: 
 233: ### Shared styling
 234: 
 235: The tool uses global tokens/components from `css/style.css` and page-local CSS for:
 236: 
 237: - mode tabs
 238: - info/error panel styling
 239: - JSON stats grid
 240: 
 241: ## Edge Cases and Current Limitations
 242: 
 243: - JSONL mode only accepts top-level arrays.
 244: - Empty arrays are intentionally rejected in JSONL conversion.
 245: - Empty input shows a warning and clears stale output/error/stats.
 246: - Inputs larger than 5MB are rejected before parsing to avoid freezing the page.
 247: - Very deeply nested JSON is rejected with explicit depth-limit errors during analysis/sorting.
 248: - Clipboard API requires compatible browser permissions/context.
 249: - Parser and serializer are native JSON only (no comments, trailing commas, JSON5 features).
 250: 
 251: ## Extension Points
 252: 
 253: 1. Add new modes by extending `modeInfo`, tabs, and `processJSON()` dispatch.
 254: 2. Add reverse conversion (`JSONL -> JSON array`) as a fourth mode.
 255: 3. Add schema validation (`ajv`-style) if external dependency policy changes.
 256: 4. Add syntax-highlighted output panel for readability on very large objects.
 257: 5. Add chunked processing for very large arrays if performance becomes an issue.
 258: 
 259: ## Quick Verification Checklist
 260: 
 261: - Format mode: all indentation options and key sorting
 262: - JSONL mode: valid arrays, non-array error, empty-array error
 263: - Validate mode: valid summary + invalid syntax diagnostics
 264: - Error position mapping: line/column shown for malformed input
 265: - Stats panel visibility and values across mode changes
 266: - Copy/Clear/Example actions
 267: - Ctrl/Cmd+Enter shortcut
 268: - Theme/accent persistence and responsiveness on mobile widths
```
----- END FILE: docs/doc-json-tool.md -----

## Referenced Text Excerpts

----- BEGIN EXCERPT: INDEX-SIMPLIFICATION.md | Section: Current Standalone Tools (4) (lines 91-96) -----
```text
  91: ### Current Standalone Tools (4)
  92: 1. ? **case-converter.html** - Text case transformations
  93: 2. ? **text-info.html** - Text analysis & readability
  94: 3. ? **hashing-tool.html** - Encoding & hashing (16 algorithms)
  95: 4. ? **json-tool.html** - JSON formatting, validation, JSONL conversion
```
----- END EXCERPT: INDEX-SIMPLIFICATION.md | Section: Current Standalone Tools (4) (lines 91-96) -----

----- BEGIN EXCERPT: INDEX-SIMPLIFICATION.md | Section: File Structure (lines 108-122) -----
```text
 108: ## File Structure
 109: 
 110: ```
 111: text-utils/
 112: ??? index.html                 (Dashboard - 200 lines)
 113: ??? case-converter.html        (Standalone - 400 lines)
 114: ??? text-info.html             (Standalone - 450 lines)
 115: ??? hashing-tool.html          (Standalone - 600 lines)
 116: ??? json-tool.html             (Standalone - 600 lines)
 117: ??? css/
 118: ?   ??? style.css             (Shared - 400 lines)
 119: ??? js/
 120:     ??? theme.js              (Shared - 100 lines)
 121: ```
```
----- END EXCERPT: INDEX-SIMPLIFICATION.md | Section: File Structure (lines 108-122) -----

----- BEGIN EXCERPT: LINE-OPERATIONS-MIGRATION.md | Section: ? Summary (lines 597-639) -----
```text
 597: ## ? Summary
 598: 
 599: **Status**: ? Production Ready
 600: 
 601: **Feature Completeness**: 100%
 602: - All original features preserved
 603: - UI modernized
 604: - Performance optimized
 605: - Fully documented
 606: 
 607: **Code Quality**: Excellent
 608: - Clean architecture
 609: - Well-commented
 610: - No dependencies
 611: - Security-conscious
 612: 
 613: **User Experience**: Professional
 614: - Intuitive layout
 615: - Real-time feedback
 616: - Keyboard shortcuts
 617: - Responsive design
 618: 
 619: **Scalability**: Ready
 620: - Follows established patterns
 621: - Easy to add features
 622: - Independent tool file
 623: - Minimal index.html impact
 624: 
 625: ---
 626: 
 627: **Files**:
 628: - Created: `line-operations.html` (750 lines)
 629: - Updated: `index.html` (added tool definition)
 630: 
 631: **Tool Count**: 5 standalone tools
 632: 1. Case Converter
 633: 2. Text Info
 634: 3. Line Operations ? NEW
 635: 4. Hashing Tool
 636: 5. JSON Tool
 637: 
 638: **Ready for production use!** ??
```
----- END EXCERPT: LINE-OPERATIONS-MIGRATION.md | Section: ? Summary (lines 597-639) -----

----- BEGIN EXCERPT: README.md | Section: Current Tool Set (lines 7-28) -----
```text
   7: ## Current Tool Set
   8: 
   9: The dashboard (`index.html`) currently exposes these tools:
  10: 
  11: | Tool | File | Category | Description |
  12: | --- | --- | --- | --- |
  13: | Case Converter | `case-converter.html` | Text | Convert text between different letter cases. |
  14: | Text Info | `text-info.html` | Text | Show detailed text metrics and readability info. |
  15: | Line Operations | `line-operations.html` | Text | Sort, filter, and transform lines of text. |
  16: | Find and Replace | `find-replace.html` | Text | Search and replace text with regex support. |
  17: | Font Chooser | `font-chooser.html` | Text | Preview fonts, contrast, and CSS snippets. |
  18: | IP Info | `ip-info.html` | Data | Show public IP, provider, location, and device details. |
  19: | Font Awesome Chooser | `font-awesome-chooser.html` | Data | Browse Font Awesome icons and generate snippets. |
  20: | Google Icons Chooser | `google-icons-chooser.html` | Data | Browse Material icons and generate snippets. |
  21: | Color Chooser | `color-chooser.html` | Data | Pick colors, match closest named colors, and export snippets/PNG. |
  22: | CSS Unit Converter | `css-unit-converter.html` | Convert | Convert CSS units (`px`, `em`, `rem`, `%`, `pt`, `vw`, `vh`). |
  23: | Date/Time Info | `date-time-info.html` | Data | Display date/time formats, calendar views, and timezone output. |
  24: | Random Number Generator | `random-numbers.html` | Data | Generate random numbers with range/uniqueness/sorting options. |
  25: | Hashing Tool | `hashing-tool.html` | Convert | Hash, encode, and decode text with multiple algorithms. |
  26: | JSON Tool | `json-tool.html` | Data | Format, validate, and convert JSON/JSONL. |
  27: | XML Sitemap Generator | `sitemap-generator.html` | Data | Crawl a site and generate `sitemap.xml` output. |
```
----- END EXCERPT: README.md | Section: Current Tool Set (lines 7-28) -----

----- BEGIN EXCERPT: README.md | Section: Helper Scripts (lines 110-121) -----
```text
 110: ## Helper Scripts
 111: 
 112: The repo includes maintenance scripts for targeted context/code dumps:
 113: 
 114: - `scripts/code-dump-tool.py` (generic: any tool page via `--tool`)
 115: - `scripts/code-dump-case-converter.py` (wrapper for Case Converter)
 116: - `scripts/code-dump-color-chooser.py` (wrapper for Color Chooser)
 117: - `scripts/code-dump-json-tool.py` (wrapper for JSON Tool)
 118: - `scripts/code-dump-case-converter.ps1` (legacy PowerShell workflow)
 119: 
 120: Outputs are written to the `context/` folder by default.
```
----- END EXCERPT: README.md | Section: Helper Scripts (lines 110-121) -----

----- BEGIN EXCERPT: TROUBLESHOOTING.md | Section: 1. Complete Tools Array (lines 34-74) -----
```text
  34: #### 1. Complete Tools Array
  35: ```javascript
  36: const tools = [
  37:     {
  38:         id: 'case-converter',
  39:         name: 'Case Converter',
  40:         icon: 'text_format',
  41:         category: 'text',
  42:         description: 'Convert text between different cases'
  43:     },
  44:     {
  45:         id: 'text-info',
  46:         name: 'Text Info',
  47:         icon: 'analytics',
  48:         category: 'text',
  49:         description: 'Detailed statistics and readability scores for text'
  50:     },
  51:     {
  52:         id: 'line-operations',
  53:         name: 'Line Operations',
  54:         icon: 'reorder',
  55:         category: 'text',
  56:         description: 'Sort, filter, and manipulate lines of text'
  57:     },
  58:     {
  59:         id: 'hashing-tool',
  60:         name: 'Hashing Tool',
  61:         icon: 'lock',
  62:         category: 'convert',
  63:         description: 'Hash, encode, and decode text using various algorithms and formats'
  64:     },
  65:     {
  66:         id: 'json-tool',
  67:         name: 'JSON Tool',
  68:         icon: 'data_object',
  69:         category: 'data',
  70:         description: 'Format, validate, and convert JSON to JSONL format'
  71:     }
  72: ];
  73: ```
```
----- END EXCERPT: TROUBLESHOOTING.md | Section: 1. Complete Tools Array (lines 34-74) -----

----- BEGIN EXCERPT: TROUBLESHOOTING.md | Section: Check 1: Tools Display (lines 104-112) -----
```text
 104: #### Check 1: Tools Display
 105: ? Open `index.html` in browser
 106: ? Should see 5 tool cards:
 107:    - Case Converter
 108:    - Text Info
 109:    - Line Operations
 110:    - Hashing Tool
 111:    - JSON Tool
```
----- END EXCERPT: TROUBLESHOOTING.md | Section: Check 1: Tools Display (lines 104-112) -----
