<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Retro Space Defender – Text Utilities</title>
    <meta name="description" content="Play a browser-friendly homage to classic space shooters with keyboard or touchscreen controls.">
    <link rel="icon" href="favicon.ico">
    <link rel="stylesheet" href="css/bootstrap.min.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons" />
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,100..900;1,100..900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="css/custom.css">
    <style>
        #space-invaders-tool canvas {
            width: 100%;
            max-width: 720px;
            aspect-ratio: 4 / 3;
            background: radial-gradient(circle at top, rgba(255,255,255,0.08), transparent 65%), #020616;
            border: 2px solid var(--accent-color, #deb887);
            border-radius: 8px;
            display: block;
            margin: 0 auto;
        }
        #space-invaders-tool .control-btn {
            display: inline-flex;
            align-items: center;
            gap: 0.35rem;
        }
        #space-invaders-tool .hud-badge {
            font-family: 'Roboto Mono', monospace;
            font-size: 0.95rem;
            background-color: rgba(222, 184, 135, 0.15);
            border: 1px solid rgba(222, 184, 135, 0.4);
            border-radius: 0.5rem;
            padding: 0.35rem 0.75rem;
            margin-right: 0.5rem;
        }
        #space-invaders-tool #touchControls button {
            width: 100%;
        }
    </style>
</head>
<body class="bg-dark text-light">
    <div id="header-placeholder"></div>
    <noscript>
        <div class="bg-dark text-light p-3 border-bottom border-secondary">Text Utils <span class="text-muted">(static header fallback)</span></div>
    </noscript>
    <div id="space-invaders-tool" class="container-fluid my-4">
        <div class="row gx-3 gy-3">
            <main class="col-md-9">
                <div class="card bg-dark border-secondary h-100">
                    <div class="card-body">
                        <div class="d-flex align-items-center mb-3">
                            <span class="material-icons me-3" aria-hidden="true" style="font-size: 36px;">rocket_launch</span>
                            <h2 class="m-0">Retro Space Defender</h2>
                        </div>
                        <p class="text-white-50 mb-4">
                            Defend the quadrant from waves of pixel invaders inspired by arcade classics. Use the keyboard or on-screen controls to dodge lasers and rack up combos while chasing the high score.
                        </p>
                        <div class="row g-3">
                            <div class="col-lg-8">
                                <section class="mb-3">
                                    <div class="d-flex flex-wrap align-items-center mb-3">
                                        <span class="hud-badge" id="scoreBadge" aria-live="polite">Score: 0</span>
                                        <span class="hud-badge" id="livesBadge">Lives: 3</span>
                                        <span class="hud-badge" id="waveBadge">Wave: 1</span>
                                    </div>
                                    <canvas id="gameCanvas" width="480" height="360" role="img" aria-label="Retro space shooter game area"></canvas>
                                </section>
                                <section class="mb-3">
                                    <div class="d-flex flex-wrap gap-2">
                                        <button type="button" class="btn btn-task control-btn" id="startButton">
                                            <span class="material-icons" aria-hidden="true">play_arrow</span>
                                            Start / Restart
                                        </button>
                                        <button type="button" class="btn btn-secondary control-btn" id="pauseButton">
                                            <span class="material-icons" aria-hidden="true">pause</span>
                                            Pause
                                        </button>
                                        <button type="button" class="btn btn-outline-light control-btn" id="muteButton">
                                            <span class="material-icons" aria-hidden="true">volume_up</span>
                                            Sound On
                                        </button>
                                    </div>
                                </section>
                                <section class="mb-3">
                                    <h3 class="h5">How to Play</h3>
                                    <ul class="small text-white-50 mb-2">
                                        <li><kbd>←</kbd> / <kbd>→</kbd> move, <kbd>Space</kbd> to fire. Press <kbd>P</kbd> to pause.</li>
                                        <li>Destroy invaders before they reach the defenses. Shooting streaks increase your combo multiplier and bonus score.</li>
                                        <li>Collect power-ups for rapid fire and shields. Survive all waves to secure a victory badge.</li>
                                    </ul>
                                </section>
                            </div>
                            <aside class="col-lg-4">
                                <div class="card bg-dark border-secondary mb-3">
                                    <div class="card-header">
                                        <h3 class="h6 mb-0">Touch Controls</h3>
                                    </div>
                                    <div class="card-body" id="touchControls">
                                        <div class="row g-2">
                                            <div class="col-4">
                                                <button type="button" class="btn btn-outline-secondary" data-action="left">
                                                    <span class="material-icons" aria-hidden="true">arrow_back</span>
                                                    <span class="visually-hidden">Move left</span>
                                                </button>
                                            </div>
                                            <div class="col-4">
                                                <button type="button" class="btn btn-outline-secondary" data-action="fire">
                                                    <span class="material-icons" aria-hidden="true">bolt</span>
                                                    <span class="visually-hidden">Fire laser</span>
                                                </button>
                                            </div>
                                            <div class="col-4">
                                                <button type="button" class="btn btn-outline-secondary" data-action="right">
                                                    <span class="material-icons" aria-hidden="true">arrow_forward</span>
                                                    <span class="visually-hidden">Move right</span>
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="card bg-dark border-secondary">
                                    <div class="card-header">
                                        <h3 class="h6 mb-0">Power-Up Log</h3>
                                    </div>
                                    <div class="card-body">
                                        <ul id="powerupLog" class="small list-unstyled mb-0 text-white-50">
                                            <li>No power-ups collected yet.</li>
                                        </ul>
                                    </div>
                                </div>
                            </aside>
                        </div>
                    </div>
                </div>
            </main>
            <aside class="col-md-3">
                <div class="card bg-dark border-secondary h-100">
                    <div class="card-body p-0">
                        <nav class="sidebar nav flex-column" id="dynamic-sidebar"></nav>
                    </div>
                </div>
            </aside>
        </div>
    </div>
    <div id="footer-placeholder"></div>
    <noscript>
        <div class="bg-dark text-light p-3 border-top border-secondary text-center">Text Utils <span class="text-muted">(static footer fallback)</span></div>
    </noscript>
    <div id="sr-announcer" class="visually-hidden" aria-live="polite" aria-atomic="true"></div>
    <script src="js/bootstrap.bundle.min.js"></script>
    <script src="js/component-loader.js"></script>
    <script>
        (function initThemeAndSidebar() {
            const themes = ['burlywood','cadetblue','cornflowerblue','dodgerblue','lightcoral','lightgreen','plum','thistle','tomato','violet','goldenyellow','mutedcoral','softpink','lightcyan','lightgray','neongreen','brightyellow'];
            const htmlElement = document.documentElement;
            const dropdown = document.getElementById('accentColorDropdownMenu');
            function applyTheme(theme) {
                htmlElement.className = '';
                htmlElement.classList.add('theme-' + theme);
                localStorage.setItem('accentTheme', theme);
            }
            document.addEventListener('DOMContentLoaded', async () => {
                await ComponentLoader.loadAll();
                if (dropdown && dropdown.childElementCount === 0) {
                    themes.forEach(theme => {
                        const li = document.createElement('li');
                        const button = document.createElement('button');
                        button.className = 'dropdown-item';
                        button.type = 'button';
                        button.textContent = theme;
                        button.addEventListener('click', () => applyTheme(theme));
                        li.appendChild(button);
                        dropdown.appendChild(li);
                    });
                }
                applyTheme(localStorage.getItem('accentTheme') || 'burlywood');
                try {
                    const response = await fetch('config/tools.json');
                    if (!response.ok) throw new Error('Failed to load tools.json');
                    const tools = await response.json();
                    tools.sort((a, b) => a.name.localeCompare(b.name));
                    const sidebarHtml = tools.map(tool => {
                        const isActive = tool.slug === 'space-invaders';
                        const activeClass = isActive ? ' active' : '';
                        const iconHtml = tool.icon ?
                            (tool.icon.endsWith('.svg') || tool.icon.endsWith('.png') ?
                                `<img src="${tool.icon}" alt="" class="icon me-2" aria-hidden="true" />` :
                                `<span class="material-icons me-2" aria-hidden="true">${tool.icon}</span>`) :
                            `<span class="me-2" style="width: 24px;"></span>`;
                        return `
                            <a class="nav-link d-flex align-items-center${activeClass}" href="${tool.slug}.html">
                                ${iconHtml}
                                <span>${tool.name}</span>
                            </a>
                        `;
                    }).join('');
                    document.getElementById('dynamic-sidebar').innerHTML = sidebarHtml;
                } catch (err) {
                    document.getElementById('dynamic-sidebar').innerHTML = '<div class="alert alert-danger m-3">Failed to load tools.</div>';
                }
            });
        })();
    </script>
    <script src="js/space-invaders.js"></script>
</body>
</html>
