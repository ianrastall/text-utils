<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Color Chooser - Text Utilities</title>
    <link rel="icon" href="favicon.ico">
    <link rel="stylesheet" href="css/bootstrap.min.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons" />
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,100..900;1,100..900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="css/custom.css">
</head>
<body class="bg-black text-light">
    <div id="header-placeholder"></div>
    <div class="container-fluid my-4">
        <div class="row gx-3 gy-3">
            <main class="col-md-9">
                <div class="card bg-dark border-secondary">
                    <div class="card-body">
                        <h2 class="card-title mb-4 d-flex align-items-center" id="dynamic-title">
                            <span class="material-icons me-3" style="font-size: 36px;" aria-hidden="true" id="tool-icon">palette</span>
                            <span id="tool-name">Color Chooser</span>
                        </h2>
                        <p class="text-white-50 mb-4" id="tool-description">Select named or custom colors and generate corresponding code snippets for various programming languages.</p>
                        <div class="post-content">
                            <form onsubmit="return false;" class="row g-3 align-items-end p-3 mb-4 rounded" style="background-color: #1E1E1E;">
                                <div class="col-md-4">
                                    <label for="colorCategory" class="form-label">Color Category</label>
                                    <select id="colorCategory" class="form-select">
                                        <option value="">--Select Category--</option>
                                    </select>
                                </div>
                                <div class="col-md-4">
                                    <label for="colorName" class="form-label">Color Name</label>
                                    <select id="colorName" class="form-select">
                                        <option value="">--Select Color--</option>
                                    </select>
                                </div>
                                <div class="col-md-4">
                                    <label for="languageSelect" class="form-label">Language Format</label>
                                    <select id="languageSelect" class="form-select"></select>
                                </div>
                            </form>
                            <div class="row g-3 align-items-center mb-4">
                                 <div class="col-md-auto">
                                    <input type="color" id="customColorInput" class="form-control form-control-color" value="#FFFFFF" title="Choose a custom color" style="width: 5rem; height: 3rem;">
                                </div>
                                <div class="col-md-auto">
                                    <button type="button" class="btn btn-task d-flex align-items-center" id="eyedropperBtn">
                                        <span class="material-icons me-2">colorize</span> Eyedropper
                                    </button>
                                </div>
                                <div class="col-md-auto">
                                    <div id="colorDisplay" class="border rounded" style="width: 5rem; height: 3rem; background-color: #FFFFFF; border-color: #444 !important;" title="Current Color"></div>
                                </div>
                                <div class="col">
                                    <label for="colorOutput" class="form-label visually-hidden">Color Code Output</label>
                                    <div class="position-relative">
                                        <textarea id="colorOutput" class="form-control font-monospace" rows="4" readonly placeholder="Select a color or language..."></textarea>
                                        <button type="button" class="btn btn-sm btn-edit position-absolute top-0 end-0 m-2" id="copyBtn" title="Copy Code">
                                             <span class="material-icons" style="font-size: 1.1rem;">content_copy</span>
                                        </button>
                                    </div>
                                </div>
                            </div>
                            <hr class="border-secondary my-4">
                            <h4 class="mb-3">Find Named Color by Code</h4>
                            <form id="colorSearchForm" onsubmit="return false;">
                                <div class="input-group">
                                    <input type="text" id="colorInput" class="form-control" placeholder="Enter hex (e.g., #FF0000) or RGB (e.g., 255, 0, 0)">
                                    <button type="submit" class="btn btn-task d-flex align-items-center">
                                         <span class="material-icons me-2">search</span>Set & Find
                                    </button>
                                </div>
                            </form>
                            <div id="colorSearchResult" class="mt-3" style="min-height: 48px;" aria-live="polite"></div>
                        </div>
                    </div>
                </div>
            </main>
            <aside class="col-md-3">
                <div class="card bg-dark border-secondary">
                    <div class="card-body p-0">
                        <nav class="sidebar nav flex-column" id="dynamic-sidebar"></nav>
                    </div>
                </div>
            </aside>
        </div>
    </div>
    <div id="footer-placeholder"></div>
    <script src="js/bootstrap.bundle.min.js"></script>
    <script src="js/component-loader.js"></script>
    <script src="js/main.js"></script>
    <script>
        // --- Color Chooser Tool Logic ---
        (function() {
            'use strict';
            // --- Data Definitions (from C# version) ---
            const colors = { /* ... (full color object as in your draft) ... */ };
            const languages = { "css": "CSS", "javascript": "JavaScript", "python": "Python", "java": "Java", "csharp": "C#", "php": "PHP", "ruby": "Ruby", "swift": "Swift", "kotlin": "Kotlin", "c++": "C++", "go": "Go", "r": "R", "matlab": "MATLAB", "typescript": "TypeScript", "shell": "Shell", "objective-c": "Objective-C", "html": "HTML", "json": "JSON", "sql": "SQL", "rust": "Rust", "dart": "Dart", "sass": "Sass", "c": "C", "powershell": "PowerShell" };
            let currentColor = "#FFFFFF";
            // --- DOM Elements ---
            const colorCategorySelect = document.getElementById("colorCategory");
            const colorNameSelect = document.getElementById("colorName");
            const languageSelect = document.getElementById("languageSelect");
            const customColorInput = document.getElementById("customColorInput");
            const eyedropperBtn = document.getElementById("eyedropperBtn");
            const colorDisplay = document.getElementById("colorDisplay");
            const colorOutput = document.getElementById("colorOutput");
            const colorSearchForm = document.getElementById('colorSearchForm');
            const colorInput = document.getElementById('colorInput');
            const colorSearchResult = document.getElementById('colorSearchResult');
            const copyBtn = document.getElementById('copyBtn');
            // --- Helper Functions ---
            const hexToRgb = (hex) => {
                hex = hex.replace('#', '');
                if (hex.length === 3) hex = hex.split('').map(c => c + c).join('');
                if (hex.length !== 6) return null;
                const bigint = parseInt(hex, 16);
                return isNaN(bigint) ? null : { r: (bigint >> 16) & 255, g: (bigint >> 8) & 255, b: bigint & 255 };
            };
            const rgbToHex = (r, g, b) => '#' + [r, g, b].map(c => Math.round(c).toString(16).padStart(2, '0')).join('').toUpperCase();
            const parseColorInput = (input) => {
                input = input.trim();
                if (/^#?([0-9a-fA-F]{3}){1,2}$/.test(input)) {
                    let hex = input.startsWith('#') ? input : '#' + input;
                    return hex.toUpperCase();
                }
                const rgbMatch = input.match(/^(?:rgba?\(?)?\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*\)?$/);
                if (rgbMatch) {
                    const [r, g, b] = rgbMatch.slice(1).map(Number);
                    if ([r, g, b].every(c => c >= 0 && c <= 255)) return rgbToHex(r, g, b);
                }
                return null;
            };
            const findClosestColor = (targetHex) => {
                const targetRgb = hexToRgb(targetHex);
                if (!targetRgb) return null;
                let closestMatch = null;
                let minDistance = Infinity;
                for (const category in colors) {
                    for (const name in colors[category]) {
                        const colorRgb = hexToRgb(colors[category][name]);
                        if (!colorRgb) continue;
                        const distance = Math.sqrt(Math.pow(targetRgb.r - colorRgb.r, 2) + Math.pow(targetRgb.g - colorRgb.g, 2) + Math.pow(targetRgb.b - colorRgb.b, 2));
                        if (distance < minDistance) {
                            minDistance = distance;
                            closestMatch = { name, hex: colors[category][name].toUpperCase(), category };
                        }
                    }
                }
                return closestMatch;
            };
            // --- Core Logic ---
            const generateColorCode = () => {
                const lang = languageSelect.value;
                const rgb = hexToRgb(currentColor);
                if (!rgb) { colorOutput.value = "Invalid color selected."; return; }
                const rgbString = `rgb(${rgb.r}, ${rgb.g}, ${rgb.b})`;
                const formats = {
                    css: `color: ${currentColor};\n/* or */\ncolor: ${rgbString};`,
                    html: `<div style="color:${currentColor};">Example Text</div>`,
                    javascript: `const colorHex = '${currentColor}';\nconst colorRGB = { r: ${rgb.r}, g: ${rgb.g}, b: ${rgb.b} };`,
                    python: `color_hex = '${currentColor}'\ncolor_rgb = (${rgb.r}, ${rgb.g}, ${rgb.b})`,
                    php: `$colorHex = '${currentColor}';\n$colorRGB = ['r' => ${rgb.r}, 'g' => ${rgb.g}, 'b' => ${rgb.b}];`,
                    java: `String colorHex = "${currentColor}";\n// java.awt.Color color = java.awt.Color.decode("${currentColor}");`,
                    csharp: `string colorHex = "${currentColor}";\n// System.Drawing.Color color = System.Drawing.ColorTranslator.FromHtml("${currentColor}");`,
                    ruby: `color_hex = '${currentColor}'\ncolor_rgb = { r: ${rgb.r}, g: ${rgb.g}, b: ${rgb.b} }`,
                    swift: `let colorHex = "${currentColor}" // Needs UIColor extension for direct use`,
                    kotlin: `val colorHex = "${currentColor}" // Needs Color.parseColor(colorHex)`,
                    "c++": `std::string colorHex = "${currentColor}";\nstruct ColorRGB { int r, g, b; } color = {${rgb.r}, ${rgb.g}, ${rgb.b}};`,
                    c: `const char* color_hex = "${currentColor}";\nunsigned char color_rgb[] = {${rgb.r}, ${rgb.g}, ${rgb.b}};`,
                    go: `colorHex := "${currentColor}"`,
                    rust: `let color_hex = "${currentColor}";\nlet color_rgb: (u8, u8, u8) = (${rgb.r}, ${rgb.g}, ${rgb.b});`,
                    dart: `const String colorHex = "${currentColor}";\n// const Color myColor = Color(0xFF${currentColor.substring(1)});`,
                    r: `color_hex <- "${currentColor}"`,
                    matlab: `color_rgb_255 = [${rgb.r}, ${rgb.g}, ${rgb.b}];\ncolor_rgb_1 = color_rgb_255 / 255;`,
                    typescript: `const colorHex: string = '${currentColor}';\nconst colorRGB = { r: ${rgb.r}, g: ${rgb.g}, b: ${rgb.b} };`,
                    shell: `COLOR_HEX='${currentColor}'\nCOLOR_RGB="(${rgb.r},${rgb.g},${rgb.b})"`,
                    powershell: `$colorHex = "${currentColor}"\n$colorRgb = @{ R = ${rgb.r}; G = ${rgb.g}; B = ${rgb.b} }`,
                    "objective-c": `NSString *colorHex = @"${currentColor}"; // Needs helper to convert to UIColor`,
                    sql: `DECLARE @color_hex VARCHAR(7) = '${currentColor}';\n-- RGB: ${rgb.r}, ${rgb.g}, ${rgb.b}`,
                    json: `{\n  "hex": "${currentColor}",\n  "rgb": [${rgb.r}, ${rgb.g}, ${rgb.b}]\n}`,
                    sass: `$my-color: ${currentColor};`
                };
                colorOutput.value = formats[lang] || `Selected Color: ${currentColor}`;
            };
            const updateColor = (newHexColor, source = 'unknown') => {
                const validatedHex = parseColorInput(newHexColor);
                if (!validatedHex) return;
                currentColor = validatedHex;
                colorDisplay.style.backgroundColor = currentColor;
                if (source !== 'customInput') customColorInput.value = currentColor;
                if (source !== 'nameSelect' && source !== 'categorySelect') {
                    const exactMatch = findClosestColor(currentColor);
                    if (exactMatch && exactMatch.hex === currentColor) {
                        if (colorCategorySelect.value !== exactMatch.category) {
                            colorCategorySelect.value = exactMatch.category;
                            populateColorNames();
                        }
                        colorNameSelect.value = currentColor;
                    } else {
                        colorCategorySelect.value = "";
                        populateColorNames();
                    }
                }
                generateColorCode();
                if (source !== 'searchInput') colorSearchResult.innerHTML = '';
            };
            // --- UI Population ---
            const populateCategories = () => {
                const sortedCategories = Object.keys(colors).sort();
                colorCategorySelect.innerHTML = '<option value="">--Select Category--</option>' + sortedCategories.map(cat => `<option value="${cat}">${cat}</option>`).join('');
            };
            const populateColorNames = () => {
                const category = colorCategorySelect.value;
                colorNameSelect.innerHTML = '<option value="">--Select Color--</option>';
                if (category && colors[category]) {
                    const sortedNames = Object.entries(colors[category]).sort((a, b) => a[0].localeCompare(b[0]));
                    colorNameSelect.innerHTML += sortedNames.map(([name, hex]) => `<option value="${hex}">${name}</option>`).join('');
                }
            };
            const populateLanguages = () => {
                languageSelect.innerHTML = Object.entries(languages).sort((a, b) => a[1].localeCompare(b[1])).map(([code, name]) => `<option value="${code}">${name}</option>`).join('');
                languageSelect.value = 'css';
            };
            // --- Event Listeners ---
            colorCategorySelect.addEventListener("change", () => populateColorNames());
            colorNameSelect.addEventListener("change", (e) => { if (e.target.value) updateColor(e.target.value, 'nameSelect'); });
            languageSelect.addEventListener("change", generateColorCode);
            customColorInput.addEventListener("input", (e) => updateColor(e.target.value, 'customInput'));
            eyedropperBtn.addEventListener('click', async () => {
                if (!window.EyeDropper) {
                    showToast('Eyedropper API is not supported by this browser.', 'warning');
                    return;
                }
                try {
                    const result = await new EyeDropper().open();
                    updateColor(result.sRGBHex, 'eyedropper');
                } catch (err) {
                    console.info('EyeDropper was dismissed or failed.', err);
                }
            });
            colorSearchForm.addEventListener('submit', (e) => {
                e.preventDefault();
                const parsedHex = parseColorInput(colorInput.value);
                if (!parsedHex) {
                    colorSearchResult.innerHTML = `<div class="alert alert-danger mb-0">Invalid format. Use hex (#RRGGBB) or RGB (R, G, B).</div>`;
                    return;
                }
                updateColor(parsedHex, 'searchInput');
                const closest = findClosestColor(parsedHex);
                if (!closest) {
                    colorSearchResult.innerHTML = `<div class="alert alert-warning mb-0">Color set, but no named colors found for comparison.</div>`;
                    return;
                }
                const previewStyle = `display: inline-block; width: 1.1em; height: 1.1em; border: 1px solid #666; vertical-align: -0.15em; margin: 0 0.25em; border-radius: 3px;`;
                let resultHTML = `<div class="alert alert-success d-flex align-items-center mb-0">Set: <span style="background:${parsedHex}; ${previewStyle}"></span><strong>${parsedHex}</strong>`;
                if (closest.hex !== parsedHex) {
                    resultHTML += `<span class="mx-2">|</span>Closest Match: <span style="background:${closest.hex}; ${previewStyle}"></span><strong>${closest.name}</strong> (${closest.hex})`;
                } else {
                    resultHTML += `<span class="mx-2">|</span>Exact Match: <strong>${closest.name}</strong>`;
                }
                resultHTML += `</div>`;
                colorSearchResult.innerHTML = resultHTML;
            });
            copyBtn.addEventListener('click', async () => {
                 if (!colorOutput.value) {
                     showToast('Nothing to copy.', 'info');
                     return;
                 }
                try {
                    await navigator.clipboard.writeText(colorOutput.value);
                    showToast('Code copied to clipboard.', 'success');
                } catch (err) {
                    showToast(`Copy failed: ${err.message}`, 'danger');
                }
            });
            function showToast(message, variant = 'info') {
                const container = document.createElement('div');
                container.className = 'toast-container position-fixed bottom-0 end-0 p-3';
                const toast = document.createElement('div');
                toast.className = `toast align-items-center text-bg-${variant} border-0`;
                toast.setAttribute('role', 'alert');
                toast.innerHTML = `<div class="d-flex"><div class="toast-body">${message}</div><button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast" aria-label="Close"></button></div>`;
                document.body.appendChild(container);
                container.appendChild(toast);
                const toastInstance = new bootstrap.Toast(toast, { delay: 3000 });
                toastInstance.show();
                toast.addEventListener('hidden.bs.toast', () => container.remove());
            }
            // --- Initialization ---
            populateCategories();
            populateLanguages();
            updateColor(currentColor, 'init');
        })();
    </script>
</body>
</html>
