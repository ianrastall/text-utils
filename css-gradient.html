<!-- css-gradient.html - CSS Gradient Generator (static, JS, Bootstrap 5) -->
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>CSS Gradient Generator - Text Utilities</title>
  <link rel="icon" href="favicon.ico">
  <link rel="stylesheet" href="css/bootstrap.min.css">
  <link rel="stylesheet" href="css/custom.css">
  <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
  <style>
    /* ...existing CSS from your PHP file... */
    #css-gradient-tool .color-stop-row {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      padding: 0.5rem;
      border: 1px solid #444;
      border-radius: 0.375rem;
      margin-bottom: 0.5rem;
      cursor: grab;
      background-color: #2a2a2a;
    }
    #css-gradient-tool .color-stop-row .form-control-color {
        width: 50px;
        height: 38px;
        padding: 0.2rem;
        flex-shrink: 0;
        min-width: 50px;
    }
    #css-gradient-tool .color-stop-row .input-group {
        flex: 1 1 auto;
    }
    #css-gradient-tool .color-stop-row .btn .material-icons {
        vertical-align: middle;
        font-size: 20px;
    }
    #css-gradient-tool .dragging-placeholder {
        height: 58px;
        margin-bottom: 0.5rem;
        background: rgba(var(--accent-color-rgb, 222, 184, 135), 0.15);
        border: 1px dashed var(--accent-color, #DEB887);
        border-radius: 0.375rem;
    }
    #css-gradient-tool .color-stop-row.dragging {
        opacity: 0.5;
        cursor: grabbing;
        border-color: var(--accent-color, #DEB887);
    }
    #gradientPreview {
      height: 200px;
      border-radius: 0.375rem;
      border: 1px solid #444;
      transition: background-image 0.3s ease;
      background-color: #3a3a3a;
    }
    #codeOutput {
        resize: vertical;
    }
    .palette-preview {
         width: 100px;
         height: 20px;
         border: 1px solid #666;
         border-radius: 2px;
         flex-shrink: 0;
         margin-left: auto;
    }
  </style>
</head>
<body class="bg-black text-light">
  <div id="header-placeholder"></div>
  <div class="container-fluid my-4">
    <div class="row gx-3 gy-3">
      <main class="col-md-9">
        <div id="css-gradient-tool" class="card bg-dark border-secondary h-100">
          <div class="card-body">
            <div class="d-flex align-items-center mb-3">
              <span class="material-icons me-3" aria-hidden="true" style="font-size: 36px;">palette</span>
              <h2 class="m-0">CSS Gradient Generator</h2>
            </div>
            <p class="text-white-50 mb-4">Visually create linear, radial, and conic CSS gradients. Drag color stops, copy code, or download PNG.</p>
            <form onsubmit="return false;">
              <div class="row">
                <div class="col-lg-6 mb-4 mb-lg-0">
                  <h5 class="mb-3">Settings</h5>
                  <div class="mb-3">
                    <label for="gradientTypeSelect" class="form-label">1. Gradient Type</label>
                    <select id="gradientTypeSelect" class="form-select">
                      <option value="linear" selected>Linear</option>
                      <option value="radial">Radial</option>
                      <option value="conic">Conic</option>
                    </select>
                  </div>
                  <div class="mb-3">
                    <label class="form-label d-block">2. Configure Type</label>
                    <div id="linearControls">
                      <div class="input-group">
                        <select id="linearDirectionKeyword" class="form-select">
                          <option value="to right" selected>to right</option>
                          <option value="to bottom">to bottom</option>
                          <option value="to left">to left</option>
                          <option value="to top">to top</option>
                          <option value="to top left">to top left</option>
                          <option value="to top right">to top right</option>
                          <option value="to bottom left">to bottom left</option>
                          <option value="to bottom right">to bottom right</option>
                          <option value="angle">Angle</option>
                        </select>
                        <div class="input-group d-none" id="linearAngleContainer">
                          <input type="number" id="linearAngle" class="form-control" value="90" step="1" style="border-left: 0; border-top-left-radius: 0; border-bottom-left-radius: 0;">
                          <span class="input-group-text">deg</span>
                        </div>
                      </div>
                    </div>
                    <div id="radialControls" class="d-none">
                      <div class="row g-2">
                        <div class="col-sm-4"><select id="radialShape" class="form-select" aria-label="Shape"><option value="ellipse" selected>Ellipse</option><option value="circle">Circle</option></select></div>
                        <div class="col-sm-4"><select id="radialSize" class="form-select" aria-label="Size"><option value="farthest-corner" selected>Farthest Corner</option><option value="closest-side">Closest Side</option><option value="farthest-side">Farthest Side</option><option value="closest-corner">Closest Corner</option></select></div>
                        <div class="col-sm-4"><select id="radialPosition" class="form-select" aria-label="Position"><option value="center" selected>Center</option><option value="top">Top</option><option value="bottom">Bottom</option><option value="left">Left</option><option value="right">Right</option></select></div>
                      </div>
                    </div>
                    <div id="conicControls" class="d-none">
                      <div class="row g-2">
                        <div class="col-sm-6"><div class="input-group"><span class="input-group-text">From</span><input type="number" id="conicAngleFrom" class="form-control" value="0" step="1"><span class="input-group-text">deg</span></div></div>
                        <div class="col-sm-6"><select id="conicPosition" class="form-select" aria-label="Position"><option value="center" selected>at Center</option><option value="top">at Top</option><option value="bottom">at Bottom</option><option value="left">at Left</option><option value="right">at Right</option></select></div>
                      </div>
                    </div>
                  </div>
                  <div class="mb-3">
                    <label class="form-label d-block">3. Adjust Color Stops</label>
                    <button id="browsePalettesBtn" type="button" class="btn btn-secondary btn-sm mb-2" data-bs-toggle="modal" data-bs-target="#paletteModal">Browse Palettes...</button>
                    <span id="selectedPaletteName" class="ms-2 text-white-50 small"></span>
                    <div id="colorStopsContainer" class="mb-2"></div>
                    <button type="button" id="addStopBtn" class="btn btn-sm btn-task"><span class="material-icons me-1" style="font-size:1em; vertical-align: text-bottom;">add</span>Add Stop</button>
                  </div>
                </div>
                <div class="col-lg-6">
                  <div class="mb-4">
                    <label class="form-label">Preview</label>
                    <div id="gradientPreview"></div>
                  </div>
                  <div class="mb-3">
                    <label for="codeOutput" class="form-label">CSS Code</label>
                    <textarea id="codeOutput" class="form-control font-monospace" rows="4" readonly></textarea>
                  </div>
                  <div class="d-flex gap-2 mb-4">
                    <button type="button" id="copyCodeBtn" class="btn btn-task"><span class="material-icons me-2">content_copy</span>Copy Code</button>
                  </div>
                  <label class="form-label">Download Image (PNG)</label>
                  <div class="row g-2 align-items-center">
                    <div class="col-sm-4"><div class="input-group"><span class="input-group-text">W</span><input type="number" id="downloadWidth" class="form-control" value="800" min="1"></div></div>
                    <div class="col-sm-4"><div class="input-group"><span class="input-group-text">H</span><input type="number" id="downloadHeight" class="form-control" value="600" min="1"></div></div>
                    <div class="col-sm-4"><button type="button" id="downloadBtn" class="btn btn-task w-100"><span class="material-icons me-2">download</span>Download</button></div>
                  </div>
                </div>
              </div>
            </form>
          </div>
        </div>
      </main>
      <aside class="col-md-3">
        <div class="card bg-dark border-secondary">
          <div class="card-body p-0">
            <nav class="sidebar nav flex-column" id="dynamic-sidebar"></nav>
          </div>
        </div>
      </aside>
    </div>
  </div>
  <div id="footer-placeholder"></div>
  <!-- Modal for palette browser -->
  <div class="modal fade" id="paletteModal" tabindex="-1" aria-labelledby="paletteModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg modal-dialog-scrollable">
      <div class="modal-content bg-dark text-light">
        <div class="modal-header border-secondary">
          <h5 class="modal-title" id="paletteModalLabel">Select Color Palette</h5>
          <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <input type="text" id="paletteSearch" class="form-control mb-3" placeholder="Search palettes..." aria-label="Search palettes">
          <div id="paletteListContainer" class="list-group">
            <div class="p-5 text-center text-white-50">Loading palettes...</div>
          </div>
        </div>
      </div>
    </div>
  </div>
  <div id="toastContainer" class="toast-container position-fixed bottom-0 end-0 p-3"></div>
  <script src="js/bootstrap.bundle.min.js"></script>
  <script src="js/component-loader.js"></script>
  <script src="js/main.js"></script>
  <!-- The main tool logic will be placed here as a <script> block, as in your PHP file -->
  <script>
// --- BEGIN: Full JS logic from the original PHP file, adapted for static HTML ---
// Hardcoded Gradient Palettes (from uiGradients)
const uiGradientsPalettes = [
		{"name":"50 Shades of Grey","colors":["#bdc3c7","#2c3e50"]},
		{"name":"80s Purple","colors":["#41295a","#2F0743"]},
		{"name":"A Lost Memory","colors":["#DE6262","#FFB88C"]},
		{"name":"Abbas","colors":["#00fff0","#0083fe"]},
		{"name":"After the Rain","colors":["#ff75c3","#ffa647","#ffe83f","#9fff5b","#70e2ff","#cd93ff"]},
		{"name":"Afternoon","colors":["#000C40","#607D8B"]},
		{"name":"Ali","colors":["#ff4b1f","#1fddff"]},
		{"name":"Alihossein","colors":["#f7ff00","#db36a4"]},
		{"name":"Alive","colors":["#CB356B","#BD3F32"]},
		{"name":"Almost","colors":["#ddd6f3","#faaca8"]},
		{"name":"Ameena","colors":["#0c0c6d","#de512b","#98d0c1","#5bb226","#023c0d"]},
		{"name":"Amethyst","colors":["#9D50BB","#6E48AA"]},
		{"name":"Amin","colors":["#8E2DE2","#4A00E0"]},
		{"name":"Anamnisar","colors":["#9796f0","#fbc7d4"]},
		{"name":"Andreuzzas","colors":["#D70652","#FF025E"]},
		{"name":"Anwar","colors":["#334d50","#cbcaa5"]},
		{"name":"Aqua Marine","colors":["#1A2980","#26D0CE"]},
		{"name":"Aqualicious","colors":["#50C9C3","#96DEDA"]},
		{"name":"Argon","colors":["#03001e","#7303c0","#ec38bc","#fdeff9"]},
		{"name":"Army","colors":["#414d0b","#727a17"]},
		{"name":"Ash","colors":["#606c88","#3f4c6b"]},
		{"name":"Atlas","colors":["#FEAC5E","#C779D0","#4BC0C8"]},
		{"name":"Aubergine","colors":["#AA076B","#61045F"]},
		{"name":"Autumn","colors":["#DAD299","#B0DAB9"]},
		{"name":"Azur Lane","colors":["#7F7FD5","#86A8E7","#91EAE4"]},
		{"name":"Azure Pop","colors":["#ef32d9","#89fffd"]},
		{"name":"Back To Earth","colors":["#00C9FF","#92FE9D"]},
		{"name":"Back to the Future","colors":["#C02425","#F0CB35"]},
		{"name":"Behongo","colors":["#52c234","#061700"]},
		{"name":"Beleko","colors":["#ff1e56","#f9c942","#1e90ff"]},
		{"name":"Between Night and Day","colors":["#2c3e50","#3498db"]},
		{"name":"Between The Clouds","colors":["#73C8A9","#373B44"]},
		{"name":"Bighead","colors":["#c94b4b","#4b134f"]},
		{"name":"Black Rosé","colors":["#f4c4f3","#fc67fa"]},
		{"name":"Bleem","colors":["#4284DB","#29EAC4"]},
		{"name":"Blood Red","colors":["#f85032","#e73827"]},
		{"name":"Bloody Mary","colors":["#FF512F","#DD2476"]},
		{"name":"Blooker20","colors":["#e65c00","#F9D423"]},
		{"name":"Blooze","colors":["#6da6be","#4b859e","#6da6be"]},
		{"name":"Blu","colors":["#00416A","#E4E5E6"]},
		{"name":"Blue & Orange","colors":["#FD8112","#0085CA"]},
		{"name":"Blue Raspberry","colors":["#00B4DB","#0083B0"]},
		{"name":"Blue Red","colors":["#36B1C7","#960B33"]},
		{"name":"Blue Skies","colors":["#56CCF2","#2F80ED"]},
		{"name":"Blue Slate","colors":["#B5B9FF","#2B2C49"]},
		{"name":"Bluelagoo","colors":["#0052D4","#4364F7","#6FB1FC"]},
		{"name":"Blurry Beach","colors":["#d53369","#cbad6d"]},
		{"name":"Blush","colors":["#B24592","#F15F79"]},
		{"name":"Bora Bora","colors":["#2BC0E4","#EAECC6"]},
		{"name":"Bourbon","colors":["#EC6F66","#F3A183"]},
		{"name":"Brady Brady Fun Fun","colors":["#00c3ff","#ffff1c"]},
		{"name":"Bright Vault","colors":["#00d2ff","#928DAB"]},
		{"name":"Broken Hearts","colors":["#d9a7c7","#fffcdc"]},
		{"name":"Bupe","colors":["#00416A","#E4E5E6"]},
		{"name":"Burning Orange","colors":["#FF416C","#FF4B2B"]},
		{"name":"By Design","colors":["#009FFF","#ec2F4B"]},
		{"name":"Calm Darya","colors":["#5f2c82","#49a09d"]},
		{"name":"Can You Feel The Love Tonight","colors":["#4568DC","#B06AB3"]},
		{"name":"Candy","colors":["#D3959B","#BFE6BA"]},
		{"name":"Celestial","colors":["#C33764","#1D2671"]},
		{"name":"Cheer Up Emo Kid","colors":["#556270","#FF6B6B"]},
		{"name":"Cherry","colors":["#EB3349","#F45C43"]},
		{"name":"Cherryblossoms","colors":["#FBD3E9","#BB377D"]},
		{"name":"Chitty Chitty Bang Bang","colors":["#007991","#78ffd6"]},
		{"name":"Christmas","colors":["#2F7336","#AA3A38"]},
		{"name":"Cinnamint","colors":["#4AC29A","#BDFFF3"]},
		{"name":"Citrus Peel","colors":["#FDC830","#F37335"]},
		{"name":"Clear Sky","colors":["#005C97","#363795"]},
		{"name":"Clouds","colors":["#ECE9E6","#FFFFFF"]},
		{"name":"Coal","colors":["#EB5757","#000000"]},
		{"name":"Cocoaa Ice","colors":["#c0c0aa","#1cefff"]},
		{"name":"Coffee Gold","colors":["#554023","#c99846"]},
		{"name":"Colors Of Sky","colors":["#E0EAFC","#CFDEF3"]},
		{"name":"Combi","colors":["#00416A","#799F0C","#FFE000"]},
		{"name":"Compare Now","colors":["#EF3B36","#FFFFFF"]},
		{"name":"Compass","colors":["#516b8b","#056b3b"]},
		{"name":"Cool Blues","colors":["#2193b0","#6dd5ed"]},
		{"name":"Cool Brown","colors":["#603813","#b29f94"]},
		{"name":"Cool Sky","colors":["#2980B9","#6DD5FA","#FFFFFF"]},
		{"name":"Copper","colors":["#B79891","#94716B"]},
		{"name":"Cosmic Fusion","colors":["#ff00cc","#333399"]},
		{"name":"Crazy Orange I","colors":["#D38312","#A83279"]},
		{"name":"Crimson Tide","colors":["#642B73","#C6426E"]},
		{"name":"Crystal Clear","colors":["#159957","#155799"]},
		{"name":"Curiosity blue","colors":["#525252","#3d72b4"]},
		{"name":"Dance To Forget","colors":["#FF4E50","#F9D423"]},
		{"name":"Dania","colors":["#BE93C5","#7BC6CC"]},
		{"name":"Dark Blu Two","colors":["#004680","#4484BA"]},
		{"name":"Dark Blue Gradient","colors":["#2774ae","#002E5D","#002E5D"]},
		{"name":"Dark Knight","colors":["#BA8B02","#181818"]},
		{"name":"Dark Ocean","colors":["#373B44","#4286f4"]},
		{"name":"Dark Skies","colors":["#4B79A1","#283E51"]},
		{"name":"Dawn","colors":["#F3904F","#3B4371"]},
		{"name":"Day Tripper","colors":["#f857a6","#ff5858"]},
		{"name":"Decent","colors":["#4CA1AF","#C4E0E5"]},
		{"name":"Deep Purple","colors":["#673AB7","#512DA8"]},
		{"name":"Deep Sea Space","colors":["#2C3E50","#4CA1AF"]},
		{"name":"Deep Space","colors":["#000000","#434343"]},
		{"name":"Delicate","colors":["#D3CCE3","#E9E4F0"]},
		{"name":"Digital Water","colors":["#74ebd5","#ACB6E5"]},
		{"name":"DIMIGO","colors":["#ec008c","#fc6767"]},
		{"name":"Dirty Fog","colors":["#B993D6","#8CA6DB"]},
		{"name":"Disco","colors":["#4ECDC4","#556270"]},
		{"name":"Dracula","colors":["#DC2424","#4A569D"]},
		{"name":"Dull","colors":["#C9D6FF","#E2E2E2"]},
		{"name":"Dusk","colors":["#2C3E50","#FD746C"]},
		{"name":"Dusty Grass","colors":["#d4fc79","#96e6a1"]},
		{"name":"Earthly","colors":["#649173","#DBD5A4"]},
		{"name":"EasyMed","colors":["#DCE35B","#45B649"]},
		{"name":"Ed Sunset Gradient","colors":["#ff7e5f","#feb47b"]},
		{"name":"Elate The Euge","colors":["#8BDEDA","#43ADD0","#998EE0","#E17DC2","#EF9393"]},
		{"name":"Electric Peacock","colors":["#8a2be2","#0000cd","#228b22","#ccff00"]},
		{"name":"Electric Violet","colors":["#4776E6","#8E54E9"]},
		{"name":"Emerald Sea","colors":["#05386b","#5cdb95"]},
		{"name":"Emerald Water","colors":["#348F50","#56B4D3"]},
		{"name":"Endless River","colors":["#43cea2","#185a9d"]},
		{"name":"Evening Night","colors":["#005AA7","#FFFDE4"]},
		{"name":"Evening Sunshine","colors":["#b92b27","#1565C0"]},
		{"name":"eXpresso","colors":["#ad5389","#3c1053"]},
		{"name":"Facebook Messenger","colors":["#00c6ff","#0072ff"]},
		{"name":"Farhan","colors":["#9400D3","#4B0082"]},
		{"name":"Firewatch","colors":["#cb2d3e","#ef473a"]},
		{"name":"Flame","colors":["#ff0000","#fdcf58"]},
		{"name":"Flare","colors":["#f12711","#f5af19"]},
		{"name":"Flickr","colors":["#ff0084","#33001b"]},
		{"name":"Flower","colors":["#DCFFBD","#CC86D1"]},
		{"name":"Forest","colors":["#5A3F37","#2C7744"]},
		{"name":"Forever Lost","colors":["#5D4157","#A8CABA"]},
		{"name":"Fresh Turboscent","colors":["#F1F2B5","#135058"]},
		{"name":"Friday","colors":["#83a4d4","#b6fbff"]},
		{"name":"From Ice To Fire","colors":["#72C6EF","#004E8F"]},
		{"name":"Frost","colors":["#000428","#004e92"]},
		{"name":"Frozen","colors":["#403B4A","#E7E9BB"]},
		{"name":"Grade Grey","colors":["#bdc3c7","#2c3e50"]},
		{"name":"Grapefruit Sunset","colors":["#e96443","#904e95"]},
		{"name":"Green and Blue","colors":["#c2e59c","#64b3f4"]},
		{"name":"Green Beach","colors":["#02AAB0","#00CDAC"]},
		{"name":"Green to dark","colors":["#6A9113","#141517"]},
		{"name":"Haikus","colors":["#fd746c","#ff9068"]},
		{"name":"Harmonic Energy","colors":["#16A085","#F4D03F"]},
		{"name":"Harvey","colors":["#1f4037","#99f2c8"]},
		{"name":"Hazel","colors":["#77A1D3","#79CBCA","#E684AE"]},
		{"name":"Hersheys","colors":["#1e130c","#9a8478"]},
		{"name":"Honey Dew","colors":["#43C6AC","#F8FFAE"]},
		{"name":"Horizon","colors":["#003973","#E5E5BE"]},
		{"name":"Html","colors":["#E44D26","#F16529"]},
		{"name":"Hydrogen","colors":["#667db6","#0082c8","#0082c8","#667db6"]},
		{"name":"Hyper Blue","colors":["#59CDE9","#0A2A88"]},
		{"name":"Ibiza Sunset","colors":["#ee0979","#ff6a00"]},
		{"name":"Ibtesam","colors":["#00F5A0","#00D9F5"]},
		{"name":"IIIT Delhi","colors":["#808080","#3fada8"]},
		{"name":"Inbox","colors":["#457fca","#5691c8"]},
		{"name":"Influenza","colors":["#C04848","#480048"]},
		{"name":"Instagram","colors":["#833ab4","#fd1d1d","#fcb045"]},
		{"name":"Intuitive Purple","colors":["#DA22FF","#9733EE"]},
		{"name":"Jaipur","colors":["#DBE6F6","#C5796D"]},
		{"name":"Jodhpur","colors":["#9CECFB","#65C7F7","#0052D4"]},
		{"name":"Jonquil","colors":["#FFEEEE","#DDEFBB"]},
		{"name":"Joomla","colors":["#1e3c72","#2a5298"]},
		{"name":"JShine","colors":["#12c2e9","#c471ed","#f64f59"]},
		{"name":"Juicy Orange","colors":["#FF8008","#FFC837"]},
		{"name":"Jupiter","colors":["#ffd89b","#19547b"]},
		{"name":"Kashmir","colors":["#614385","#516395"]},
		{"name":"Kimoby Is The New Blue","colors":["#396afc","#2948ff"]},
		{"name":"King Yna","colors":["#1a2a6c","#b21f1f","#fdbb2d"]},
		{"name":"Koko Caramel","colors":["#D1913C","#FFD194"]},
		{"name":"Kye Meh","colors":["#8360c3","#2ebf91"]},
		{"name":"Kyoo Pal","colors":["#dd3e54","#6be585"]},
		{"name":"Kyoo Tah","colors":["#544a7d","#ffd452"]},
		{"name":"Kyoto","colors":["#c21500","#ffc500"]},
		{"name":"Lawrencium","colors":["#0f0c29","#302b63","#24243e"]},
		{"name":"Learning and Leading","colors":["#F7971E","#FFD200"]},
		{"name":"Lemon Lime","colors":["#7ec6bc","#ebe717"]},
		{"name":"Lemon Twist","colors":["#3CA55C","#B5AC49"]},
		{"name":"Lensod","colors":["#6025F5","#FF5555"]},
		{"name":"Light Orange","colors":["#FFB75E","#ED8F03"]},
		{"name":"Limeade","colors":["#A1FFCE","#FAFFD1"]},
		{"name":"Lithium","colors":["#6D6027","#D3CBB8"]},
		{"name":"Little Leaf","colors":["#76b852","#8DC26F"]},
		{"name":"Lizard","colors":["#304352","#d7d2cc"]},
		{"name":"Love and Liberty","colors":["#200122","#6f0000"]},
		{"name":"Love Couple","colors":["#3a6186","#89253e"]},
		{"name":"Lunada","colors":["#5433FF","#20BDFF","#A5FECB"]},
		{"name":"Lush","colors":["#56ab2f","#a8e063"]},
		{"name":"Magic","colors":["#59C173","#a17fe0","#5D26C1"]},
		{"name":"Maldives","colors":["#B2FEFA","#0ED2F7"]},
		{"name":"Man of Steel","colors":["#780206","#061161"]},
		{"name":"Mango Papaya","colors":["#de8a41","#2ada53"]},
		{"name":"Mango Pulp","colors":["#F09819","#EDDE5D"]},
		{"name":"Mango","colors":["#ffe259","#ffa751"]},
		{"name":"Mantle","colors":["#24C6DC","#514A9D"]},
		{"name":"Margo","colors":["#FFEFBA","#FFFFFF"]},
		{"name":"Martini","colors":["#FDFC47","#24FE41"]},
		{"name":"Master Card","colors":["#f46b45","#eea849"]},
		{"name":"Mauve","colors":["#42275a","#734b6d"]},
		{"name":"MegaTron","colors":["#C6FFDD","#FBD786","#f7797d"]},
		{"name":"Mello","colors":["#c0392b","#8e44ad"]},
		{"name":"Memariani","colors":["#aa4b6b","#6b6b83","#3b8d99"]},
		{"name":"Meridian","colors":["#283c86","#45a247"]},
		{"name":"Metallic Toad","colors":["#abbaab","#ffffff"]},
		{"name":"Metapolis","colors":["#659999","#f4791f"]},
		{"name":"Miaka","colors":["#FC354C","#0ABFBC"]},
		{"name":"Miami Dolphins","colors":["#4DA0B0","#D39D38"]},
		{"name":"Midnight City","colors":["#232526","#414345"]},
		{"name":"Mild","colors":["#67B26F","#4ca2cd"]},
		{"name":"Mini","colors":["#30E8BF","#FF8235"]},
		{"name":"Minimal Red","colors":["#F00000","#DC281E"]},
		{"name":"Minnesota Vikings","colors":["#5614B0","#DBD65C"]},
		{"name":"Mirage","colors":["#16222A","#3A6073"]},
		{"name":"Misty Meadow","colors":["#215f00","#e4e4d9"]},
		{"name":"Mojito","colors":["#1D976C","#93F9B9"]},
		{"name":"Monte Carlo","colors":["#CC95C0","#DBD4B4","#7AA1D2"]},
		{"name":"Moon Purple","colors":["#4e54c8","#8f94fb"]},
		{"name":"Moonlit Asteroid","colors":["#0F2027","#203A43","#2C5364"]},
		{"name":"Moonrise","colors":["#DAE2F8","#D6A4A4"]},
		{"name":"Moonwalker","colors":["#152331","#000000"]},
		{"name":"Moor","colors":["#616161","#9bc5c3"]},
		{"name":"Moss","colors":["#134E5E","#71B280"]},
		{"name":"Mystic","colors":["#757F9A","#D7DDE8"]},
		{"name":"Namn","colors":["#a73737","#7a2828"]},
		{"name":"Nelson","colors":["#f2709c","#ff9472"]},
		{"name":"Neon Green","colors":["#81ff8a","#64965e"]},
		{"name":"Neon Life","colors":["#B3FFAB","#12FFF7"]},
		{"name":"Nepal","colors":["#de6161","#2657eb"]},
		{"name":"Netflix","colors":["#8E0E00","#1F1C18"]},
		{"name":"Neuromancer","colors":["#f953c6","#b91d73"]},
		{"name":"Newspaper","colors":["#8a2be2","#ffa500","#f8f8ff"]},
		{"name":"Nighthawk","colors":["#2980b9","#2c3e50"]},
		{"name":"Nimvelo","colors":["#314755","#26a0da"]},
		{"name":"Noon to Dusk","colors":["#ff6e7f","#bfe9ff"]},
		{"name":"Ohhappiness","colors":["#00b09b","#96c93d"]},
		{"name":"Omolon","colors":["#091E3A","#2F80ED","#2D9EE0"]},
		{"name":"Opa","colors":["#3D7EAA","#FFE47A"]},
		{"name":"Orange Coral","colors":["#ff9966","#ff5e62"]},
		{"name":"Orange Fun","colors":["#fc4a1a","#f7b733"]},
		{"name":"Orca","colors":["#44A08D","#093637"]},
		{"name":"Pacific Dream","colors":["#34e89e","#0f3443"]},
		{"name":"Pale Wood","colors":["#eacda3","#d6ae7b"]},
		{"name":"Parklife","colors":["#ADD100","#7B920A"]},
		{"name":"Passion","colors":["#e53935","#e35d5b"]},
		{"name":"Pastel Orange at the Sun","colors":["#ffb347","#ffcc33"]},
		{"name":"Peach Sea","colors":["#E6AE8C","#A8CECF"]},
		{"name":"Peach","colors":["#ED4264","#FFEDBC"]},
		{"name":"Petrichor","colors":["#666600","#999966"]},
		{"name":"Petrol","colors":["#BBD2C5","#536976"]},
		{"name":"Piggy Pink","colors":["#ee9ca7","#ffdde1"]},
		{"name":"Piglet","colors":["#ee9ca7","#ffdde1"]},
		{"name":"Pink Flavour","colors":["#800080","#ffc0cb"]},
		{"name":"Pinky","colors":["#DD5E89","#F7BB97"]},
		{"name":"Pinot Noir","colors":["#4b6cb7","#182848"]},
		{"name":"Pizelex","colors":["#114357","#F29492"]},
		{"name":"Playing with Reds","colors":["#D31027","#EA384D"]},
		{"name":"Politics","colors":["#2196f3","#f44336"]},
		{"name":"Poncho","colors":["#403A3E","#BE5869"]},
		{"name":"Portrait","colors":["#8e9eab","#eef2f3"]},
		{"name":"Predawn","colors":["#FFA17F","#00223E"]},
		{"name":"Pun Yeta","colors":["#108dc7","#ef8e38"]},
		{"name":"Pure Lust","colors":["#333333","#dd1818"]},
		{"name":"Purpink","colors":["#7F00FF","#E100FF"]},
		{"name":"Purple Bliss","colors":["#360033","#0b8793"]},
		{"name":"Purple Dream","colors":["#bf5ae0","#a811da"]},
		{"name":"Purple Love","colors":["#cc2b5e","#753a88"]},
		{"name":"Purple Paradise","colors":["#1D2B64","#F8CDDA"]},
		{"name":"Purple White","colors":["#BA5370","#F4E2D8"]},
		{"name":"Purple","colors":["#c84e89","#F15F79"]},
		{"name":"Purplepine","colors":["#20002c","#cbb4d4"]},
		{"name":"Purplin","colors":["#6a3093","#a044ff"]},
		{"name":"Quepal","colors":["#11998e","#38ef7d"]},
		{"name":"Racker","colors":["#EB0000","#95008A","#3300FC"]},
		{"name":"Radar","colors":["#A770EF","#CF8BF3","#FDB99B"]},
		{"name":"Radioactive Heat","colors":["#F7941E","#72C6EF","#00A651"]},
		{"name":"Rainbow Blue","colors":["#00F260","#0575E6"]},
		{"name":"Rastafari","colors":["#1E9600","#FFF200","#FF0000"]},
		{"name":"Rea","colors":["#FFE000","#799F0C"]},
		{"name":"Reaqua","colors":["#799F0C","#ACBB78"]},
		{"name":"Red Mist","colors":["#000000","#e74c3c"]},
		{"name":"Red Ocean","colors":["#1D4350","#A43931"]},
		{"name":"Red Sunset","colors":["#355C7D","#6C5B7B","#C06C84"]},
		{"name":"Reef","colors":["#00d2ff","#3a7bd5"]},
		{"name":"Relaxing red","colors":["#fffbd5","#b20a2c"]},
		{"name":"Relay","colors":["#3A1C71","#D76D77","#FFAF7B"]},
		{"name":"Rose Colored Lenses","colors":["#E8CBC0","#636FA4"]},
		{"name":"Rose Water","colors":["#E55D87","#5FC3E4"]},
		{"name":"Roseanna","colors":["#FFAFBD","#ffc3a0"]},
		{"name":"Royal Blue + Petrol","colors":["#BBD2C5","#536976","#292E49"]},
		{"name":"Royal Blue","colors":["#536976","#292E49"]},
		{"name":"Royal","colors":["#141E30","#243B55"]},
		{"name":"Sage Persuasion","colors":["#CCCCB2","#757519"]},
		{"name":"Sand to Blue","colors":["#3E5151","#DECBA4"]},
		{"name":"Scooter","colors":["#36D1DC","#5B86E5"]},
		{"name":"Sea Blizz","colors":["#1CD8D2","#93EDC7"]},
		{"name":"Sea Blue","colors":["#2b5876","#4e4376"]},
		{"name":"Sea Weed","colors":["#4CB8C4","#3CD3AD"]},
		{"name":"Sel","colors":["#00467F","#A5CC82"]},
		{"name":"Selenium","colors":["#3C3B3F","#605C3C"]},
		{"name":"ServQuick","colors":["#485563","#29323c"]},
		{"name":"Sexy Blue","colors":["#2193b0","#6dd5ed"]},
		{"name":"Sha la la","colors":["#D66D75","#E29587"]},
		{"name":"Shahabi","colors":["#a80077","#66ff00"]},
		{"name":"Sherbert","colors":["#f79d00","#64f38c"]},
		{"name":"Shifter","colors":["#bc4e9c","#f80759"]},
		{"name":"Shifty","colors":["#636363","#a2ab58"]},
		{"name":"Shore","colors":["#70e1f5","#ffd194"]},
		{"name":"Shrimpy","colors":["#e43a15","#e65245"]},
		{"name":"Shroom Haze","colors":["#5C258D","#4389A2"]},
		{"name":"Sin City Red","colors":["#ED213A","#93291E"]},
		{"name":"Sirius Tamed","colors":["#EFEFBB","#D4D3DD"]},
		{"name":"Sky","colors":["#076585","#fff"]},
		{"name":"Skyline","colors":["#1488CC","#2B32B2"]},
		{"name":"Slight Ocean View","colors":["#a8c0ff","#3f2b96"]},
		{"name":"Snapchat","colors":["#fffc00","#ffffff"]},
		{"name":"Socialive","colors":["#06beb6","#48b1bf"]},
		{"name":"Solid Vault","colors":["#3a7bd5","#3a6073"]},
		{"name":"SoundCloud","colors":["#fe8c00","#f83600"]},
		{"name":"Space Light Green","colors":["#9FA0A8","#5C7852"]},
		{"name":"Starfall","colors":["#F0C27B","#4B1248"]},
		{"name":"Steel Gray","colors":["#1F1C2C","#928DAB"]},
		{"name":"Stellar","colors":["#7474BF","#348AC7"]},
		{"name":"Stripe","colors":["#1FA2FF","#12D8FA","#A6FFCB"]},
		{"name":"Sublime Light","colors":["#FC5C7D","#6A82FB"]},
		{"name":"Sublime Vivid","colors":["#FC466B","#3F5EFB"]},
		{"name":"Subu","colors":["#0cebeb","#20e3b2","#29ffc6"]},
		{"name":"Sulphur","colors":["#CAC531","#F3F9A7"]},
		{"name":"Summer Breeze","colors":["#fbed96","#abecd6"]},
		{"name":"Summer Dog","colors":["#a8ff78","#78ffd6"]},
		{"name":"Summer","colors":["#22c1c3","#fdbb2d"]},
		{"name":"Sun on the Horizon","colors":["#fceabb","#f8b500"]},
		{"name":"Sunkist","colors":["#F2994A","#F2C94C"]},
		{"name":"Sunny Days","colors":["#EDE574","#E1F5C4"]},
		{"name":"Sunrise","colors":["#FF512F","#F09819"]},
		{"name":"Sunset","colors":["#0B486B","#F56217"]},
		{"name":"Superman","colors":["#0099F7","#F11712"]},
		{"name":"Suzy","colors":["#834d9b","#d04ed6"]},
		{"name":"Sweet Morning","colors":["#FF5F6D","#FFC371"]},
		{"name":"Sylvia","colors":["#ff4b1f","#ff9068"]},
		{"name":"Talking To Mice Elf","colors":["#948E99","#2E1437"]},
		{"name":"Taran Tado","colors":["#23074d","#cc5333"]},
		{"name":"Teal Love","colors":["#AAFFA9","#11FFBD"]},
		{"name":"Telegram","colors":["#1c92d2","#f2fcfe"]},
		{"name":"Telko","colors":["#F36222","#5CB644","#007FC3"]},
		{"name":"Terminal","colors":["#000000","#0f9b0f"]},
		{"name":"The Blue Lagoon","colors":["#43C6AC","#191654"]},
		{"name":"The Sky And The Sea","colors":["#F7941E","#004E8F"]},
		{"name":"The Strain","colors":["#870000","#190A05"]},
		{"name":"Timber","colors":["#fc00ff","#00dbde"]},
		{"name":"Titanium","colors":["#283048","#859398"]},
		{"name":"Tranquil","colors":["#EECDA3","#EF629F"]},
		{"name":"Transfile","colors":["#16BFFD","#CB3066"]},
		{"name":"Turquoise flow","colors":["#136a8a","#267871"]},
		{"name":"Twitch","colors":["#6441A5","#2a0845"]},
		{"name":"Twitter","colors":["#1DA1F2","#009ffc"]},
		{"name":"Ukraine","colors":["#004FF9","#FFF94C"]},
		{"name":"Ultra Voilet","colors":["#654ea3","#eaafc8"]},
		{"name":"Under Blue Green","colors":["#051937","#004d7a","#008793","#00bf72","#a8eb12"]},
		{"name":"Under the Lake","colors":["#093028","#237A57"]},
		{"name":"Unicorn Rainbow","colors":["#f7f0ac","#acf7f0","#f0acf7"]},
		{"name":"Vanusa","colors":["#DA4453","#89216B"]},
		{"name":"Vasily","colors":["#e9d362","#333333"]},
		{"name":"Velvet Sun","colors":["#e1eec3","#f05053"]},
		{"name":"Venice Blue","colors":["#085078","#85D8CE"]},
		{"name":"Venice","colors":["#6190E8","#A7BFE8"]},
		{"name":"Ver Black","colors":["#F7F8F8","#ACBB78"]},
		{"name":"Ver","colors":["#FFE000","#799F0C"]},
		{"name":"Very Blue","colors":["#0575E6","#021B79"]},
		{"name":"Vice City","colors":["#3494E6","#EC6EAD"]},
		{"name":"Vine","colors":["#00bf8f","#001510"]},
		{"name":"Virgin America","colors":["#7b4397","#dc2430"]},
		{"name":"Virgin","colors":["#C9FFBF","#FFAFBD"]},
		{"name":"Visions of Grandeur","colors":["#000046","#1CB5E0"]},
		{"name":"Visual Blue","colors":["#003d4d","#00c996"]},
		{"name":"Wedding Day Blues","colors":["#40E0D0","#FF8C00","#FF0080"]},
		{"name":"What lies Beyond","colors":["#F0F2F0","#000C40"]},
		{"name":"Whinehouse","colors":["#f7f7f7","#b9a0a0","#794747","#4e2020","#111111"]},
		{"name":"Windy","colors":["#acb6e5","#86fde8"]},
		{"name":"Winter Woods","colors":["#333333","#a2ab58","#A43931"]},
		{"name":"Winter","colors":["#E6DADA","#274046"]},
		{"name":"Wiretap","colors":["#8A2387","#E94057","#F27121"]},
		{"name":"Witching Hour","colors":["#c31432","#240b36"]},
		{"name":"Yoda","colors":["#FF0099","#493240"]},
		{"name":"YouTube","colors":["#e52d27","#b31217"]},
		{"name":"Zenta","colors":["#2A2D3E","#FECB6E"]},
		{"name":"Zinc","colors":["#ADA996","#F2F2F2","#DBDBDB","#EAEAEA"]},
];
document.addEventListener('DOMContentLoaded', () => {
  // --- DOM Elements ---
  const dom = {
    gradientTypeSelect: document.getElementById('gradientTypeSelect'),
    linearControls: document.getElementById('linearControls'),
    linearDirectionKeyword: document.getElementById('linearDirectionKeyword'),
    linearAngleContainer: document.getElementById('linearAngleContainer'),
    linearAngle: document.getElementById('linearAngle'),
    radialControls: document.getElementById('radialControls'),
    radialShape: document.getElementById('radialShape'),
    radialSize: document.getElementById('radialSize'),
    radialPosition: document.getElementById('radialPosition'),
    conicControls: document.getElementById('conicControls'),
    conicAngleFrom: document.getElementById('conicAngleFrom'),
    conicPosition: document.getElementById('conicPosition'),
    colorStopsContainer: document.getElementById('colorStopsContainer'),
    addStopBtn: document.getElementById('addStopBtn'),
    gradientPreview: document.getElementById('gradientPreview'),
    codeOutput: document.getElementById('codeOutput'),
    copyCodeBtn: document.getElementById('copyCodeBtn'),
    browsePalettesBtn: document.getElementById('browsePalettesBtn'),
    selectedPaletteName: document.getElementById('selectedPaletteName'),
    paletteModalElement: document.getElementById('paletteModal'),
    paletteSearch: document.getElementById('paletteSearch'),
    paletteListContainer: document.getElementById('paletteListContainer'),
    downloadWidth: document.getElementById('downloadWidth'),
    downloadHeight: document.getElementById('downloadHeight'),
    downloadBtn: document.getElementById('downloadBtn'),
    toastContainer: document.getElementById('toastContainer')
  };

  let paletteModalInstance = bootstrap.Modal.getOrCreateInstance(dom.paletteModalElement);

  // --- State Management ---
  let state = {
    type: 'linear',
    linear: { direction: 'to right' },
    radial: { shape: 'ellipse', size: 'farthest-corner', position: 'center' },
    conic: { angle: 0, position: 'center' },
    colorStops: [
       { id: Date.now() + 1, color: '#8E2DE2', position: 0 },
       { id: Date.now() + 2, color: '#4A00E0', position: 100 }
    ],
    activePaletteName: 'Amin'
  };

  // --- UI Feedback Helpers ---
  const uiFeedback = {
    showToast(message, variant = 'info', delay = 3000) {
      const toastId = 'toast-' + Date.now();
      const toastEl = document.createElement('div');
      const bgClass = `bg-${variant}`;
      const textClass = (['warning', 'info', 'light'].includes(variant)) ? 'text-dark' : 'text-white';
      toastEl.className = `toast align-items-center ${textClass} ${bgClass} border-0`;
      toastEl.id = toastId;
      toastEl.setAttribute('role', 'alert');
      toastEl.innerHTML = `<div class="d-flex"><div class="toast-body">${message}</div><button type="button" class="btn-close me-2 m-auto ${textClass === 'text-dark' ? '' : 'btn-close-white'}" data-bs-dismiss="toast" aria-label="Close"></button></div>`;
      dom.toastContainer.appendChild(toastEl);
      const bsToast = new bootstrap.Toast(toastEl, { delay });
      bsToast.show();
      toastEl.addEventListener('hidden.bs.toast', () => toastEl.remove(), { once: true });
    },
    flashButton(button, variant, text = null) {
      const originalHTML = button.innerHTML;
      const tempHTML = text || originalHTML;
      const originalClasses = button.className;
      button.disabled = true;
      button.className = `btn btn-${variant}`;
      button.innerHTML = tempHTML;
      setTimeout(() => {
        button.className = originalClasses;
        button.innerHTML = originalHTML;
        button.disabled = false;
      }, 1200);
    }
  };

  // --- Core Gradient Logic ---
  function generateCSS(forPreview = false, previewColors = null) {
    const stopsToUse = previewColors ? previewColors.map((c, i, arr) => ({
        color: c,
        position: (arr.length <= 1) ? 50 : (i / (arr.length - 1)) * 100
      })) : state.colorStops;
    if (!stopsToUse || stopsToUse.length === 0) {
      if (!forPreview) {
        dom.gradientPreview.style.backgroundImage = 'none';
        dom.codeOutput.value = '/* Add color stops */';
      }
      return 'none';
    }
    const sortedStops = [...stopsToUse].sort((a, b) => parseFloat(a.position) - parseFloat(b.position));
    const stopsCSS = sortedStops.map(s => `${s.color} ${s.position}%`).join(', ');
    let cssValue = '';
    switch (state.type) {
      case 'linear': cssValue = `linear-gradient(${state.linear.direction}, ${stopsCSS})`; break;
      case 'radial': cssValue = `radial-gradient(${state.radial.shape} ${state.radial.size} at ${state.radial.position}, ${stopsCSS})`; break;
      case 'conic': cssValue = `conic-gradient(from ${state.conic.angle}deg at ${state.conic.position}, ${stopsCSS})`; break;
    }
    if (!forPreview) {
      dom.gradientPreview.style.backgroundImage = cssValue;
      dom.codeOutput.value = `background-image: ${cssValue};`;
    }
    return cssValue;
  }

  function updateGradientStateFromControls() {
    state.type = dom.gradientTypeSelect.value;
    state.linear.direction = (dom.linearDirectionKeyword.value === 'angle') ? `${dom.linearAngle.value}deg` : dom.linearDirectionKeyword.value;
    state.radial = { shape: dom.radialShape.value, size: dom.radialSize.value, position: dom.radialPosition.value };
    state.conic = { angle: dom.conicAngleFrom.value, position: dom.conicPosition.value };
  }

  function updateControlsVisibility() {
    const type = dom.gradientTypeSelect.value;
    dom.linearControls.classList.toggle('d-none', type !== 'linear');
    dom.radialControls.classList.toggle('d-none', type !== 'radial');
    dom.conicControls.classList.toggle('d-none', type !== 'conic');
    dom.linearAngleContainer.classList.toggle('d-none', dom.linearDirectionKeyword.value !== 'angle');
  }

  // --- Color Stops Management ---
  const colorStopsManager = {
    draggedElement: null,
    placeholder: null,
    render() {
      state.colorStops.sort((a, b) => a.position - b.position);
      dom.colorStopsContainer.innerHTML = '';
      state.colorStops.forEach(stop => {
        const row = document.createElement('div');
        row.className = 'color-stop-row';
        row.dataset.id = stop.id;
        row.draggable = true;
        row.innerHTML = `
          <input type="color" class="form-control form-control-color" value="${stop.color}" aria-label="Stop color">
          <div class="input-group input-group-sm">
            <input type="number" class="form-control stop-position-input" value="${stop.position}" min="0" max="100" step="0.1" aria-label="Stop position">
            <span class="input-group-text">%</span>
          </div>
          <button type="button" class="btn btn-sm btn-outline-danger btn-remove-stop" title="Remove stop"><span class="material-icons">delete</span></button>
        `;
        dom.colorStopsContainer.appendChild(row);
      });
      this.attachAllListeners();
    },
    update(id, property, value) {
      const stop = state.colorStops.find(s => s.id === id);
      if (!stop) return;
      stop[property] = value;
      if (property === 'position') {
        this.render(); // Re-render to re-sort visually
      }
      generateCSS();
    },
    add() {
      const newPos = state.colorStops.length > 0 ? Math.min(100, parseFloat(state.colorStops[state.colorStops.length - 1].position) + 10) : 0;
      state.colorStops.push({ id: Date.now(), color: '#cccccc', position: newPos });
      this.render();
      generateCSS();
    },
    remove(id) {
      if (state.colorStops.length <= 2) {
        uiFeedback.showToast('Minimum of 2 color stops required.', 'warning');
        return;
      }
      state.colorStops = state.colorStops.filter(s => s.id !== id);
      this.render();
      generateCSS();
    },
    attachAllListeners() {
      dom.colorStopsContainer.querySelectorAll('.color-stop-row').forEach(row => {
        const id = parseInt(row.dataset.id, 10);
        row.querySelector('input[type="color"]').addEventListener('input', e => this.update(id, 'color', e.target.value));
        row.querySelector('.stop-position-input').addEventListener('change', e => this.update(id, 'position', e.target.value));
        row.querySelector('.btn-remove-stop').addEventListener('click', () => this.remove(id));
        row.addEventListener('dragstart', e => this.onDragStart(e, row));
        row.addEventListener('dragend', e => this.onDragEnd(e));
      });
    },
    onDragStart(e, row) {
      this.draggedElement = row;
      this.placeholder = document.createElement('div');
      this.placeholder.className = 'dragging-placeholder';
      setTimeout(() => row.classList.add('dragging'), 0);
    },
    onDragEnd(e) {
      this.draggedElement.classList.remove('dragging');
      this.placeholder.remove();
      this.draggedElement = null;
      this.placeholder = null;
      const finalOrderIds = [...dom.colorStopsContainer.querySelectorAll('.color-stop-row')].map(el => parseInt(el.dataset.id, 10));
      state.colorStops.sort((a, b) => finalOrderIds.indexOf(a.id) - finalOrderIds.indexOf(b.id));
      generateCSS();
    }
  };
  dom.colorStopsContainer.addEventListener('dragover', e => {
    e.preventDefault();
    const overElement = e.target.closest('.color-stop-row');
    if (overElement && overElement !== colorStopsManager.draggedElement) {
      const rect = overElement.getBoundingClientRect();
      const isAfter = e.clientY > rect.top + rect.height / 2;
      overElement.parentNode.insertBefore(colorStopsManager.placeholder, isAfter ? overElement.nextSibling : overElement);
    }
  });
  dom.colorStopsContainer.addEventListener('drop', e => {
    e.preventDefault();
    if (colorStopsManager.placeholder.parentNode) {
      colorStopsManager.placeholder.parentNode.replaceChild(colorStopsManager.draggedElement, colorStopsManager.placeholder);
    }
  });
  // --- Palette Browser Logic ---
  const paletteManager = {
    populate(searchTerm = '') {
      const lowerTerm = searchTerm.toLowerCase().trim();
      const filtered = uiGradientsPalettes.filter(p => p.name.toLowerCase().includes(lowerTerm));
      dom.paletteListContainer.innerHTML = !filtered.length ? `<div class="list-group-item text-white-50">No palettes found.</div>` : '';
      filtered.forEach(palette => {
        const btn = document.createElement('button');
        btn.type = 'button';
        btn.className = 'list-group-item list-group-item-action d-flex justify-content-between align-items-center bg-dark text-light';
        btn.dataset.paletteName = palette.name;
        btn.innerHTML = `<span>${palette.name}</span><div class="palette-preview" style="background-image: ${generateCSS(true, palette.colors)}"></div>`;
        btn.addEventListener('click', () => this.apply(palette));
        dom.paletteListContainer.appendChild(btn);
      });
    },
    apply(palette) {
      state.colorStops = palette.colors.map((color, i, arr) => ({
        id: Date.now() + i,
        color,
        position: arr.length <= 1 ? 50 : (i / (arr.length - 1)) * 100
      }));
       if (state.colorStops.length === 1) { // Ensure at least two stops
        state.colorStops.push({id: Date.now() + 99, color: '#ffffff', position: 100});
      }
      state.activePaletteName = palette.name;
      dom.selectedPaletteName.textContent = `(${palette.name})`;
      colorStopsManager.render();
      generateCSS();
      paletteModalInstance.hide();
      uiFeedback.showToast(`Applied palette: ${palette.name}`, 'success');
    }
  };
  // --- Download Image Logic ---
  function downloadGradientImage() {
    const width = parseInt(dom.downloadWidth.value, 10) || 800;
    const height = parseInt(dom.downloadHeight.value, 10) || 600;
    const canvas = document.createElement('canvas');
    canvas.width = width;
    canvas.height = height;
    const ctx = canvas.getContext('2d');
    const tempDiv = document.createElement('div');
    tempDiv.style.width = `${width}px`;
    tempDiv.style.height = `${height}px`;
    tempDiv.style.backgroundImage = generateCSS();
    document.body.appendChild(tempDiv);
    // This is a simplified approach; drawing directly on canvas is more robust
    // but also much more complex to perfectly match CSS gradients.
    // For this refactor, we'll generate the CSS and then draw it to the canvas via an SVG image.
    const svg = `<svg xmlns="http://www.w3.org/2000/svg" width="${width}" height="${height}"><foreignObject width="100%" height="100%"><div xmlns="http://www.w3.org/1999/xhtml" style="width:100%; height:100%; background-image:${generateCSS()};"></div></foreignObject></svg>`;
    const img = new Image();
    img.onload = () => {
      ctx.drawImage(img, 0, 0);
      const link = document.createElement('a');
      link.download = `gradient-${state.type}-${width}x${height}.png`;
      link.href = canvas.toDataURL('image/png');
      link.click();
      uiFeedback.flashButton(dom.downloadBtn, 'success', '<span class="material-icons">check</span> Done!');
    };
    img.onerror = () => {
      uiFeedback.showToast('Failed to generate image.', 'danger');
      uiFeedback.flashButton(dom.downloadBtn, 'danger', '<span class="material-icons">error</span> Failed!');
    };
    img.src = 'data:image/svg+xml;charset=utf-8,' + encodeURIComponent(svg);
    document.body.removeChild(tempDiv);
  }
  // --- Event Listeners Setup ---
  ['change', 'input'].forEach(evt => {
    dom.gradientTypeSelect.addEventListener(evt, () => { updateControlsVisibility(); updateGradientStateFromControls(); generateCSS(); });
    dom.linearDirectionKeyword.addEventListener(evt, () => { updateControlsVisibility(); updateGradientStateFromControls(); generateCSS(); });
    dom.linearAngle.addEventListener(evt, () => { updateGradientStateFromControls(); generateCSS(); });
    dom.radialShape.addEventListener(evt, () => { updateGradientStateFromControls(); generateCSS(); });
    dom.radialSize.addEventListener(evt, () => { updateGradientStateFromControls(); generateCSS(); });
    dom.radialPosition.addEventListener(evt, () => { updateGradientStateFromControls(); generateCSS(); });
    dom.conicAngleFrom.addEventListener(evt, () => { updateGradientStateFromControls(); generateCSS(); });
    dom.conicPosition.addEventListener(evt, () => { updateGradientStateFromControls(); generateCSS(); });
  });
  dom.addStopBtn.addEventListener('click', () => colorStopsManager.add());
  dom.copyCodeBtn.addEventListener('click', () => {
    navigator.clipboard.writeText(dom.codeOutput.value).then(() => {
      uiFeedback.flashButton(dom.copyCodeBtn, 'success', '<span class="material-icons">check</span> Copied!');
    }).catch(() => {
      uiFeedback.showToast('Failed to copy to clipboard.', 'danger');
    });
  });
  dom.downloadBtn.addEventListener('click', downloadGradientImage);
  dom.paletteSearch.addEventListener('input', e => paletteManager.populate(e.target.value));
  dom.paletteModalElement.addEventListener('shown.bs.modal', () => {
    paletteManager.populate();
    dom.paletteSearch.focus();
  });
  // --- Initialization ---
  updateControlsVisibility();
  colorStopsManager.render();
  generateCSS();
  if(state.activePaletteName) {
    dom.selectedPaletteName.textContent = `(${state.activePaletteName})`;
  }
});
// --- END: Full JS logic ---
  </script>
</body>
</html>
