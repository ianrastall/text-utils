<!DOCTYPE html>
<html lang="en" data-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Line Operations - Text Utilities</title>
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link rel="stylesheet" href="css/style.css">
    <style>
        .operation-group {
            background: var(--bg-tertiary);
            border-radius: 4px;
            padding: 1rem;
            margin-bottom: 1rem;
        }

        .operation-group h4 {
            margin-bottom: 0.75rem;
            font-size: 1rem;
            color: var(--text-primary);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .button-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
            gap: 0.5rem;
        }

        .btn-operation {
            padding: 0.5rem 0.75rem;
            border: none;
            border-radius: 4px;
            background: var(--bg-secondary);
            color: var(--text-primary);
            cursor: pointer;
            transition: all 0.2s;
            font-size: 0.875rem;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.25rem;
        }

        .btn-operation:hover {
            background: var(--accent);
            color: white;
            transform: translateY(-1px);
        }

        .btn-operation .material-icons {
            font-size: 1rem;
        }

        .input-row {
            display: flex;
            gap: 0.5rem;
            align-items: center;
            margin-bottom: 0.5rem;
        }

        .input-row label {
            min-width: 80px;
            font-size: 0.875rem;
            color: var(--text-secondary);
        }

        .input-row input[type="text"],
        .input-row input[type="number"] {
            flex: 1;
            padding: 0.375rem 0.5rem;
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 4px;
            color: var(--text-primary);
            font-size: 0.875rem;
        }

        .input-row input[type="text"]:focus,
        .input-row input[type="number"]:focus {
            outline: none;
            border-color: var(--accent);
        }

        .switch-container {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem;
            background: var(--bg-secondary);
            border-radius: 4px;
        }

        .switch {
            position: relative;
            display: inline-block;
            width: 40px;
            height: 20px;
        }

        .switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: var(--border-color);
            transition: 0.3s;
            border-radius: 20px;
        }

        .slider:before {
            position: absolute;
            content: "";
            height: 14px;
            width: 14px;
            left: 3px;
            bottom: 3px;
            background-color: white;
            transition: 0.3s;
            border-radius: 50%;
        }

        input:checked + .slider {
            background-color: var(--accent);
        }

        input:checked + .slider:before {
            transform: translateX(20px);
        }

        .stats-bar {
            background: var(--bg-tertiary);
            padding: 0.75rem;
            border-radius: 4px;
            margin-bottom: 1rem;
            display: flex;
            gap: 1.5rem;
            font-size: 0.875rem;
        }

        .stat-item {
            display: flex;
            flex-direction: column;
            gap: 0.125rem;
        }

        .stat-label {
            color: var(--text-secondary);
            font-size: 0.75rem;
        }

        .stat-value {
            color: var(--text-primary);
            font-weight: 600;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <div class="logo">
                <a href="index.html" style="color: inherit; text-decoration: none;">
                    <span>Text Utilities</span>
                </a>
            </div>
            <div class="controls">
                <div class="accent-selector">
                    <span class="material-icons">palette</span>
                    <select id="accentColor" class="color-dropdown">
                        <option value="#0d9488">Teal</option>
                        <option value="#3b82f6">Blue</option>
                        <option value="#8b5cf6">Purple</option>
                        <option value="#10b981">Emerald</option>
                        <option value="#f59e0b">Amber</option>
                        <option value="#ef4444">Red</option>
                        <option value="#ec4899">Soft Pink</option>
                        <option value="#fb7185">Coral</option>
                        <option value="#60a5fa">Cornflower</option>
                        <option value="#7c3aed">Violet</option>
                    </select>
                </div>
                <button id="themeToggle" class="btn btn-secondary">
                    <span class="material-icons">dark_mode</span>
                </button>
            </div>
        </header>

        <main>
            <div class="tool-container">
                <div class="tool-header">
                    <div class="tool-title">
                        <span class="material-icons">reorder</span>
                        <h2>Line Operations</h2>
                    </div>
                    <div class="tool-actions">
                        <button id="backButton" class="btn btn-secondary">
                            <span class="material-icons">arrow_back</span>
                            Back
                        </button>
                        <button id="undoBtn" class="btn btn-secondary" disabled>
                            <span class="material-icons">undo</span>
                            Undo
                        </button>
                        <button id="redoBtn" class="btn btn-secondary" disabled>
                            <span class="material-icons">redo</span>
                            Redo
                        </button>
                        <button id="copyBtn" class="btn btn-secondary">
                            <span class="material-icons">content_copy</span>
                            Copy
                        </button>
                        <button id="pasteBtn" class="btn btn-secondary">
                            <span class="material-icons">content_paste</span>
                            Paste
                        </button>
                        <button id="clearBtn" class="btn btn-secondary">
                            <span class="material-icons">clear</span>
                            Clear
                        </button>
                    </div>
                </div>

                <p class="tool-description">Perform powerful operations on lines of text - sort, filter, modify, and more</p>

                <div class="stats-bar">
                    <div class="stat-item">
                        <span class="stat-label">Total Lines</span>
                        <span class="stat-value" id="statLines">0</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">Non-Empty</span>
                        <span class="stat-value" id="statNonEmpty">0</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">Characters</span>
                        <span class="stat-value" id="statChars">0</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">Unique Lines</span>
                        <span class="stat-value" id="statUnique">0</span>
                    </div>
                </div>

                <div class="operation-group">
                    <h4>
                        <span class="material-icons">sort</span>
                        Sorting
                    </h4>
                    <div class="button-grid">
                        <button class="btn-operation" data-action="sort-alpha">
                            <span class="material-icons">sort_by_alpha</span>
                            A -> Z
                        </button>
                        <button class="btn-operation" data-action="sort-alpha-desc">
                            <span class="material-icons">sort_by_alpha</span>
                            Z -> A
                        </button>
                        <button class="btn-operation" data-action="sort-numeric">
                            <span class="material-icons">filter_1</span>
                            1 -> 9
                        </button>
                        <button class="btn-operation" data-action="sort-numeric-desc">
                            <span class="material-icons">filter_9_plus</span>
                            9 -> 1
                        </button>
                        <button class="btn-operation" data-action="sort-length">
                            <span class="material-icons">height</span>
                            By Length
                        </button>
                        <button class="btn-operation" data-action="sort-natural">
                            <span class="material-icons">auto_awesome</span>
                            Natural
                        </button>
                    </div>
                    <div class="switch-container" style="margin-top: 0.5rem;">
                        <label class="switch">
                            <input type="checkbox" id="caseSensitive">
                            <span class="slider"></span>
                        </label>
                        <label for="caseSensitive" style="color: var(--text-secondary); font-size: 0.875rem;">Case-sensitive sorting</label>
                    </div>
                </div>

                <div class="operation-group">
                    <h4>
                        <span class="material-icons">category</span>
                        Basic Operations
                    </h4>
                    <div class="button-grid">
                        <button class="btn-operation" data-action="reverse">
                            <span class="material-icons">flip</span>
                            Reverse
                        </button>
                        <button class="btn-operation" data-action="shuffle">
                            <span class="material-icons">shuffle</span>
                            Shuffle
                        </button>
                        <button class="btn-operation" data-action="unique">
                            <span class="material-icons">filter_list</span>
                            Remove Duplicates
                        </button>
                        <button class="btn-operation" data-action="trim">
                            <span class="material-icons">space_bar</span>
                            Trim Spaces
                        </button>
                        <button class="btn-operation" data-action="empty">
                            <span class="material-icons">delete_sweep</span>
                            Remove Empty
                        </button>
                        <button class="btn-operation" data-action="unwrap">
                            <span class="material-icons">wrap_text</span>
                            Unwrap Lines
                        </button>
                        <button class="btn-operation" data-action="remove-zerowidth">
                            <span class="material-icons">clear_all</span>
                            Remove Zero-Width
                        </button>
                    </div>
                </div>

                <div class="operation-group">
                    <h4>
                        <span class="material-icons">filter_alt</span>
                        Filter & Modify
                    </h4>
                    <div class="input-row">
                        <label for="filterText">Filter:</label>
                        <input type="text" id="filterText" placeholder="Text to match...">
                        <button class="btn-operation" data-action="filter-keep" style="width: auto;">
                            <span class="material-icons">check</span>
                            Keep
                        </button>
                        <button class="btn-operation" data-action="filter-remove" style="width: auto;">
                            <span class="material-icons">close</span>
                            Remove
                        </button>
                    </div>
                    <div class="input-row">
                        <label for="prefix">Prefix:</label>
                        <input type="text" id="prefix" placeholder="Add to start...">
                        <button class="btn-operation" data-action="add-prefix" style="width: auto;">
                            <span class="material-icons">keyboard_arrow_left</span>
                            Add
                        </button>
                    </div>
                    <div class="input-row">
                        <label for="suffix">Suffix:</label>
                        <input type="text" id="suffix" placeholder="Add to end...">
                        <button class="btn-operation" data-action="add-suffix" style="width: auto;">
                            <span class="material-icons">keyboard_arrow_right</span>
                            Add
                        </button>
                    </div>
                </div>

                <div class="operation-group">
                    <h4>
                        <span class="material-icons">format_list_numbered</span>
                        Numbering & Wrapping
                    </h4>
                    <div class="input-row">
                        <label for="startNumber">Start:</label>
                        <input type="number" id="startNumber" value="1" style="width: 80px;">
                        <label for="stepNumber">Step:</label>
                        <input type="number" id="stepNumber" value="1" min="1" style="width: 80px;">
                        <button class="btn-operation" data-action="number-lines" style="width: auto;">
                            <span class="material-icons">format_list_numbered</span>
                            Number Lines
                        </button>
                    </div>
                    <div class="input-row">
                        <label for="wrapLength">Wrap at:</label>
                        <input type="number" id="wrapLength" value="80" min="1" style="width: 80px;">
                        <span style="font-size: 0.875rem; color: var(--text-secondary);">characters</span>
                        <button class="btn-operation" data-action="hardwrap" style="width: auto; margin-left: auto;">
                            <span class="material-icons">wrap_text</span>
                            Hard Wrap
                        </button>
                    </div>
                </div>

                <div class="io-container" style="grid-template-columns: 1fr;">
                    <div class="io-panel">
                        <div class="io-label">
                            <span>Text Lines</span>
                            <span class="stats" id="inputStats">0 chars, 0 lines</span>
                        </div>
                        <textarea id="inputText" style="min-height: 400px;" placeholder="Enter or paste text here, one item per line..."></textarea>
                    </div>
                </div>

                <div class="status-bar">
                    <div id="statusMessage" class="success">Ready</div>
                    <div id="processingTime">No operations yet</div>
                </div>
            </div>
        </main>
    </div>

    <script src="js/theme.js"></script>
    <script>
        'use strict';

        // Configuration
        const MAX_HISTORY = 30;
        const MAX_INPUT_SIZE = 2 * 1024 * 1024; // 2MB

        // State
        let history = [];
        let historyIndex = -1;

        // DOM Elements
        const inputText = document.getElementById('inputText');
        const caseSensitive = document.getElementById('caseSensitive');
        const filterText = document.getElementById('filterText');
        const prefix = document.getElementById('prefix');
        const suffix = document.getElementById('suffix');
        const startNumber = document.getElementById('startNumber');
        const stepNumber = document.getElementById('stepNumber');
        const wrapLength = document.getElementById('wrapLength');
        const undoBtn = document.getElementById('undoBtn');
        const redoBtn = document.getElementById('redoBtn');
        const copyBtn = document.getElementById('copyBtn');
        const pasteBtn = document.getElementById('pasteBtn');
        const clearBtn = document.getElementById('clearBtn');
        const backBtn = document.getElementById('backButton');
        const statusMessage = document.getElementById('statusMessage');
        const processingTime = document.getElementById('processingTime');
        const inputStats = document.getElementById('inputStats');

        // Initialize
        saveState(inputText.value);
        updateStats();

        // Event Listeners
        document.querySelectorAll('.btn-operation').forEach(btn => {
            btn.addEventListener('click', handleOperation);
        });

        inputText.addEventListener('input', debounce(() => {
            saveState(inputText.value);
            updateStats();
        }, 500));

        undoBtn.addEventListener('click', undo);
        redoBtn.addEventListener('click', redo);
        copyBtn.addEventListener('click', copyToClipboard);
        pasteBtn.addEventListener('click', pasteFromClipboard);
        clearBtn.addEventListener('click', clearAll);
        backBtn.addEventListener('click', () => window.location.href = 'index.html');

        // Keyboard shortcuts
        document.addEventListener('keydown', (e) => {
            if (e.ctrlKey || e.metaKey) {
                if (e.key === 'z' && !e.shiftKey) {
                    e.preventDefault();
                    undo();
                }
                if (e.key === 'y' || (e.key === 'z' && e.shiftKey)) {
                    e.preventDefault();
                    redo();
                }
            }
        });

        // Operation Handler
        function handleOperation(e) {
            const action = e.currentTarget.dataset.action;
            
            if (inputText.value.length > MAX_INPUT_SIZE) {
                showStatus('Input text is too large to process', 'error');
                return;
            }

            const startTime = performance.now();
            
            try {
                switch (action) {
                    // Sorting
                    case 'sort-alpha': sortLines('alpha'); break;
                    case 'sort-alpha-desc': sortLines('alpha', true); break;
                    case 'sort-numeric': sortLines('numeric'); break;
                    case 'sort-numeric-desc': sortLines('numeric', true); break;
                    case 'sort-length': sortLines('length'); break;
                    case 'sort-natural': sortLines('natural'); break;
                    
                    // Basic operations
                    case 'reverse': reverseLines(); break;
                    case 'shuffle': shuffleLines(); break;
                    case 'unique': removeDuplicates(); break;
                    case 'trim': trimLines(); break;
                    case 'empty': removeEmptyLines(); break;
                    case 'unwrap': unwrapLines(); break;
                    case 'remove-zerowidth': removeZeroWidth(); break;
                    
                    // Filter & modify
                    case 'filter-keep': filterLines(true); break;
                    case 'filter-remove': filterLines(false); break;
                    case 'add-prefix': addPrefix(); break;
                    case 'add-suffix': addSuffix(); break;
                    
                    // Numbering & wrapping
                    case 'number-lines': numberLines(); break;
                    case 'hardwrap': hardWrap(); break;
                }
                
                const endTime = performance.now();
                updateStats();
                processingTime.textContent = `Processed in ${Math.round(endTime - startTime)}ms`;
                showStatus('Operation complete', 'success');
                
            } catch (error) {
                console.error('Operation error:', error);
                showStatus('Error: ' + error.message, 'error');
            }
        }

        // Core Operations
        function getLines() {
            return inputText.value.split(/\r\n|\r|\n/);
        }

        function setLines(lines, shouldSave = true) {
            inputText.value = lines.join('\n');
            if (shouldSave) saveState(inputText.value);
        }

        function sortLines(type, descending = false) {
            let lines = getLines();
            const isCaseSensitive = caseSensitive.checked;
            
            const compare = (a, b) => {
                if (!isCaseSensitive) {
                    a = a.toLowerCase();
                    b = b.toLowerCase();
                }
                return a.localeCompare(b);
            };
            
            switch (type) {
                case 'alpha':
                    lines.sort(compare);
                    break;
                case 'numeric':
                    lines.sort((a, b) => parseFloat(a) - parseFloat(b));
                    break;
                case 'length':
                    lines.sort((a, b) => a.length - b.length);
                    break;
                case 'natural':
                    lines.sort((a, b) => a.localeCompare(b, undefined, { 
                        numeric: true, 
                        sensitivity: isCaseSensitive ? 'variant' : 'base' 
                    }));
                    break;
            }
            
            if (descending) lines.reverse();
            setLines(lines);
        }

        function reverseLines() {
            const lines = getLines();
            setLines(lines.reverse());
        }

        function shuffleLines() {
            const lines = getLines();
            for (let i = lines.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [lines[i], lines[j]] = [lines[j], lines[i]];
            }
            setLines(lines);
        }

        function removeDuplicates() {
            const lines = getLines();
            const isCaseSensitive = caseSensitive.checked;
            const seen = new Set();
            
            const filtered = lines.filter(line => {
                const key = isCaseSensitive ? line : line.toLowerCase();
                if (seen.has(key)) return false;
                seen.add(key);
                return true;
            });
            
            setLines(filtered);
        }

        function trimLines() {
            const lines = getLines();
            setLines(lines.map(line => line.trim()));
        }

        function removeEmptyLines() {
            const lines = getLines();
            setLines(lines.filter(line => line.trim() !== ''));
        }

        function unwrapLines() {
            const lines = getLines();
            setLines([lines.join(' ')]);
        }

        function removeZeroWidth() {
            const lines = getLines();
            const zeroWidthRegex = /[\u200B-\u200D\uFEFF\u00AD\u2060]/g;
            setLines(lines.map(line => line.replace(zeroWidthRegex, '')));
        }

        function filterLines(keep) {
            const text = filterText.value;
            if (!text) {
                showStatus('Enter text to filter', 'warning');
                return;
            }
            
            const lines = getLines();
            const isCaseSensitive = caseSensitive.checked;
            
            const matches = (line) => {
                return isCaseSensitive 
                    ? line.includes(text)
                    : line.toLowerCase().includes(text.toLowerCase());
            };
            
            const filtered = keep 
                ? lines.filter(matches)
                : lines.filter(line => !matches(line));
            
            setLines(filtered);
        }

        function addPrefix() {
            const prefixText = prefix.value;
            if (!prefixText) return;
            
            const lines = getLines();
            setLines(lines.map(line => prefixText + line));
        }

        function addSuffix() {
            const suffixText = suffix.value;
            if (!suffixText) return;
            
            const lines = getLines();
            setLines(lines.map(line => line + suffixText));
        }

        function numberLines() {
            let num = parseInt(startNumber.value) || 1;
            const step = parseInt(stepNumber.value) || 1;
            
            const lines = getLines();
            setLines(lines.map(line => {
                const numbered = `${num}. ${line}`;
                num += step;
                return numbered;
            }));
        }

        function hardWrap() {
            const width = parseInt(wrapLength.value) || 80;
            const lines = getLines();
            const text = lines.join(' ');
            
            const regex = new RegExp(`(.{1,${width}})(\\s+|$)`, 'g');
            const wrapped = text.match(regex) || [];
            
            setLines(wrapped.map(l => l.trim()));
        }

        // History Management
        function saveState(text) {
            if (history[historyIndex] === text) return;
            
            history = history.slice(0, historyIndex + 1);
            history.push(text);
            
            if (history.length > MAX_HISTORY) {
                history.shift();
            } else {
                historyIndex++;
            }
            
            updateUndoRedoButtons();
        }

        function undo() {
            if (historyIndex > 0) {
                historyIndex--;
                inputText.value = history[historyIndex];
                updateStats();
                updateUndoRedoButtons();
                showStatus('Undo', 'success');
            }
        }

        function redo() {
            if (historyIndex < history.length - 1) {
                historyIndex++;
                inputText.value = history[historyIndex];
                updateStats();
                updateUndoRedoButtons();
                showStatus('Redo', 'success');
            }
        }

        function updateUndoRedoButtons() {
            undoBtn.disabled = historyIndex <= 0;
            redoBtn.disabled = historyIndex >= history.length - 1;
        }

        // Utility Functions
        function updateStats() {
            const lines = getLines();
            const nonEmpty = lines.filter(l => l.trim() !== '').length;
            const chars = inputText.value.length;
            const unique = new Set(lines.map(l => l.toLowerCase())).size;
            
            document.getElementById('statLines').textContent = lines.length;
            document.getElementById('statNonEmpty').textContent = nonEmpty;
            document.getElementById('statChars').textContent = chars;
            document.getElementById('statUnique').textContent = unique;
            
            inputStats.textContent = `${chars} chars, ${lines.length} lines`;
        }

        async function copyToClipboard() {
            if (!inputText.value) {
                showStatus('Nothing to copy', 'warning');
                return;
            }
            
            await navigator.clipboard.writeText(inputText.value);
            showStatus('Copied to clipboard!', 'success');
        }

        async function pasteFromClipboard() {
            const text = await navigator.clipboard.readText();
            inputText.value = text;
            saveState(text);
            updateStats();
            showStatus('Pasted from clipboard!', 'success');
        }

        function clearAll() {
            inputText.value = '';
            filterText.value = '';
            prefix.value = '';
            suffix.value = '';
            saveState('');
            updateStats();
            showStatus('Cleared', 'success');
        }

        function showStatus(message, type = 'success') {
            statusMessage.textContent = message;
            statusMessage.className = type;
        }

        function debounce(func, delay) {
            let timeout;
            return function(...args) {
                clearTimeout(timeout);
                timeout = setTimeout(() => func.apply(this, args), delay);
            };
        }
    </script>
    <footer class="site-footer">
        <p>&copy; Ian Rastall 2025<br>Contact: moving.form.of.dust@gmail.com<br>Donate: PayPal to merastall@gmail.com</p>
    </footer>
</body>
</html>
